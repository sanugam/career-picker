<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CareerPicker</title>

  <style>
    :root{
      --blue:#003b95;
      --blue2:#002f7a;
      --yellow:#febb02;
      --bg:#f5f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --danger:#b42318;
      --shadow: 0 18px 40px rgba(0,0,0,.12);
      --softshadow: 0 10px 28px rgba(0,0,0,.08);
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:var(--bg);
    }
    .topbar{ background:var(--blue); color:#fff; padding:18px 20px; }
    .topbarInner{
      max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:16px;
    }
    .brand{ font-weight:900; letter-spacing:.2px; font-size:20px; }
    .topActions{ display:flex; align-items:center; gap:10px; font-weight:700; }
    .pill{
      border:1px solid rgba(255,255,255,.35);
      border-radius:999px;
      padding:8px 12px;
      background:transparent;
      color:#fff;
      font-weight:800;
      cursor:pointer;
    }
    .pill.white{ background:#fff; color:var(--blue); border-color:#fff; }

    .hero{
      background:linear-gradient(180deg,var(--blue) 0%, var(--blue2) 100%);
      color:#fff;
      padding:34px 20px 54px;
      position:relative;
    }
    .wrap{ max-width:1100px; margin:0 auto; }
    .hero h1{ margin:0; font-size:56px; letter-spacing:-.6px; line-height:1.02; }
    .hero p{ margin:10px 0 0; font-size:18px; color:rgba(255,255,255,.88); max-width:720px; }

    .searchbar{
      margin-top:18px;
      background:var(--yellow);
      border-radius:18px;
      padding:4px;
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1.8fr .7fr .7fr .38fr;
      gap:4px;
      align-items:stretch;
    }
    .field{
      background:#fff;
      border-radius:14px;
      padding:12px 14px;
      display:flex;
      gap:10px;
      align-items:flex-start;
      min-height:74px;
      position:relative;
    }
    .icon{
      width:26px; height:26px; display:flex; align-items:center; justify-content:center;
      margin-top:6px; opacity:.75; font-weight:900;
    }
    .label{ font-size:14px; color:var(--muted); font-weight:800; margin-bottom:6px; }
    input, select{
      width:100%;
      border:none;
      outline:none;
      font-size:18px;
      font-weight:800;
      color:var(--text);
      background:transparent;
    }
    select{ padding-right:10px; cursor:pointer; }

    .btn{
      background:var(--blue);
      color:#fff;
      border:none;
      border-radius:14px;
      font-size:18px;
      font-weight:900;
      cursor:pointer;
    }
    .btn:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
    .btn:hover{ filter:brightness(1.05); }

    /* Booking-like dropdown */
    .comboPanel{
      position:absolute;
      left:8px;
      right:8px;
      top:82px;
      background:#fff;
      border-radius:16px;
      box-shadow: var(--softshadow);
      border: 1px solid rgba(0,0,0,.08);
      overflow:hidden;
      display:none;
      z-index:30;
    }
    .panelHeader{
      padding:12px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .panelTitle{
      font-weight:1000;
      color:#111827;
    }
    .panelHint{
      font-weight:900;
      color:var(--muted);
      font-size:12px;
    }
    .panelList{
      max-height:320px;
      overflow:auto;
      border-top:1px solid rgba(0,0,0,.06);
    }
    .panelItem{
      display:flex;
      gap:12px;
      padding:12px 14px;
      align-items:center;
      border-top:1px solid rgba(0,0,0,.06);
      cursor:pointer;
    }
    .panelItem:first-child{ border-top:none; }
    .panelItem:hover{ background:#f6f7fb; }
    .panelItem.active{ background:#eef2ff; }
    .badge{
      width:36px; height:36px; border-radius:999px;
      background:#f3f4f6;
      display:flex; align-items:center; justify-content:center;
      font-weight:1000; opacity:.8; flex:0 0 auto;
    }
    .pTitle{ font-weight:1000; font-size:16px; }
    .pSub{ color:var(--muted); font-weight:850; margin-top:2px; font-size:13px; }

    .errorLine{
      margin-top:8px;
      font-weight:900;
      color: #fff;
      background: rgba(180, 35, 24, .28);
      border:1px solid rgba(255,255,255,.25);
      padding:10px 12px;
      border-radius:12px;
      display:none;
    }

    .section{ padding:26px 20px; }
    .cards4{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:16px;
      margin-top:18px;
    }
    .miniCard{
      background:#fff;
      border-radius:16px;
      border:1px solid rgba(0,0,0,.06);
      padding:16px;
      box-shadow: 0 8px 18px rgba(0,0,0,.06);
    }
    .miniTitle{ font-weight:1000; }
    .miniText{ margin-top:6px; color:var(--muted); font-weight:800; line-height:1.35; }

    .resultsTitle{ margin:10px 0 0; font-size:34px; font-weight:1000; letter-spacing:-.4px; }
    #results{ display:none; margin-top:12px; }

    .resultCard{
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(0,0,0,.06);
      box-shadow: 0 12px 22px rgba(0,0,0,.06);
      padding:18px;
      margin:14px 0;
      cursor:pointer;
      transition: transform .08s ease;
    }
    .resultCard:hover{ transform: translateY(-1px); }
    .resultTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:14px; }
    .resultName{ font-size:28px; font-weight:1000; letter-spacing:-.2px; margin:0; }
    .match{ font-weight:1000; color:var(--blue); font-size:22px; white-space:nowrap; margin-top:2px; }
    .tags{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .tag{
      border:1px solid rgba(0,0,0,.10);
      background:#f7f8fb;
      border-radius:999px;
      padding:7px 10px;
      font-weight:1000;
      color:#334155;
      font-size:14px;
    }
    .why{ margin-top:12px; color:#111827; font-weight:1000; }
    ul{ margin:8px 0 0 18px; color:#475569; font-weight:800; line-height:1.45; }

    .details{ display:none; margin-top:14px; padding-top:14px; border-top:1px solid rgba(0,0,0,.08); }
    .resultCard.expanded .details{ display:block; }

    .detailsGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px 16px;
      margin-top:10px;
    }
    .detailItem{
      background:#f7f8fb;
      border:1px solid rgba(0,0,0,.06);
      border-radius:14px;
      padding:12px 12px;
      font-size:14px;
    }
    .detailTitle{ font-weight:1000; margin-bottom:4px; color:#0f172a; }
    .detailText{ color:#334155; font-weight:850; line-height:1.35; }

    .moreRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top:12px;
    }
    .hint{ opacity:.65; font-weight:1000; }
    .pillBtn{
      border:1px solid rgba(0,0,0,.12);
      background:#fff;
      padding:8px 10px;
      border-radius:999px;
      font-weight:1000;
      cursor:pointer;
    }
    .bottomRow{ display:flex; gap:10px; margin:16px 0 30px; }
    .secondaryBtn{
      background:#fff;
      border:1px solid rgba(0,0,0,.12);
      border-radius:14px;
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
    }

    @media (max-width: 980px){
      .searchbar{ grid-template-columns: 1fr; }
      .cards4{ grid-template-columns: 1fr; }
      .hero h1{ font-size:42px; }
      .detailsGrid{ grid-template-columns: 1fr; }
      .comboPanel{ top:76px; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbarInner">
      <div class="brand">CareerPicker</div>
      <div class="topActions">
        <span style="opacity:.9;font-weight:900">AUD</span>
        <button class="pill">Register</button>
        <button class="pill white">Sign in</button>
      </div>
    </div>
  </div>

  <div class="hero">
    <div class="wrap">
      <h1>Find your next career</h1>
      <p>Pick a real job from the dropdown (type to search, scroll to browse). If it‚Äôs not in the list, Search won‚Äôt run.</p>

      <div class="searchbar">
        <!-- Job combobox -->
        <div class="field" id="jobField">
          <div class="icon">üíº</div>
          <div style="width:100%">
            <div class="label">Choose a profession</div>
            <input id="jobInput" autocomplete="off" placeholder="Start typing‚Ä¶ (e.g. Lawyer, Software Engineer)" />
          </div>

          <div class="comboPanel" id="comboPanel">
            <div class="panelHeader">
              <div class="panelTitle" id="panelTitle">All professions</div>
              <div class="panelHint">Type to filter ‚Ä¢ Scroll ‚Ä¢ Enter to select</div>
            </div>
            <div class="panelList" id="panelList"></div>
          </div>
        </div>

        <!-- ATAR/GPA -->
        <div class="field">
          <div class="icon">üßæ</div>
          <div style="width:100%">
            <div class="label">ATAR / GPA</div>
            <input id="score" type="number" min="0" max="100" value="70" />
          </div>
        </div>

        <!-- Salary -->
        <div class="field">
          <div class="icon">üí∞</div>
          <div style="width:100%">
            <div class="label">Salary goal</div>
            <select id="salary">
              <option value="low">Low</option>
              <option value="mid" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>

        <!-- Search -->
        <button class="btn" id="searchBtn" disabled>Search</button>
      </div>

      <div class="errorLine" id="errorLine">
        Please select a real job from the dropdown list (type to search, then click one).
      </div>
    </div>
  </div>

  <div class="section">
    <div class="wrap">
      <div class="cards4">
        <div class="miniCard">
          <div class="miniTitle">Real jobs only</div>
          <div class="miniText">Search only runs when you pick a job that exists in the list.</div>
        </div>
        <div class="miniCard">
          <div class="miniTitle">Scroll + type</div>
          <div class="miniText">Use the dropdown like Booking.com: type to filter or scroll manually.</div>
        </div>
        <div class="miniCard">
          <div class="miniTitle">Shortlist actually matches</div>
          <div class="miniText">Your shortlist is based on your chosen profession + related careers.</div>
        </div>
        <div class="miniCard">
          <div class="miniTitle">Click for detail</div>
          <div class="miniText">Click any shortlist card to expand (subjects, pathway, steps).</div>
        </div>
      </div>

      <div class="resultsTitle">Your shortlist</div>
      <div id="results"></div>

      <div class="bottomRow">
        <button class="secondaryBtn" id="resetBtn">Reset</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // ======================
    // Categories (clusters)
    // ======================
    const CATEGORIES = [
      {
        id: "law",
        name: "Law",
        tags: ["Lawyer","Paralegal","Legal Aid","Corporate Law"],
        why: [
          "Strong match if you like debating, reading, writing, and rules.",
          "Entry depends on ATAR + university pathway (or related degrees).",
          "Progression improves with experience and specialization."
        ],
        details: {
          subjects: "English, Legal Studies, Humanities, Business/Accounting",
          pathways: "Uni law (or related) ‚Üí clerkships/grad roles ‚Üí specialization",
          skills: "Writing, analysis, public speaking, precision, ethics",
          salary: "Varies a lot by role/firm; can grow strongly with experience.",
          next: "Debating club, Legal Studies, read case summaries, talk to a lawyer."
        }
      },
      {
        id: "policing",
        name: "Justice & Policing",
        tags: ["Police","Detective","Corrections","Forensics"],
        why: [
          "Fits if you like structure + public service and working with people.",
          "Communication + resilience matter a lot.",
          "Clear training pathways for many roles."
        ],
        details: {
          subjects: "English, Psychology, Health/PE, Science",
          pathways: "Recruit training ‚Üí experience ‚Üí specialist units (optional)",
          skills: "Communication, decision-making, teamwork, resilience",
          salary: "Stable progression (varies by state/role).",
          next: "Check entry requirements, fitness routine, volunteering/community work."
        }
      },
      {
        id: "government",
        name: "Policy & Government",
        tags: ["Policy","Compliance","Regulation","Public Service"],
        why: [
          "Great if you like systems, fairness, and large-scale impact.",
          "Good stability + many role types.",
          "Can combine with business/law."
        ],
        details: {
          subjects: "English, Humanities, Economics, Legal Studies",
          pathways: "Uni/TAFE ‚Üí grad programs ‚Üí policy/ops specializations",
          skills: "Research, writing, stakeholder management, systems thinking",
          salary: "Stable ranges; higher with seniority and specialization.",
          next: "Practice writing briefs, join leadership roles, read gov role descriptions."
        }
      },
      {
        id: "tech",
        name: "Technology & Software",
        tags: ["Software","Cyber","Data","Cloud"],
        why: [
          "Good for analytical problem-solving and building things.",
          "Many pathways (uni/TAFE/self-taught).",
          "Specialization makes a big difference."
        ],
        details: {
          subjects: "Maths, Digital Tech, Software Dev, Physics",
          pathways: "Uni/TAFE/self-taught ‚Üí portfolio ‚Üí junior role ‚Üí specialization",
          skills: "Coding, debugging, systems thinking, communication",
          salary: "Often strong with experience; varies by specialty.",
          next: "Build 3 mini projects, learn Git, pick JS or Python, make a portfolio."
        }
      },
      {
        id: "health",
        name: "Healthcare",
        tags: ["Nursing","Allied Health","Medicine","Psychology"],
        why: [
          "Fits if you like helping people + science.",
          "Some roles are competitive (depends on pathway).",
          "Meaningful work and clear training routes."
        ],
        details: {
          subjects: "Biology, Chemistry, English, Maths",
          pathways: "Uni/TAFE ‚Üí placements ‚Üí registration ‚Üí specialization",
          skills: "Empathy, teamwork, communication, stamina",
          salary: "Stable with clear progression in many roles.",
          next: "Check prerequisites, volunteer, choose sciences early."
        }
      },
      {
        id: "business",
        name: "Business & Management",
        tags: ["Business Analyst","Project","Marketing","Ops"],
        why: [
          "Strong if you like planning, leading, persuading, and improving systems.",
          "Flexible across industries.",
          "Progression improves with experience and results."
        ],
        details: {
          subjects: "Business, Economics, Accounting, English",
          pathways: "Uni/TAFE ‚Üí grad roles ‚Üí specialization (BA/PM/Marketing/etc.)",
          skills: "Communication, analysis, planning, negotiation",
          salary: "Can grow strongly with responsibility and outcomes.",
          next: "Run small projects, learn Excel, join leadership roles, read case studies."
        }
      },
      {
        id: "creative",
        name: "Creative & Media",
        tags: ["UI/UX","Graphic","Video","Content"],
        why: [
          "Portfolio matters for many roles.",
          "Great if you like design + storytelling.",
          "Skills + niche can beat credentials."
        ],
        details: {
          subjects: "Art, Media, English, Digital Tech",
          pathways: "Portfolio ‚Üí uni/short courses ‚Üí internships ‚Üí niche specialization",
          skills: "Taste, iteration, storytelling, tools, feedback",
          salary: "Varies widely; can grow with niche + strong portfolio.",
          next: "Build a portfolio, redesign apps, learn Figma/Adobe, post work weekly."
        }
      },
      {
        id: "engineering",
        name: "Engineering",
        tags: ["Civil","Mechanical","Electrical","Mechatronics"],
        why: [
          "Great for maths + physics + building systems.",
          "Stable industries and real-world impact.",
          "Specialization changes your day-to-day work a lot."
        ],
        details: {
          subjects: "Maths Methods/Specialist, Physics, Chemistry",
          pathways: "Uni engineering ‚Üí placements ‚Üí graduate engineer ‚Üí chartered/specialist",
          skills: "Maths, modeling, design, teamwork, safety mindset",
          salary: "Often strong, especially in specialized areas.",
          next: "Choose advanced maths, do STEM projects, join robotics/engineering clubs."
        }
      },
      {
        id: "education",
        name: "Education",
        tags: ["Teacher","Tutor","Early Childhood","Education Support"],
        why: [
          "Great if you like explaining and helping others learn.",
          "Clear qualifications and practical placements.",
          "Strong long-term stability."
        ],
        details: {
          subjects: "English, your favorite specialty subjects",
          pathways: "Uni teaching degree ‚Üí placements ‚Üí registration",
          skills: "Communication, patience, structure, creativity",
          salary: "Stable with progression options (varies by state/sector).",
          next: "Volunteer tutoring, practice explaining concepts, check teaching prerequisites."
        }
      }
    ];

    // Related categories (so shortlist matches the job)
    const RELATED = {
      law:        ["government","business","policing"],
      policing:   ["government","law","health"],
      government: ["law","business","tech"],
      tech:       ["engineering","business","creative"],
      health:     ["policing","education","government"],
      business:   ["government","tech","law"],
      creative:   ["tech","business","education"],
      engineering:["tech","business","government"],
      education:  ["health","government","creative"]
    };

    // ======================
    // Jobs list (REAL titles)
    // Add more anytime
    // ======================
    const JOBS = [
      // Law
      { title:"Lawyer", category:"law", sub:"Court ‚Ä¢ contracts ‚Ä¢ advice" },
      { title:"Paralegal", category:"law", sub:"Legal support ‚Ä¢ documents" },
      { title:"Solicitor", category:"law", sub:"Client advice ‚Ä¢ legal matters" },
      { title:"Barrister", category:"law", sub:"Court advocacy ‚Ä¢ litigation" },
      { title:"Legal Assistant", category:"law", sub:"Admin ‚Ä¢ filings ‚Ä¢ support" },
      { title:"Compliance Officer", category:"government", sub:"Rules ‚Ä¢ audits ‚Ä¢ risk" },
      { title:"Contracts Manager", category:"business", sub:"Negotiation ‚Ä¢ agreements" },

      // Justice / Policing
      { title:"Police Officer", category:"policing", sub:"Public safety ‚Ä¢ response" },
      { title:"Detective", category:"policing", sub:"Investigations ‚Ä¢ evidence" },
      { title:"Forensic Scientist", category:"policing", sub:"Lab work ‚Ä¢ analysis" },
      { title:"Corrections Officer", category:"policing", sub:"Custody ‚Ä¢ safety" },
      { title:"Security Officer", category:"policing", sub:"Protection ‚Ä¢ monitoring" },

      // Government / Policy
      { title:"Policy Officer", category:"government", sub:"Programs ‚Ä¢ impact ‚Ä¢ briefs" },
      { title:"Public Servant", category:"government", sub:"Gov operations ‚Ä¢ services" },
      { title:"Regulatory Officer", category:"government", sub:"Standards ‚Ä¢ enforcement" },
      { title:"Town Planner", category:"government", sub:"Planning ‚Ä¢ permits ‚Ä¢ cities" },

      // Tech
      { title:"Software Engineer", category:"tech", sub:"Build apps ‚Ä¢ systems" },
      { title:"Web Developer", category:"tech", sub:"Websites ‚Ä¢ frontend/backend" },
      { title:"Mobile App Developer", category:"tech", sub:"iOS/Android apps" },
      { title:"Data Analyst", category:"tech", sub:"Insights ‚Ä¢ dashboards" },
      { title:"Data Scientist", category:"tech", sub:"ML ‚Ä¢ modeling" },
      { title:"Cybersecurity Analyst", category:"tech", sub:"Security ‚Ä¢ defense" },
      { title:"Cloud Engineer", category:"tech", sub:"AWS/Azure ‚Ä¢ infrastructure" },
      { title:"DevOps Engineer", category:"tech", sub:"CI/CD ‚Ä¢ automation" },
      { title:"QA Engineer", category:"tech", sub:"Testing ‚Ä¢ quality" },
      { title:"Game Developer", category:"tech", sub:"Games ‚Ä¢ engines" },
      { title:"AI Engineer", category:"tech", sub:"Models ‚Ä¢ AI products" },

      // Engineering
      { title:"Civil Engineer", category:"engineering", sub:"Structures ‚Ä¢ infrastructure" },
      { title:"Mechanical Engineer", category:"engineering", sub:"Machines ‚Ä¢ design" },
      { title:"Electrical Engineer", category:"engineering", sub:"Circuits ‚Ä¢ power" },
      { title:"Software Engineer (Embedded)", category:"engineering", sub:"Hardware + software" },
      { title:"Mechatronics Engineer", category:"engineering", sub:"Robotics ‚Ä¢ automation" },
      { title:"Architect", category:"engineering", sub:"Buildings ‚Ä¢ design" },

      // Health
      { title:"Nurse", category:"health", sub:"Care ‚Ä¢ clinical work" },
      { title:"Doctor", category:"health", sub:"Diagnosis ‚Ä¢ treatment" },
      { title:"Psychologist", category:"health", sub:"Mental health ‚Ä¢ therapy" },
      { title:"Physiotherapist", category:"health", sub:"Rehab ‚Ä¢ movement" },
      { title:"Pharmacist", category:"health", sub:"Medicines ‚Ä¢ advice" },
      { title:"Dentist", category:"health", sub:"Dental care ‚Ä¢ procedures" },

      // Business
      { title:"Business Analyst", category:"business", sub:"Requirements ‚Ä¢ analysis" },
      { title:"Project Manager", category:"business", sub:"Planning ‚Ä¢ delivery" },
      { title:"Product Manager", category:"business", sub:"Strategy ‚Ä¢ roadmap" },
      { title:"Accountant", category:"business", sub:"Finance ‚Ä¢ reporting" },
      { title:"Financial Analyst", category:"business", sub:"Forecasting ‚Ä¢ valuation" },
      { title:"Marketing Specialist", category:"business", sub:"Growth ‚Ä¢ campaigns" },
      { title:"Sales Representative", category:"business", sub:"Deals ‚Ä¢ relationships" },
      { title:"Operations Manager", category:"business", sub:"Process ‚Ä¢ efficiency" },
      { title:"Human Resources Officer", category:"business", sub:"People ‚Ä¢ hiring" },

      // Creative
      { title:"Graphic Designer", category:"creative", sub:"Visual design ‚Ä¢ branding" },
      { title:"UI/UX Designer", category:"creative", sub:"Apps ‚Ä¢ user experience" },
      { title:"Video Editor", category:"creative", sub:"Editing ‚Ä¢ storytelling" },
      { title:"Content Creator", category:"creative", sub:"Content ‚Ä¢ audience" },
      { title:"Photographer", category:"creative", sub:"Photos ‚Ä¢ composition" },

      // Education
      { title:"Teacher (Secondary)", category:"education", sub:"High school teaching" },
      { title:"Teacher (Primary)", category:"education", sub:"Primary teaching" },
      { title:"Early Childhood Educator", category:"education", sub:"Child development" },
      { title:"Tutor", category:"education", sub:"1:1 learning support" }
    ];

    // ======================
    // UI State
    // ======================
    let selectedJob = null;      // {title, category, sub}
    let filteredJobs = [];
    let activeIndex = -1;

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function categoryIcon(cat){
      const map = {
        law:"‚öñÔ∏è", policing:"üöì", government:"üèõÔ∏è", tech:"üíª",
        engineering:"üõ†Ô∏è", health:"ü©∫", business:"üìà", creative:"üé®", education:"üìö"
      };
      return map[cat] || "üíº";
    }

    function getCategory(catId){
      return CATEGORIES.find(c => c.id === catId);
    }

    // ======================
    // Combobox dropdown logic
    // ======================
    function showPanel(){
      $("comboPanel").style.display = "block";
    }
    function hidePanel(){
      $("comboPanel").style.display = "none";
      activeIndex = -1;
      renderPanelList(); // clears highlight
    }

    function setError(on){
      $("errorLine").style.display = on ? "block" : "none";
    }

    function setSelected(job){
      selectedJob = job;
      $("jobInput").value = job.title;
      $("searchBtn").disabled = false;
      setError(false);
      hidePanel();
    }

    function filterJobs(query){
      const q = (query || "").trim().toLowerCase();
      if (!q) return JOBS.slice();

      return JOBS.filter(j => {
        const t = j.title.toLowerCase();
        const s = (j.sub || "").toLowerCase();
        return t.includes(q) || s.includes(q);
      });
    }

    function renderPanelList(){
      const list = $("panelList");
      list.innerHTML = "";

      const items = filteredJobs;

      if (!items.length){
        const empty = document.createElement("div");
        empty.className = "panelItem";
        empty.style.cursor = "default";
        empty.innerHTML = `
          <div class="badge">‚ùå</div>
          <div>
            <div class="pTitle">No match</div>
            <div class="pSub">Try a different spelling, or scroll the list.</div>
          </div>
        `;
        list.appendChild(empty);
        return;
      }

      items.forEach((job, idx) => {
        const div = document.createElement("div");
        div.className = "panelItem" + (idx === activeIndex ? " active" : "");
        div.innerHTML = `
          <div class="badge">${categoryIcon(job.category)}</div>
          <div>
            <div class="pTitle">${escapeHtml(job.title)}</div>
            <div class="pSub">${escapeHtml(getCategory(job.category)?.name || "")} ‚Ä¢ ${escapeHtml(job.sub || "")}</div>
          </div>
        `;
        div.addEventListener("mousedown", (e) => {
          // mousedown (not click) avoids blur closing before selection
          e.preventDefault();
          setSelected(job);
        });
        list.appendChild(div);
      });
    }

    function ensureActiveVisible(){
      const list = $("panelList");
      const item = list.children[activeIndex];
      if (!item) return;

      const itemTop = item.offsetTop;
      const itemBottom = itemTop + item.offsetHeight;
      const viewTop = list.scrollTop;
      const viewBottom = viewTop + list.clientHeight;

      if (itemTop < viewTop) list.scrollTop = itemTop;
      else if (itemBottom > viewBottom) list.scrollTop = itemBottom - list.clientHeight;
    }

    function updatePanelTitle(){
      $("panelTitle").textContent = filteredJobs.length ? "Professions" : "No match";
    }

    function refreshPanel(){
      filteredJobs = filterJobs($("jobInput").value);
      updatePanelTitle();
      renderPanelList();
    }

    function validateExactJob(){
      const val = $("jobInput").value.trim().toLowerCase();
      if (!val) return null;
      const exact = JOBS.find(j => j.title.toLowerCase() === val);
      return exact || null;
    }

    // ======================
    // Shortlist logic: based on selected job category
    // ======================
    function scoreCategory(catId, atar, salary, primaryCat){
      // base ranking: primary cat highest, then related, then others
      let s = 10;

      if (catId === primaryCat) s += 100;
      else if ((RELATED[primaryCat] || []).includes(catId)) s += 70;
      else s += 30;

      const g = Number(atar) || 0;

      // ATAR influence (simple)
      if (["law","health","engineering"].includes(catId)){
        s += (g >= 85 ? 15 : g >= 70 ? 8 : 2);
      } else {
        s += (g >= 70 ? 8 : 4);
      }

      // salary influence
      if (salary === "high"){
        if (["tech","engineering","law","business"].includes(catId)) s += 10;
        else s += 4;
      } else if (salary === "low"){
        if (["government","policing","education","health"].includes(catId)) s += 8;
      }

      return s;
    }

    function toPercent(rankIndex, topScore, score){
      const raw = Math.max(0, Math.min(100, Math.round((score / topScore) * 100)));
      if (rankIndex === 0) return Math.max(raw, 72);
      if (rankIndex === 1) return Math.min(Math.max(raw, 55), 86);
      return Math.min(Math.max(raw, 45), 78);
    }

    function renderResults(sorted, primaryJobTitle){
      const results = $("results");
      results.style.display = "block";
      results.innerHTML = "";

      const top3 = sorted.slice(0,3);
      const topScore = top3[0].score;

      top3.forEach((item, idx) => {
        const cat = getCategory(item.catId);
        const pct = toPercent(idx, topScore, item.score);

        const card = document.createElement("div");
        card.className = "resultCard";
        card.innerHTML = `
          <div class="resultTop">
            <div>
              <h3 class="resultName">${idx+1}. ${escapeHtml(cat.name)}</h3>
              <div class="tags">
                ${cat.tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("")}
              </div>
            </div>
            <div class="match">${pct}% match</div>
          </div>

          <div class="why">Why it fits:</div>
          <ul>
            <li><b>Your chosen job:</b> ${escapeHtml(primaryJobTitle)}</li>
            ${cat.why.map(x => `<li>${escapeHtml(x)}</li>`).join("")}
          </ul>

          <div class="moreRow">
            <span class="hint">Click to expand</span>
            <button class="pillBtn" data-toggle-details>More details</button>
          </div>

          <div class="details">
            <div class="detailsGrid">
              <div class="detailItem">
                <div class="detailTitle">Best subjects</div>
                <div class="detailText">${escapeHtml(cat.details.subjects)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Typical pathways</div>
                <div class="detailText">${escapeHtml(cat.details.pathways)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Key skills</div>
                <div class="detailText">${escapeHtml(cat.details.skills)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Salary notes</div>
                <div class="detailText">${escapeHtml(cat.details.salary)}</div>
              </div>
              <div class="detailItem" style="grid-column:1/-1;">
                <div class="detailTitle">Next steps (this week)</div>
                <div class="detailText">${escapeHtml(cat.details.next)}</div>
              </div>
            </div>
          </div>
        `;
        results.appendChild(card);
      });

      results.scrollIntoView({ behavior:"smooth", block:"start" });
    }

    function runSearch(){
      // Must be exact match from list
      const exact = validateExactJob();
      if (!exact){
        $("searchBtn").disabled = true;
        setError(true);
        $("results").style.display = "none";
        return;
      }

      // use exact as selected
      selectedJob = exact;
      $("searchBtn").disabled = false;
      setError(false);

      const atar = $("score").value;
      const salary = $("salary").value;

      const primaryCat = selectedJob.category;

      const scored = CATEGORIES.map(c => ({
        catId: c.id,
        score: scoreCategory(c.id, atar, salary, primaryCat)
      })).sort((a,b) => b.score - a.score);

      renderResults(scored, selectedJob.title);
    }

    // ======================
    // Events
    // ======================
    // Open dropdown
    $("jobInput").addEventListener("focus", () => {
      refreshPanel();
      showPanel();
    });

    // Type to filter
    $("jobInput").addEventListener("input", () => {
      // typing invalidates previous selection unless exact
      const exact = validateExactJob();
      if (exact){
        selectedJob = exact;
        $("searchBtn").disabled = false;
        setError(false);
      } else {
        selectedJob = null;
        $("searchBtn").disabled = true;
      }
      refreshPanel();
      showPanel();
    });

    // Keyboard nav (Arrow/Enter/Escape)
    $("jobInput").addEventListener("keydown", (e) => {
      if ($("comboPanel").style.display !== "block") return;

      if (e.key === "ArrowDown"){
        e.preventDefault();
        if (!filteredJobs.length) return;
        activeIndex = Math.min(filteredJobs.length - 1, activeIndex + 1);
        renderPanelList();
        ensureActiveVisible();
      } else if (e.key === "ArrowUp"){
        e.preventDefault();
        if (!filteredJobs.length) return;
        activeIndex = Math.max(0, activeIndex - 1);
        renderPanelList();
        ensureActiveVisible();
      } else if (e.key === "Enter"){
        // If highlight, pick it
        const pick = filteredJobs[activeIndex];
        if (pick){
          e.preventDefault();
          setSelected(pick);
        } else {
          // if no highlight, allow exact match
          const exact = validateExactJob();
          if (exact){
            e.preventDefault();
            setSelected(exact);
          }
        }
      } else if (e.key === "Escape"){
        hidePanel();
      }
    });

    // Clicking outside closes dropdown
    document.addEventListener("mousedown", (e) => {
      const field = $("jobField");
      if (!field.contains(e.target)) hidePanel();
    });

    // Search button
    $("searchBtn").addEventListener("click", runSearch);

    // Reset
    $("resetBtn").addEventListener("click", () => {
      $("jobInput").value = "";
      $("score").value = 70;
      $("salary").value = "mid";
      selectedJob = null;
      $("searchBtn").disabled = true;
      setError(false);
      $("results").style.display = "none";
      $("results").innerHTML = "";
      window.scrollTo({ top: 0, behavior:"smooth" });
    });

    // Expand/collapse details
    document.addEventListener("click", (e) => {
      const toggleBtn = e.target.closest("[data-toggle-details]");
      if (toggleBtn){
        e.preventDefault();
        const card = toggleBtn.closest(".resultCard");
        if (card) card.classList.toggle("expanded");
        return;
      }
      const card = e.target.closest(".resultCard");
      if (!card) return;
      if (e.target.closest("a, button, input, select, textarea")) return;
      card.classList.toggle("expanded");
    });

    // Initial list
    filteredJobs = JOBS.slice();
    renderPanelList();
  </script>
</body>
</html>
