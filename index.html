<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CareerPicker</title>

  <style>
    :root{
      --blue:#003b95;
      --blue2:#002f7a;
      --yellow:#febb02;
      --bg:#f5f7fb;
      --text:#111827;
      --muted:#6b7280;
      --shadow: 0 18px 40px rgba(0,0,0,.12);
      --softshadow: 0 10px 28px rgba(0,0,0,.08);
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:var(--bg);
    }

    /* Top bar */
    .topbar{ background:var(--blue); color:#fff; padding:18px 20px; }
    .topbarInner{
      max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:16px;
    }
    .brand{ font-weight:900; letter-spacing:.2px; font-size:20px; }
    .topActions{ display:flex; align-items:center; gap:10px; font-weight:700; }
    .pill{
      border:1px solid rgba(255,255,255,.35);
      border-radius:999px;
      padding:8px 12px;
      background:transparent;
      color:#fff;
      font-weight:800;
      cursor:pointer;
    }
    .pill.white{ background:#fff; color:var(--blue); border-color:#fff; }

    /* Hero */
    .hero{
      background:linear-gradient(180deg,var(--blue) 0%, var(--blue2) 100%);
      color:#fff;
      padding:34px 20px 54px;
      position:relative;
    }
    .wrap{ max-width:1100px; margin:0 auto; }
    .hero h1{ margin:0; font-size:56px; letter-spacing:-.6px; line-height:1.02; }
    .hero p{ margin:10px 0 0; font-size:18px; color:rgba(255,255,255,.88); max-width:900px; }

    /* Search bar */
    .searchbar{
      margin-top:18px;
      background:var(--yellow);
      border-radius:18px;
      padding:4px;
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1.8fr .7fr .7fr .38fr;
      gap:4px;
      align-items:stretch;
    }
    .field{
      background:#fff;
      border-radius:14px;
      padding:12px 14px;
      display:flex;
      gap:10px;
      align-items:flex-start;
      min-height:74px;
      position:relative;
    }
    .icon{
      width:26px; height:26px; display:flex; align-items:center; justify-content:center;
      margin-top:6px; opacity:.75; font-weight:900;
    }
    .label{ font-size:14px; color:var(--muted); font-weight:800; margin-bottom:6px; }
    input, select{
      width:100%;
      border:none;
      outline:none;
      font-size:18px;
      font-weight:800;
      color:var(--text);
      background:transparent;
    }
    select{ padding-right:10px; cursor:pointer; }

    .btn{
      background:var(--blue);
      color:#fff;
      border:none;
      border-radius:14px;
      font-size:18px;
      font-weight:900;
      cursor:pointer;
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }
    .btn:hover{ filter:brightness(1.05); }

    /* Booking-like dropdown panel */
    .comboPanel{
      position:absolute;
      left:8px;
      right:8px;
      top:82px;
      background:#fff;
      border-radius:16px;
      box-shadow: var(--softshadow);
      border: 1px solid rgba(0,0,0,.08);
      overflow:hidden;
      display:none;
      z-index:30;

      /* IMPORTANT: force dark text (fixes white text issue) */
      color: var(--text);
    }
    .panelHeader{
      padding:12px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:#fff;
      color:var(--text);
    }
    .panelTitle{ font-weight:1000; color:var(--text); }
    .panelHint{ font-weight:900; color:var(--muted); font-size:12px; }
    .panelList{
      max-height:340px;
      overflow:auto;
      border-top:1px solid rgba(0,0,0,.06);
      background:#fff;
      color:var(--text);
    }
    .panelItem{
      display:flex;
      gap:12px;
      padding:12px 14px;
      align-items:center;
      border-top:1px solid rgba(0,0,0,.06);
      cursor:pointer;
      background:#fff;
      color:var(--text);
    }
    .panelItem:first-child{ border-top:none; }
    .panelItem:hover{ background:#f6f7fb; }
    .panelItem.active{ background:#eef2ff; }
    .badge{
      width:36px; height:36px; border-radius:999px;
      background:#f3f4f6;
      display:flex; align-items:center; justify-content:center;
      font-weight:1000; opacity:.95; flex:0 0 auto;
      color: var(--text);
    }
    .pTitle{ font-weight:1000; font-size:16px; color:var(--text); }
    .pSub{ color:var(--muted); font-weight:850; margin-top:2px; font-size:13px; }

    .errorLine{
      margin-top:8px;
      font-weight:900;
      color: #fff;
      background: rgba(180, 35, 24, .28);
      border:1px solid rgba(255,255,255,.25);
      padding:10px 12px;
      border-radius:12px;
      display:none;
    }
    .infoLine{
      margin-top:10px;
      font-weight:900;
      color:#fff;
      background: rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      padding:10px 12px;
      border-radius:12px;
    }

    /* Results section */
    .section{ padding:26px 20px; }
    .resultsTitle{ margin:10px 0 0; font-size:34px; font-weight:1000; letter-spacing:-.4px; }
    #results{ display:none; margin-top:12px; }

    .resultCard{
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(0,0,0,.06);
      box-shadow: 0 12px 22px rgba(0,0,0,.06);
      padding:18px;
      margin:14px 0;
      cursor:pointer;
      transition: transform .08s ease;
    }
    .resultCard:hover{ transform: translateY(-1px); }
    .resultTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:14px; }
    .resultName{ font-size:28px; font-weight:1000; letter-spacing:-.2px; margin:0; }
    .match{ font-weight:1000; color:var(--blue); font-size:22px; white-space:nowrap; margin-top:2px; }
    .tags{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .tag{
      border:1px solid rgba(0,0,0,.10);
      background:#f7f8fb;
      border-radius:999px;
      padding:7px 10px;
      font-weight:1000;
      color:#334155;
      font-size:14px;
    }
    .why{ margin-top:12px; color:#111827; font-weight:1000; }
    ul{ margin:8px 0 0 18px; color:#475569; font-weight:800; line-height:1.45; }

    .details{ display:none; margin-top:14px; padding-top:14px; border-top:1px solid rgba(0,0,0,.08); }
    .resultCard.expanded .details{ display:block; }

    .detailsGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px 16px;
      margin-top:10px;
    }
    .detailItem{
      background:#f7f8fb;
      border:1px solid rgba(0,0,0,.06);
      border-radius:14px;
      padding:12px 12px;
      font-size:14px;
    }
    .detailTitle{ font-weight:1000; margin-bottom:4px; color:#0f172a; }
    .detailText{ color:#334155; font-weight:850; line-height:1.35; }

    .moreRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top:12px;
    }
    .hint{ opacity:.65; font-weight:1000; }
    .pillBtn{
      border:1px solid rgba(0,0,0,.12);
      background:#fff;
      padding:8px 10px;
      border-radius:999px;
      font-weight:1000;
      cursor:pointer;
    }
    .bottomRow{ display:flex; gap:10px; margin:16px 0 30px; }
    .secondaryBtn{
      background:#fff;
      border:1px solid rgba(0,0,0,.12);
      border-radius:14px;
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
    }

    /* Start screen modal */
    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:9999;
      padding:18px;
    }
    .modal{
      width:min(720px, 100%);
      background:#fff;
      border-radius:22px;
      box-shadow: var(--shadow);
      border:1px solid rgba(0,0,0,.08);
      overflow:hidden;
    }
    .modalTop{
      background: linear-gradient(180deg, var(--blue) 0%, var(--blue2) 100%);
      color:#fff;
      padding:18px 18px 16px;
    }
    .modalTop h2{
      margin:0;
      font-size:28px;
      font-weight:1000;
      letter-spacing:-.2px;
    }
    .modalTop p{
      margin:8px 0 0;
      font-weight:850;
      opacity:.9;
      line-height:1.35;
    }
    .modalBody{ padding:16px 18px 18px; }
    .choiceGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    .choiceBtn{
      border:1px solid rgba(0,0,0,.10);
      background:#fff;
      border-radius:16px;
      padding:14px 14px;
      cursor:pointer;
      text-align:left;
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
    }
    .choiceBtn:hover{ transform: translateY(-1px); }
    .choiceTitle{ font-weight:1000; font-size:18px; }
    .choiceSub{ margin-top:6px; color:var(--muted); font-weight:850; }
    .finePrint{
      margin-top:12px;
      color:var(--muted);
      font-weight:850;
      font-size:13px;
      line-height:1.35;
    }

    @media (max-width: 980px){
      .searchbar{ grid-template-columns: 1fr; }
      .hero h1{ font-size:42px; }
      .detailsGrid{ grid-template-columns: 1fr; }
      .comboPanel{ top:76px; }
      .choiceGrid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- Start screen -->
  <div class="modalOverlay" id="startModal">
    <div class="modal">
      <div class="modalTop">
        <h2>Start: Are you using ATAR or GPA?</h2>
        <p>
          This decides which score you enter. We‚Äôll only show professions you‚Äôre eligible for at your current score.
          <br/>Example: ‚ÄúDoctor‚Äù won‚Äôt appear unless your score is high enough.
        </p>
      </div>
      <div class="modalBody">
        <div class="choiceGrid">
          <button class="choiceBtn" id="chooseATAR">
            <div class="choiceTitle">ATAR (0‚Äì100)</div>
            <div class="choiceSub">Best for Australian high school planning.</div>
          </button>
          <button class="choiceBtn" id="chooseGPA">
            <div class="choiceTitle">GPA (0‚Äì100)</div>
            <div class="choiceSub">Use this if you‚Äôre treating GPA like a 0‚Äì100 score.</div>
          </button>
        </div>
        <div class="finePrint">
          Note: This is a simple rule-based eligibility filter (not official entry requirements).
          We can refine the cutoffs later per university/state.
        </div>
      </div>
    </div>
  </div>

  <div class="topbar">
    <div class="topbarInner">
      <div class="brand">CareerPicker</div>
      <div class="topActions">
        <span style="opacity:.9;font-weight:900">AUD</span>
        <button class="pill">Register</button>
        <button class="pill white">Sign in</button>
      </div>
    </div>
  </div>

  <div class="hero">
    <div class="wrap">
      <h1>Find your next career</h1>
      <p id="heroSubtitle">
        Pick a real job from the dropdown (type to search, scroll to browse). Jobs are filtered by your ATAR/GPA score.
      </p>

      <div class="searchbar">
        <div class="field" id="jobField">
          <div class="icon">üíº</div>
          <div style="width:100%">
            <div class="label">Choose a profession</div>
            <input id="jobInput" autocomplete="off" placeholder="Start typing‚Ä¶ (e.g. Lawyer, Software Engineer)" />
          </div>

          <div class="comboPanel" id="comboPanel">
            <div class="panelHeader">
              <div class="panelTitle">Professions (eligible)</div>
              <div class="panelHint">Type to filter ‚Ä¢ Scroll ‚Ä¢ Enter to select</div>
            </div>
            <div class="panelList" id="panelList"></div>
          </div>
        </div>

        <div class="field">
          <div class="icon">üßæ</div>
          <div style="width:100%">
            <div class="label" id="scoreLabel">ATAR (0‚Äì100)</div>
            <input id="scoreInput" type="number" min="0" max="100" value="70" />
          </div>
        </div>

        <div class="field">
          <div class="icon">üí∞</div>
          <div style="width:100%">
            <div class="label">Salary goal</div>
            <select id="salary">
              <option value="low">Low</option>
              <option value="mid" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>

        <button class="btn" id="searchBtn" disabled>Search</button>
      </div>

      <div class="errorLine" id="errorLine">
        Please select a job from the dropdown list (only eligible jobs are shown).
      </div>

      <div class="infoLine" id="eligibleInfo">
        Eligible jobs shown for: <span id="modeText">ATAR</span> = <span id="scoreText">70</span>.
        Increase score to unlock more professions.
      </div>
    </div>
  </div>

  <div class="section">
    <div class="wrap">
      <div class="resultsTitle">Your shortlist (Strict mode)</div>
      <div id="results"></div>

      <div class="bottomRow">
        <button class="secondaryBtn" id="resetBtn">Reset</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // ======================
    // Categories
    // ======================
    const CATEGORIES = [
      { id:"law", name:"Law", tags:["Lawyer","Paralegal","Legal Aid","Corporate Law"],
        why:["Best if you like evidence + writing + rules.","Structured thinking: rules, exceptions, application.","High responsibility + precision."],
        details:{
          subjects:"English, Legal Studies, Humanities, Business/Accounting",
          pathways:"Uni law (or related degree) ‚Üí clerkships/grad roles ‚Üí specialize (corporate/criminal/family/etc.)",
          dayToDay:"Reading cases/contracts, writing advice, meetings with clients, preparing documents, negotiating.",
          skills:"Writing, analysis, public speaking, attention to detail, ethics",
          entry:"Often university-based; strong English helps a lot.",
          next:"Legal Studies, debate, read case summaries, talk to a lawyer."
        }
      },
      { id:"policing", name:"Justice & Policing", tags:["Police","Detective","Corrections","Forensics"],
        why:["Structure + public service.","Calm under pressure + communication.","Clear training routes."],
        details:{
          subjects:"English, Psychology, Health/PE, Science",
          pathways:"Recruit training ‚Üí experience ‚Üí specialist units (investigations/forensics/etc.)",
          dayToDay:"Incidents, reports, interviews, teamwork, decisions in real-time.",
          skills:"Communication, resilience, teamwork, fitness",
          entry:"Fitness + background checks + training requirements vary.",
          next:"Check requirements, build fitness, community volunteering."
        }
      },
      { id:"government", name:"Policy & Government", tags:["Policy","Compliance","Regulation","Public Service"],
        why:["Systems + fairness + scale.","Writing + research + organized thinking.","Links well with law/business/tech."],
        details:{
          subjects:"English, Humanities, Economics, Legal Studies",
          pathways:"Uni/TAFE ‚Üí grad programs ‚Üí policy/ops/regulatory specializations",
          dayToDay:"Reading data, writing briefs, stakeholder meetings, improving processes.",
          skills:"Research, writing, stakeholder management, systems thinking",
          entry:"Communication + structure matter a lot.",
          next:"Practice writing briefs, read role descriptions, leadership roles."
        }
      },
      { id:"tech", name:"Technology & Software", tags:["Software","Cyber","Data","Cloud"],
        why:["Build things + solve puzzles.","Fast learners win here.","Portfolio paths exist."],
        details:{
          subjects:"Maths, Digital Tech, Software Dev, Physics",
          pathways:"Uni/TAFE/self-taught ‚Üí portfolio ‚Üí junior role ‚Üí specialization",
          dayToDay:"Coding, debugging, code reviews, planning features, fixing issues, learning tools.",
          skills:"Coding, problem-solving, systems thinking, communication",
          entry:"Portfolio can matter more than scores (role-dependent).",
          next:"Build 3 projects, learn Git, pick JS or Python."
        }
      },
      { id:"health", name:"Healthcare", tags:["Nursing","Allied Health","Medicine","Psychology"],
        why:["Science + helping people.","Responsibility + teamwork.","Clear training routes with placements."],
        details:{
          subjects:"Biology, Chemistry, English, Maths",
          pathways:"Uni/TAFE ‚Üí placements ‚Üí registration ‚Üí specialization",
          dayToDay:"Assessments, care plans, documentation, teamwork, communication.",
          skills:"Empathy, accuracy, communication, stamina",
          entry:"Some pathways are very competitive (medicine/dentistry).",
          next:"Check prerequisites early, pick sciences, volunteer."
        }
      },
      { id:"business", name:"Business & Management", tags:["Business Analyst","Project","Marketing","Ops"],
        why:["Planning + persuasion + improvement.","Teamwork + outcomes.","Flexible across industries."],
        details:{
          subjects:"Business, Economics, Accounting, English",
          pathways:"Uni/TAFE ‚Üí grad roles ‚Üí specialize (BA/PM/Marketing/etc.)",
          dayToDay:"Meetings, planning, docs, analysis, coordination, process improvement.",
          skills:"Communication, analysis, planning, negotiation",
          entry:"Projects/internships are huge.",
          next:"Run small projects, learn Excel, practice presenting."
        }
      },
      { id:"creative", name:"Creative & Media", tags:["UI/UX","Graphic","Video","Content"],
        why:["Design + storytelling.","Portfolio is key.","Self-driven practice matters."],
        details:{
          subjects:"Art, Media, English, Digital Tech",
          pathways:"Portfolio ‚Üí courses ‚Üí internships ‚Üí niche specialization",
          dayToDay:"Designing, editing, iterating, feedback cycles, publishing.",
          skills:"Taste, iteration, storytelling, tools, feedback-handling",
          entry:"Portfolio often beats grades.",
          next:"Build a portfolio, learn Figma/Adobe, post weekly work."
        }
      },
      { id:"engineering", name:"Engineering", tags:["Civil","Mechanical","Electrical","Mechatronics"],
        why:["Maths + physics + building systems.","Design + testing mindset.","Strong demand in many areas."],
        details:{
          subjects:"Maths Methods/Specialist, Physics, Chemistry",
          pathways:"Uni engineering ‚Üí placements ‚Üí grad engineer ‚Üí chartered/specialist",
          dayToDay:"Design, modelling, testing, documentation, safety checks, stakeholder work.",
          skills:"Maths, modelling, design, teamwork, safety mindset",
          entry:"Advanced maths helps a lot.",
          next:"Choose advanced maths, STEM projects, robotics club."
        }
      },
      { id:"education", name:"Education", tags:["Teacher","Tutor","Early Childhood","Support"],
        why:["Explaining + helping people improve.","Patience + structure.","Stable long-term work."],
        details:{
          subjects:"English + your strongest specialty subjects",
          pathways:"Uni teaching degree ‚Üí placements ‚Üí registration",
          dayToDay:"Lesson plans, teaching, marking, communication, improving learning.",
          skills:"Communication, patience, structure, creativity",
          entry:"Requires qualifications + placements.",
          next:"Volunteer tutoring, practice explaining, check prerequisites."
        }
      }
    ];

    // Strict-mode related categories
    const RELATED = {
      law:        ["government","business","policing"],
      policing:   ["government","law","health"],
      government: ["law","business","tech"],
      tech:       ["engineering","business","creative"],
      health:     ["policing","education","government"],
      business:   ["government","tech","law"],
      creative:   ["tech","business","education"],
      engineering:["tech","business","government"],
      education:  ["health","government","creative"]
    };

    // ======================
    // Eligibility rules (simple cutoffs)
    // - Base by category
    // - Overrides for certain professions (Doctor etc.)
    // ======================
    const CATEGORY_MIN = {
      law: 80,
      policing: 60,
      government: 65,
      tech: 55,
      engineering: 75,
      health: 70,
      business: 60,
      creative: 50,
      education: 65
    };

    const JOB_MIN_OVERRIDE = {
      "Doctor": 95,
      "Surgeon": 98,
      "General Practitioner": 95,
      "Dentist": 92,
      "Psychologist": 85,
      "Pharmacist": 85,
      "Radiographer": 80,
      "Sonographer": 82,
      "Midwife": 78,
      "Paramedic": 78,
      "Lawyer": 85,
      "Barrister": 90,
      "Software Engineer": 55,
      "AI Engineer": 75,
      "Machine Learning Engineer": 78,
      "Data Scientist": 75,
      "Solutions Architect": 70,
      "Civil Engineer": 78,
      "Electrical Engineer": 80,
      "Mechanical Engineer": 78,
      "Teacher (Secondary)": 70,
      "Teacher (Primary)": 65
    };

    // ======================
    // 200+ professions generator
    // ======================
    function uniqueJobs(list){
      const seen = new Set();
      const out = [];
      for (const j of list){
        const key = j.title.toLowerCase();
        if (seen.has(key)) continue;
        seen.add(key);
        out.push(j);
      }
      return out;
    }
    function makeSub(categoryName, parts){ return `${categoryName} ‚Ä¢ ${parts.join(" ‚Ä¢ ")}`; }

    function generateJobs(){
      const out = [];
      const catName = (id) => CATEGORIES.find(c=>c.id===id)?.name || "Career";

      const add = (title, category, subParts) => {
        out.push({ title, category, sub: makeSub(catName(category), subParts) });
      };

      // Law
      [
        "Lawyer","Solicitor","Barrister","Paralegal","Legal Assistant","Legal Secretary",
        "Compliance Officer","Contract Administrator","Contracts Manager","Legal Counsel",
        "Corporate Lawyer","Criminal Lawyer","Family Lawyer","Immigration Lawyer","Property Lawyer",
        "Litigation Lawyer","Employment Lawyer","IP Lawyer","Tax Lawyer","Environmental Lawyer",
        "Mediator","Conveyancer","Court Registrar","Notary Public","Claims Officer","Insurance Lawyer"
      ].forEach(t => add(t, "law", ["documents","advice","rules"]));
      ["Privacy","Workplace","Corporate","Regulatory","Risk"].forEach(s => add(`${s} Compliance Analyst`, "law", ["compliance","audits","policy"]));

      // Justice & Policing
      [
        "Police Officer","Detective","Forensic Scientist","Forensic Analyst","Crime Scene Investigator",
        "Corrections Officer","Security Officer","Border Force Officer","Intelligence Analyst",
        "Emergency Dispatcher","Firefighter","Paramedic","Customs Officer","Protective Services Officer",
        "Child Protection Officer","Fraud Investigator","Private Investigator","Community Safety Officer"
      ].forEach(t => add(t, "policing", ["public service","reports","teamwork"]));
      ["Cyber","Financial","Homicide","Missing Persons","Narcotics"].forEach(s => add(`${s} Investigator`, "policing", ["investigations","evidence","interviews"]));

      // Government / Policy
      [
        "Policy Officer","Policy Analyst","Program Officer","Program Manager","Project Officer",
        "Public Servant","Regulatory Officer","Compliance Officer (Government)","Grants Officer",
        "Procurement Officer","Urban Planner","Town Planner","Data Governance Officer",
        "Freedom of Information Officer","Community Engagement Officer","Case Manager (Government)",
        "Workplace Relations Officer","Inspector (Regulatory)","Licensing Officer","Environmental Health Officer"
      ].forEach(t => add(t, "government", ["systems","briefs","stakeholders"]));
      ["Transport","Health","Education","Housing","Climate"].forEach(s => add(`${s} Policy Advisor`, "government", ["policy","analysis","impact"]));

      // Tech
      [
        "Software Engineer","Frontend Developer","Backend Developer","Full Stack Developer","Web Developer",
        "Mobile App Developer","iOS Developer","Android Developer","Game Developer",
        "Data Analyst","Data Engineer","Data Scientist","Machine Learning Engineer","AI Engineer",
        "Cybersecurity Analyst","Security Engineer","Cloud Engineer","DevOps Engineer","Site Reliability Engineer",
        "QA Engineer","Test Automation Engineer","Product Analyst","Business Intelligence Analyst",
        "UX Engineer","Solutions Architect","Network Engineer","Systems Administrator"
      ].forEach(t => add(t, "tech", ["build","debug","ship"]));
      ["Junior","Senior","Lead"].forEach(level=>{
        ["Cloud","Security","Data","Web","Mobile","AI"].forEach(f=>{
          add(`${level} ${f} Engineer`, "tech", ["specialist","tools","delivery"]);
        });
      });
      ["Python","Java","JavaScript","C#","Go","Rust"].forEach(lang => add(`${lang} Developer`, "tech", ["coding","features","apps"]));
      ["UI/UX","Product","Platform","Infrastructure"].forEach(area => add(`${area} Engineer`, "tech", ["systems","quality","scale"]));

      // Engineering
      [
        "Civil Engineer","Structural Engineer","Mechanical Engineer","Electrical Engineer","Mechatronics Engineer",
        "Software Engineer (Embedded)","Biomedical Engineer","Chemical Engineer","Environmental Engineer",
        "Mining Engineer","Aerospace Engineer","Industrial Engineer","Robotics Engineer",
        "Architect","Surveyor","Quantity Surveyor","Draftsperson","CAD Technician","Geotechnical Engineer"
      ].forEach(t => add(t, "engineering", ["design","test","safety"]));
      ["Junior","Senior","Graduate"].forEach(level=>{
        ["Civil","Mechanical","Electrical","Structural"].forEach(d=>{
          add(`${level} ${d} Engineer`, "engineering", ["projects","models","site"]);
        });
      });

      // Healthcare
      [
        "Nurse","Registered Nurse","Enrolled Nurse","Doctor","General Practitioner","Surgeon",
        "Psychologist","Counsellor","Physiotherapist","Occupational Therapist","Speech Pathologist",
        "Pharmacist","Dentist","Dental Hygienist","Radiographer","Sonographer","Paramedic",
        "Dietitian","Optometrist","Pathologist","Medical Laboratory Scientist","Midwife"
      ].forEach(t => add(t, "health", ["care","science","teamwork"]));
      ["Emergency","ICU","Mental Health","Paediatric","Aged Care"].forEach(area => add(`${area} Nurse`, "health", ["patients","clinical","shift work"]));

      // Business
      [
        "Business Analyst","Project Manager","Product Manager","Operations Manager","Marketing Specialist",
        "Digital Marketer","Accountant","Financial Analyst","Investment Analyst","Management Consultant",
        "HR Officer","Recruiter","Sales Representative","Account Manager","Customer Success Manager",
        "Supply Chain Analyst","Logistics Coordinator","Procurement Specialist","Brand Manager",
        "Entrepreneur","E-commerce Manager","Real Estate Agent","Office Manager","Executive Assistant"
      ].forEach(t => add(t, "business", ["planning","people","results"]));
      ["Junior","Senior"].forEach(level=>{
        ["Business Analyst","Project Manager","Product Manager","Marketing Manager"].forEach(role=>{
          add(`${level} ${role}`, "business", ["ownership","delivery","growth"]);
        });
      });

      // Creative
      [
        "Graphic Designer","UI/UX Designer","Product Designer","Illustrator","Animator","3D Artist",
        "Video Editor","Photographer","Content Creator","Copywriter","Social Media Manager",
        "Creative Director","Motion Designer","Sound Designer","Game Artist","Brand Designer",
        "Film Producer","Journalist","Podcaster","Streamer"
      ].forEach(t => add(t, "creative", ["design","story","portfolio"]));
      ["Junior","Senior"].forEach(level=>{
        ["Graphic Designer","UI/UX Designer","Video Editor","Content Designer"].forEach(role=>{
          add(`${level} ${role}`, "creative", ["quality","style","feedback"]);
        });
      });

      // Education
      [
        "Teacher (Primary)","Teacher (Secondary)","Early Childhood Educator","Tutor","Teacher Aide",
        "Special Education Teacher","School Counsellor","Education Support Officer","Librarian (School)",
        "Sports Coach","Music Teacher","Math Tutor","English Tutor","Science Tutor"
      ].forEach(t => add(t, "education", ["learning","people","structure"]));
      ["VCE","Primary","Early Years"].forEach(stage => add(`${stage} Coordinator`, "education", ["coordination","students","planning"]));

      return uniqueJobs(out).sort((a,b)=>a.title.localeCompare(b.title));
    }

    const JOBS_ALL = generateJobs(); // 200+ usually

    // ======================
    // Mode + state
    // ======================
    let mode = null; // "ATAR" or "GPA"
    let selectedJob = null;
    let filteredJobs = [];
    let activeIndex = -1;

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function categoryIcon(cat){
      const map = {
        law:"‚öñÔ∏è", policing:"üöì", government:"üèõÔ∏è", tech:"üíª",
        engineering:"üõ†Ô∏è", health:"ü©∫", business:"üìà", creative:"üé®", education:"üìö"
      };
      return map[cat] || "üíº";
    }
    function getCategory(catId){ return CATEGORIES.find(c => c.id === catId); }

    // Eligibility cutoff
    function minScoreForJob(jobTitle, catId){
      if (JOB_MIN_OVERRIDE[jobTitle] != null) return JOB_MIN_OVERRIDE[jobTitle];
      return CATEGORY_MIN[catId] ?? 60;
    }
    function isEligible(job, score){
      const s = Number(score) || 0;
      return s >= minScoreForJob(job.title, job.category);
    }

    // ======================
    // Dropdown UI
    // ======================
    function showPanel(){ $("comboPanel").style.display = "block"; }
    function hidePanel(){
      $("comboPanel").style.display = "none";
      activeIndex = -1;
      renderPanelList();
    }
    function setError(on){ $("errorLine").style.display = on ? "block" : "none"; }

    function validateExactJobEligible(){
      const val = $("jobInput").value.trim().toLowerCase();
      if (!val) return null;
      const score = $("scoreInput").value;
      return filteredJobs.find(j => j.title.toLowerCase() === val) || null;
    }

    function setSelected(job){
      selectedJob = job;
      $("jobInput").value = job.title;
      $("searchBtn").disabled = false;
      setError(false);
      hidePanel();
    }

    function buildEligibleJobs(){
      const score = $("scoreInput").value;
      return JOBS_ALL.filter(j => isEligible(j, score));
    }

    function filterJobs(query){
      const q = (query || "").trim().toLowerCase();
      const eligible = buildEligibleJobs();
      if (!q) return eligible.slice(0, 260);
      return eligible
        .filter(j => j.title.toLowerCase().includes(q) || (j.sub||"").toLowerCase().includes(q))
        .slice(0, 260);
    }

    function renderPanelList(){
      const list = $("panelList");
      list.innerHTML = "";
      const items = filteredJobs;

      if (!items.length){
        const empty = document.createElement("div");
        empty.className = "panelItem";
        empty.style.cursor = "default";
        empty.innerHTML = `
          <div class="badge">‚ùå</div>
          <div>
            <div class="pTitle">No eligible match</div>
            <div class="pSub">Try increasing your score or type a different job.</div>
          </div>
        `;
        list.appendChild(empty);
        return;
      }

      items.forEach((job, idx) => {
        const div = document.createElement("div");
        div.className = "panelItem" + (idx === activeIndex ? " active" : "");
        const minReq = minScoreForJob(job.title, job.category);
        div.innerHTML = `
          <div class="badge">${categoryIcon(job.category)}</div>
          <div style="min-width:0">
            <div class="pTitle">${escapeHtml(job.title)}</div>
            <div class="pSub">
              ${escapeHtml(getCategory(job.category)?.name || "")}
              ‚Ä¢ min ${mode || "Score"}: ${minReq}
            </div>
          </div>
        `;
        div.addEventListener("mousedown", (e) => {
          e.preventDefault();
          setSelected(job);
        });
        list.appendChild(div);
      });
    }

    function ensureActiveVisible(){
      const list = $("panelList");
      const item = list.children[activeIndex];
      if (!item) return;

      const itemTop = item.offsetTop;
      const itemBottom = itemTop + item.offsetHeight;
      const viewTop = list.scrollTop;
      const viewBottom = viewTop + list.clientHeight;

      if (itemTop < viewTop) list.scrollTop = itemTop;
      else if (itemBottom > viewBottom) list.scrollTop = itemBottom - list.clientHeight;
    }

    function refreshPanel(){
      filteredJobs = filterJobs($("jobInput").value);
      renderPanelList();
    }

    // ======================
    // STRICT MODE shortlist
    // Only: primary category + directly related categories
    // ======================
    function scoreCategoryStrict(catId, score, salary, primaryCat){
      let s = 0;

      // strict: primary dominates
      if (catId === primaryCat) s += 100;
      else s += 55; // related ones are still strong

      const g = Number(score) || 0;

      // competitive categories get more benefit from higher scores
      const competitive = ["law","health","engineering"];
      if (competitive.includes(catId)){
        s += (g >= 90 ? 20 : g >= 80 ? 12 : g >= 70 ? 6 : 2);
      } else {
        s += (g >= 80 ? 10 : g >= 70 ? 7 : 4);
      }

      // salary influence
      if (salary === "high"){
        if (["tech","engineering","law","business"].includes(catId)) s += 10;
        else s += 4;
      } else if (salary === "low"){
        if (["government","policing","education","health"].includes(catId)) s += 7;
      }

      return s;
    }

    function sampleJobsForCategory(catId, excludeTitle){
      const score = $("scoreInput").value;
      const eligible = JOBS_ALL.filter(j => j.category === catId && j.title !== excludeTitle && isEligible(j, score));
      return eligible.slice(0, 10).map(j => j.title);
    }

    function toPercent(rankIndex, topScore, score){
      const raw = Math.max(0, Math.min(100, Math.round((score / topScore) * 100)));
      if (rankIndex === 0) return Math.max(raw, 78);
      if (rankIndex === 1) return Math.min(Math.max(raw, 66), 92);
      if (rankIndex === 2) return Math.min(Math.max(raw, 58), 88);
      return Math.min(Math.max(raw, 50), 82);
    }

    function renderResults(sorted, primaryJob){
      const results = $("results");
      results.style.display = "block";
      results.innerHTML = "";

      const topScore = sorted[0]?.score || 1;

      sorted.forEach((item, idx) => {
        const cat = getCategory(item.catId);
        const pct = toPercent(idx, topScore, item.score);
        const suggested = sampleJobsForCategory(item.catId, primaryJob.title).slice(0, 8);

        const card = document.createElement("div");
        card.className = "resultCard";
        card.innerHTML = `
          <div class="resultTop">
            <div>
              <h3 class="resultName">${idx+1}. ${escapeHtml(cat.name)}</h3>
              <div class="tags">
                ${cat.tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("")}
              </div>
            </div>
            <div class="match">${pct}% match</div>
          </div>

          <div class="why">Why it fits:</div>
          <ul>
            <li><b>Your selected job:</b> ${escapeHtml(primaryJob.title)}</li>
            <li><b>Strict mode:</b> ${escapeHtml(item.catId === primaryJob.category ? "Same category as your job." : "Directly related category only.")}</li>
            ${cat.why.map(x => `<li>${escapeHtml(x)}</li>`).join("")}
          </ul>

          <div class="moreRow">
            <span class="hint">Click to expand</span>
            <button class="pillBtn" data-toggle-details>More details</button>
          </div>

          <div class="details">
            <div class="detailsGrid">
              <div class="detailItem">
                <div class="detailTitle">Day-to-day</div>
                <div class="detailText">${escapeHtml(cat.details.dayToDay)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Entry / pathway</div>
                <div class="detailText">${escapeHtml(cat.details.pathways)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Best subjects</div>
                <div class="detailText">${escapeHtml(cat.details.subjects)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Key skills</div>
                <div class="detailText">${escapeHtml(cat.details.skills)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Entry notes</div>
                <div class="detailText">${escapeHtml(cat.details.entry)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Next steps (this week)</div>
                <div class="detailText">${escapeHtml(cat.details.next)}</div>
              </div>

              <div class="detailItem" style="grid-column:1/-1;">
                <div class="detailTitle">Eligible jobs you can also pick right now</div>
                <div class="detailText">
                  ${suggested.length ? suggested.map(x => `‚Ä¢ ${escapeHtml(x)}`).join("<br/>") : "No eligible suggestions at your current score."}
                </div>
              </div>
            </div>
          </div>
        `;
        results.appendChild(card);
      });

      results.scrollIntoView({ behavior:"smooth", block:"start" });
    }

    function runSearch(){
      const exact = validateExactJobEligible();
      if (!exact){
        $("searchBtn").disabled = true;
        setError(true);
        $("results").style.display = "none";
        return;
      }

      selectedJob = exact;
      $("searchBtn").disabled = false;
      setError(false);

      const score = $("scoreInput").value;
      const salary = $("salary").value;
      const primaryCat = selectedJob.category;

      // STRICT MODE: ONLY primary + directly related categories
      const catIds = [primaryCat, ...(RELATED[primaryCat] || [])].slice(0, 4); // primary + up to 3 related
      const uniqueCatIds = Array.from(new Set(catIds));

      const scored = uniqueCatIds.map(id => ({
        catId: id,
        score: scoreCategoryStrict(id, score, salary, primaryCat)
      })).sort((a,b)=>b.score-a.score);

      renderResults(scored, selectedJob);
    }

    // ======================
    // Start modal logic
    // ======================
    function setMode(newMode){
      mode = newMode;
      $("startModal").style.display = "none";

      $("scoreLabel").textContent = (mode === "ATAR") ? "ATAR (0‚Äì100)" : "GPA (0‚Äì100)";
      $("modeText").textContent = mode;
      $("scoreText").textContent = $("scoreInput").value;

      refreshPanel();
    }

    $("chooseATAR").addEventListener("click", () => setMode("ATAR"));
    $("chooseGPA").addEventListener("click", () => setMode("GPA"));

    // ======================
    // Events
    // ======================
    $("jobInput").addEventListener("focus", () => {
      refreshPanel();
      showPanel();
    });

    $("jobInput").addEventListener("input", () => {
      // if user types something that is not exactly eligible, disable search
      const exact = validateExactJobEligible();
      if (exact){
        selectedJob = exact;
        $("searchBtn").disabled = false;
        setError(false);
      } else {
        selectedJob = null;
        $("searchBtn").disabled = true;
      }
      refreshPanel();
      showPanel();
    });

    $("jobInput").addEventListener("keydown", (e) => {
      if ($("comboPanel").style.display !== "block") return;

      if (e.key === "ArrowDown"){
        e.preventDefault();
        if (!filteredJobs.length) return;
        activeIndex = Math.min(filteredJobs.length - 1, activeIndex + 1);
        renderPanelList();
        ensureActiveVisible();
      } else if (e.key === "ArrowUp"){
        e.preventDefault();
        if (!filteredJobs.length) return;
        activeIndex = Math.max(0, activeIndex - 1);
        renderPanelList();
        ensureActiveVisible();
      } else if (e.key === "Enter"){
        const pick = filteredJobs[activeIndex];
        if (pick){
          e.preventDefault();
          setSelected(pick);
        } else {
          const exact = validateExactJobEligible();
          if (exact){
            e.preventDefault();
            setSelected(exact);
          }
        }
      } else if (e.key === "Escape"){
        hidePanel();
      }
    });

    document.addEventListener("mousedown", (e) => {
      const field = $("jobField");
      if (!field.contains(e.target)) hidePanel();
    });

    $("scoreInput").addEventListener("input", () => {
      $("scoreText").textContent = $("scoreInput").value;

      // Changing score changes eligibility list; if selected job becomes invalid, clear it.
      refreshPanel();
      const exact = validateExactJobEligible();
      if (!exact){
        selectedJob = null;
        $("searchBtn").disabled = true;
      } else {
        selectedJob = exact;
        $("searchBtn").disabled = false;
      }
    });

    $("searchBtn").addEventListener("click", runSearch);

    $("resetBtn").addEventListener("click", () => {
      $("jobInput").value = "";
      $("scoreInput").value = 70;
      $("salary").value = "mid";
      selectedJob = null;
      $("searchBtn").disabled = true;
      setError(false);
      $("results").style.display = "none";
      $("results").innerHTML = "";
      $("scoreText").textContent = "70";
      refreshPanel();
      window.scrollTo({ top: 0, behavior:"smooth" });
    });

    document.addEventListener("click", (e) => {
      const toggleBtn = e.target.closest("[data-toggle-details]");
      if (toggleBtn){
        e.preventDefault();
        const card = toggleBtn.closest(".resultCard");
        if (card) card.classList.toggle("expanded");
        return;
      }
      const card = e.target.closest(".resultCard");
      if (!card) return;
      if (e.target.closest("a, button, input, select, textarea")) return;
      card.classList.toggle("expanded");
    });

    // Initial render (but user must choose mode first)
    filteredJobs = [];
    renderPanelList();
  </script>
</body>
</html>
