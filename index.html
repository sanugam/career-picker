<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CareerPicker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f5f7fa;
      --nav:#003580;
      --nav2:#0071c2;
      --card:#ffffff;
      --muted:#6b7280;
      --text:#262626;

      --brand:#0071c2;  
      --brand2:#003580;

      --accent:#feba02;        /* booking.com yellow */
      --accent2:#ffcc00;

      --shadow: 0 2px 8px rgba(0,0,0,.1);
      --shadow2: 0 1px 3px rgba(0,0,0,.12);
      --shadow-hover: 0 4px 16px rgba(0,0,0,.15);

      --radius: 8px;
      --radius2: 4px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: 'Plus Jakarta Sans', ui-sans-serif, system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    /* Top bar */
    .topbar{
      height:64px;
      background: linear-gradient(180deg, #003d99 0%, var(--nav) 50%, #002a66 100%);
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 28px;
      position:sticky;
      top:0;
      z-index:100;
      box-shadow: 0 2px 12px rgba(0,0,0,.15);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:700;
      font-size:20px;
      letter-spacing:-.3px;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 2px rgba(254,186,2,.35), 0 2px 8px rgba(254,186,2,.2);
    }
    .top-actions{
      display:flex; align-items:center; gap:12px;
    }
    .pill{
      border:1px solid rgba(255,255,255,.35);
      color:rgba(255,255,255,.95);
      background: rgba(255,255,255,.06);
      padding:10px 18px;
      border-radius:8px;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      user-select:none;
      transition: all .25s ease;
    }
    .pill:hover{
      background: rgba(255,255,255,.12);
      border-color: rgba(255,255,255,.5);
      transform: translateY(-1px);
    }
    .pill.primary{
      background: #fff;
      color:var(--nav);
      border-color: transparent;
      font-weight:700;
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
    }
    .pill.primary:hover{
      background: #f8fafc;
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
      transform: translateY(-2px);
    }
    .backBtn{
      border:1px solid rgba(255,255,255,.3);
      color:#fff;
      background: transparent;
      padding:8px 16px;
      border-radius:4px;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      user-select:none;
      transition: all .2s;
      display:none;
      align-items:center;
      gap:6px;
    }
    .backBtn:hover{
      background: rgba(255,255,255,.1);
    }
    .backBtn.visible{
      display:flex;
    }
    .backBtn svg{
      width:16px;
      height:16px;
      opacity:.9;
    }

    /* Hero */
    .hero{
      background:
        radial-gradient(900px 350px at 20% 10%, rgba(254,186,2,.12), transparent 60%),
        radial-gradient(800px 320px at 80% 15%, rgba(255,255,255,.08), transparent 65%),
        linear-gradient(180deg, var(--brand) 0%, var(--nav) 85%, rgba(0,53,128,0) 100%);
      padding:40px 0 200px;
      position:relative;
      overflow:visible;
    }
    .wrap{
      width:min(1140px, 94vw);
      margin:0 auto;
    }
    .hero h1{
      margin:0 0 12px;
      color:#fff;
      font-size: 48px;
      line-height:1.1;
      letter-spacing:-.5px;
      font-weight:700;
    }
    .hero p{
      margin:0 0 20px;
      color:rgba(255,255,255,.95);
      font-size:18px;
      font-weight:400;
      max-width: 900px;
      line-height:1.5;
    }

    /* Intent fork CTAs */
    .intentFork{
      margin: 24px 0 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .intentCard{
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: var(--radius);
      padding: 24px;
      cursor: pointer;
      box-shadow: var(--shadow2);
      transition: all .2s ease;
      position: relative;
    }
    .intentCard:hover{
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
      border-color: #bdbdbd;
    }
    .intentCard.primary{
      background: linear-gradient(135deg, #fffbf5 0%, #fff 100%);
      border-color: var(--accent);
      border-width: 2px;
      box-shadow: 0 2px 8px rgba(254,186,2,.15);
    }
    .intentCard.primary:hover{
      border-color: #e6a800;
      box-shadow: 0 6px 20px rgba(254,186,2,.25);
      background: linear-gradient(135deg, #fffaed 0%, #fff 100%);
    }
    .intentCard.selected{
      border-color: var(--brand);
      background: #f0f8ff;
    }
    .intentCard .emoji{
      font-size: 28px;
      margin-bottom: 12px;
      display: block;
    }
    .intentCard .intentTitle{
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -.2px;
      margin: 0 0 8px;
      color: var(--text);
      line-height: 1.3;
    }
    .intentCard .intentDesc{
      font-size: 14px;
      color: #717171;
      font-weight: 400;
      margin: 0;
      line-height: 1.5;
    }
    .intentCard .badge-primary{
      position: absolute;
      top: 12px;
      right: 12px;
      background: var(--accent);
      color: #000;
      font-size: 11px;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: .3px;
    }

    /* Search row */
    .searchRow{
      margin-top:20px;
      background: var(--accent);
      border-radius: var(--radius);
      padding:3px;
      box-shadow: 0 4px 16px rgba(0,0,0,.15), 0 0 0 1px rgba(254,186,2,.3);
      overflow: visible;
      position: relative;
      z-index: 10;
    }
    .searchGrid{
      display:grid;
      grid-template-columns: 1.5fr .7fr .9fr .42fr;
      gap:3px;
      overflow: visible;
    }
    .field{
      background:#fff;
      border-radius: 6px;
      padding:14px 16px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      min-height:76px;
      overflow: visible;
      position: relative;
    }
    .icon{
      width:36px;height:36px;border-radius:4px;
      background: #f0f8ff;
      display:flex;align-items:center;justify-content:center;
      border:1px solid #e0e0e0;
      flex:0 0 auto;
      margin-top:2px;
    }
    .icon svg{opacity:.7}
    .field .label{
      font-size:12px;
      color: #595959;
      font-weight:700;
      letter-spacing:0;
      margin-bottom:4px;
      text-transform: uppercase;
    }
    .field .sub{
      font-size:12px;
      color: #717171;
      font-weight:400;
      margin-top:4px;
    }
    .field .value{
      font-size:18px;
      font-weight:700;
      letter-spacing:-.2px;
      margin-top:2px;
      color:var(--text);
    }
    .field .value.muted{
      color:var(--text);
      opacity:.7;
      font-weight:600;
    }
    .fieldcol{flex:1 1 auto; min-width:0;}
    .inputlike{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      font-size:18px;
      font-weight:700;
      color:var(--text);
      padding:0;
      margin:0;
    }
    .inputlike::placeholder{color:rgba(38,38,38,.4); font-weight:400;}
    .smallrow{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }

    .cta{
      border:none;
      border-radius: 6px;
      background: linear-gradient(180deg, #0071c2 0%, #003580 100%) !important;
      color:#fff !important;
      cursor:pointer;
      font-weight:700;
      letter-spacing:0;
      font-size:16px;
      box-shadow: 0 2px 8px rgba(0,53,128,.25);
      position:relative;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:76px;
      transition: all .2s;
    }
    .cta:hover{
      background: linear-gradient(180deg, #0080e0 0%, #0071c2 100%);
      box-shadow: 0 4px 16px rgba(0,53,128,.35);
      transform: translateY(-1px);
    }
    .cta:active{transform: translateY(1px);}
    .cta:active{transform: translateY(1px);}
    .cta .btn-inner{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      padding:0 12px;
      text-align:center;
    }
    .cta .main{
      font-size:16px;
      line-height:1.2;
      font-weight:700;
      background: transparent !important;
      padding: 0 !important;
    }
    .cta .sub{
      font-size:12px;
      opacity:.9;
      font-weight:400;
      background: transparent !important;
      padding: 0 !important;
    }

    /* Country front screen */
    .countryScreen{
      min-height: 60vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 48px 24px;
      overflow: visible;
      position: relative;
      isolation: isolate;
      z-index: 200;
      background:
        radial-gradient(ellipse 120% 80% at 85% 20%, rgba(254,186,2,.08), transparent 50%),
        radial-gradient(ellipse 80% 60% at 15% 80%, rgba(255,255,255,.04), transparent 45%),
        radial-gradient(900px 350px at 20% 10%, rgba(254,186,2,.15), transparent 55%),
        linear-gradient(165deg, #0a4bb8 0%, #083d93 35%, #062b6f 70%, #041d4d 100%);
    }
    .countryScreen::before{
      content:'';
      position:absolute;
      inset:0;
      background-image: 
        linear-gradient(rgba(255,255,255,.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.02) 1px, transparent 1px);
      background-size: 48px 48px;
      pointer-events:none;
    }
    .countryScreen .wrap{
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 48px;
      width: 100%;
      max-width: 900px;
    }
    .countryScreenGlobeArea{
      flex: 0 0 320px;
      max-width: 320px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .countryScreen.hidden{
      display: none !important;
    }
    .countryScreenCard{
      background: #fff;
      border-radius: 20px;
      padding: 44px 48px;
      max-width: 480px;
      width: 100%;
      box-shadow: 
        0 4px 6px rgba(0,0,0,.04),
        0 12px 24px rgba(0,0,0,.08),
        0 24px 48px rgba(0,0,0,.06),
        0 0 0 1px rgba(255,255,255,.5) inset;
      text-align: center;
      overflow: visible;
      position: relative;
      z-index: 1;
    }
    .countryIcon{
      font-size: 48px;
      display: block;
      margin-bottom: 16px;
    }
    .countryGlobeIcon{
      width: 120px;
      height: 120px;
      margin: 0 auto 20px;
      display: block;
    }
    .countryGlobeIcon svg{
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 4px 12px rgba(0,0,0,.15));
    }
    .countryGlobeDecorative{
      width: 100%;
      max-width: 300px;
      opacity: 0.95;
      filter: drop-shadow(0 8px 24px rgba(0,0,0,.2));
      animation: globeFloat 8s ease-in-out infinite;
    }
    @keyframes globeFloat{
      0%, 100%{ transform: translateY(0); }
      50%{ transform: translateY(-6px); }
    }
    .countryGlobeDecorative svg{
      width: 100%;
      height: auto;
    }
    @media (max-width: 800px){
      .countryScreen .wrap{ flex-direction: column; gap: 32px; }
      .countryScreenGlobeArea{ order: -1; flex: 0 0 auto; max-width: 200px; }
    }
    .countryScreenCard h1{
      font-size: 30px;
      font-weight: 800;
      margin: 0 0 10px;
      color: var(--text);
      letter-spacing: -0.4px;
    }
    .countrySub{
      font-size: 15px;
      color: #64748b;
      margin: 0 0 32px;
      line-height: 1.55;
    }
    .countryField{
      text-align: left;
      margin-bottom: 24px;
      overflow: visible;
    }
    .countryField label{
      display: block;
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--text);
      letter-spacing: 0.02em;
    }
    .countryField .inputlike{
      width: 100%;
      padding: 14px 18px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
      transition: border-color .2s, box-shadow .2s;
    }
    .countryField .inputlike:hover{
      border-color: #cbd5e1;
    }
    .countryField .inputlike:focus{
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 4px rgba(1,113,194,.12);
    }
    .countryHint{
      font-size: 13px;
      color: #94a3b8;
      margin-top: 6px;
    }
    .countryDropdown{
      position: relative;
    }
    .countryDropPanel{
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: 6px;
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,.04), 0 12px 40px rgba(0,0,0,.12);
      max-height: min(280px, 50vh);
      overflow-y: auto;
      display: none;
      z-index: 9999;
    }
    .countryDropPanel.open{
      display: block;
    }
    .countryDropList .row{
      padding: 12px 18px;
      cursor: pointer;
      border-bottom: 1px solid #f1f5f9;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: background .15s;
    }
    .countryDropList .row:last-child{
      border-bottom: none;
    }
    .countryDropList .row:hover,
    .countryDropList .row.active{
      background: #f0f8ff;
    }
    .countryDropList .row .name{
      font-weight: 600;
      color: var(--text);
    }
    .countryDropList .row .meta{
      font-size: 12px;
      color: #64748b;
      margin-top: 2px;
    }
    .countryContinueBtn{
      width: 100%;
      padding: 16px 24px;
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 16px;
      border-radius: 10px;
      transition: transform .2s, box-shadow .2s;
    }
    .countryContinueBtn:hover{
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,53,128,.35);
    }
    .countrySkip{
      font-size: 14px;
      color: #64748b;
      margin: 0;
    }
    .linkBtn{
      background: none;
      border: none;
      color: var(--brand);
      cursor: pointer;
      font-weight: 600;
      text-decoration: none;
      padding: 0;
      transition: color .2s;
    }
    .linkBtn:hover{
      color: var(--brand2);
    }

    /* Info chips row */
    .chipRow{
      margin-top:16px;
      background: rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.2);
      padding:12px;
      border-radius: var(--radius);
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      backdrop-filter: blur(10px);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.15);
    }
    .chip{
      background: rgba(255,255,255,.2);
      border:1px solid rgba(255,255,255,.3);
      color:#fff;
      padding:8px 12px;
      border-radius:4px;
      font-weight:600;
      font-size:13px;
      display:flex;
      gap:8px;
      align-items:center;
      user-select:none;
    }
    .chip.clickable{
      cursor:pointer;
      transition: all 0.2s ease;
    }
    .chip.clickable:hover{
      background: rgba(255,255,255,.3);
      border-color: rgba(255,255,255,.5);
      transform: translateY(-1px);
    }
    .chip strong{color:#fff; font-weight:700;}
    .chip .dot2{
      width:6px;height:6px;border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 2px rgba(254,186,2,.3);
    }

    /* Studies & Interests Section */
    .studiesSection{
      margin-top: 20px;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.2);
      border-radius: 12px;
      padding: 18px 20px;
      backdrop-filter: blur(10px);
    }
    .studiesHeader{
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    .studiesIcon{
      font-size: 20px;
    }
    .studiesTitle{
      color: rgba(255,255,255,.95);
      font-size: 15px;
      font-weight: 700;
      letter-spacing: -.1px;
    }
    .studiesInputWrapper{
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .studiesTagsContainer{
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      min-height: 32px;
    }
    .studiesTag{
      background: rgba(255,255,255,.95);
      border: 1px solid rgba(255,255,255,.3);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: default;
    }
    .studiesTag .removeTag{
      cursor: pointer;
      font-weight: 900;
      color: #64748b;
      font-size: 16px;
      line-height: 1;
      padding: 0 2px;
    }
    .studiesTag .removeTag:hover{
      color: #dc2626;
    }
    .studiesInputContainer{
      position: relative;
    }
    .studiesInput{
      width: 100%;
      background: rgba(255,255,255,.95);
      border: 1px solid rgba(255,255,255,.3);
      border-radius: 8px;
      padding: 12px 16px;
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      outline: none;
      transition: all .2s;
    }
    .studiesInput:focus{
      background: #fff;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(254,186,2,.15);
    }
    .studiesInput::placeholder{
      color: rgba(38,38,38,.5);
      font-weight: 400;
    }
    .studiesDropdown{
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: 4px;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,.15);
      max-height: 240px;
      overflow-y: auto;
      z-index: 100;
      display: none;
    }
    .studiesDropdown.open{
      display: block;
    }
    .studiesDropdownList{
      padding: 4px;
    }
    .studiesDropdownItem{
      padding: 10px 14px;
      cursor: pointer;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      transition: background .15s;
    }
    .studiesDropdownItem:hover{
      background: #f3f4f6;
    }
    .studiesDropdownItem.selected{
      background: #e0e7ff;
      color: #1e40af;
    }
    .studiesHint{
      color: rgba(255,255,255,.75);
      font-size: 13px;
      font-weight: 500;
      line-height: 1.4;
    }

    /* Aesthetic study block (shown before intent selection) */
    .aestheticStudyBlock{
      margin-top: 28px;
      width: 100%;
      position: relative;
    }
    .aestheticStudyBlock.hidden{
      display: none !important;
    }
    .aestheticStudyBlock .aestheticFrame{
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      box-shadow:
        0 2px 8px rgba(0,0,0,.08),
        0 12px 32px rgba(0,0,0,.15),
        0 0 0 1px rgba(255,255,255,.4) inset;
      background: linear-gradient(160deg, #fffef9 0%, #fffbf5 50%, #fff8ee 100%);
      border: 1px solid rgba(254,186,2,.2);
      transition: box-shadow .3s ease;
      min-height: 220px;
      display: flex;
      flex-direction: column;
    }
    .aestheticStudyBlock .aestheticFrame:hover{
      box-shadow:
        0 4px 12px rgba(0,0,0,.1),
        0 16px 40px rgba(0,0,0,.18),
        0 0 0 1px rgba(255,255,255,.4) inset;
    }
    .aestheticStudyBlock .aestheticImgWrap{
      flex: 1;
      min-height: 180px;
      padding: 40px 48px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(145deg, rgba(255,248,235,.6) 0%, rgba(255,250,240,.4) 100%);
    }
    .aestheticStudyBlock .logoMark{
      width: 64px;
      height: 64px;
      margin-bottom: 16px;
    }
    .aestheticStudyBlock .logoMark svg{
      width: 100%;
      height: 100%;
    }
    .aestheticStudyBlock .logoText{
      font-size: 28px;
      font-weight: 800;
      color: #0a4bb8;
      letter-spacing: -0.5px;
      margin: 0 0 6px;
    }
    .aestheticStudyBlock .logoSlogan{
      font-size: 15px;
      font-weight: 500;
      color: rgba(0,53,128,.75);
      letter-spacing: 0.02em;
      margin: 0 0 20px;
    }
    .aestheticStudyBlock .logoAbout{
      font-size: 14px;
      font-weight: 500;
      color: rgba(0,53,128,.7);
      line-height: 1.55;
      text-align: center;
      max-width: 420px;
      margin: 0;
    }
    @media (min-width: 600px){
      .aestheticStudyBlock .aestheticImgWrap{ min-height: 200px; padding: 48px 64px; }
      .aestheticStudyBlock .logoMark{ width: 72px; height: 72px; margin-bottom: 20px; }
      .aestheticStudyBlock .logoText{ font-size: 32px; }
      .aestheticStudyBlock .logoSlogan{ font-size: 16px; margin-bottom: 24px; }
      .aestheticStudyBlock .logoAbout{ font-size: 15px; max-width: 480px; }
    }
    .studiesSection.hidden{
      display: none !important;
    }
    .filters.hidden{
      display: none !important;
    }
    /* Filter pills */
    .filters{
      margin-top:20px;
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap:16px;
    }
    .filterGroup{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.15);
      border-radius: 8px;
      padding: 16px;
    }
    .filterGroup .groupLabel{
      color: rgba(255,255,255,.9);
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
      display: block;
    }
    .filterOptions{
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .filterPill{
      background:#fff;
      border:1px solid #e0e0e0;
      border-radius:6px;
      padding:9px 14px;
      font-weight:600;
      font-size:13px;
      cursor:pointer;
      box-shadow: 0 1px 3px rgba(0,0,0,.1);
      user-select:none;
      color:var(--text);
      transition: all .2s;
      white-space: nowrap;
    }
    .filterPill:hover{
      border-color: #0071c2;
      box-shadow: 0 2px 6px rgba(0,113,194,.2);
      transform: translateY(-1px);
    }
    .filterPill.on{
      background: var(--brand);
      border-color: var(--brand);
      color:#fff;
      box-shadow: 0 2px 6px rgba(0,113,194,.3);
    }
    .filters .sep{display:none;}

    /* Main content */
    .main{
      padding: 32px 0 60px;
      background: linear-gradient(180deg, transparent 0%, var(--bg) 50px);
    }
    h2{
      font-size:32px;
      letter-spacing:-.5px;
      margin:24px 0 8px;
      font-weight:700;
      color:var(--text);
    }
    .hint{
      color:#717171;
      font-weight:400;
      font-size:15px;
      margin:0 0 20px;
    }
    .resultsFraming{
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border: 2px solid #bae6fd;
      border-radius: 16px;
      padding: 18px 22px;
      margin: 20px 0 18px;
    }
    .resultsFraming .framingTitle{
      font-size: 18px;
      font-weight: 950;
      color: #0c4a6e;
      margin: 0 0 4px;
    }
    .resultsFraming .framingText{
      font-size: 15px;
      font-weight: 750;
      color: #075985;
      margin: 0;
    }
    .evalCard{
      background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
      border: 2px solid #fde047;
      border-radius: 18px;
      padding: 24px;
      margin: 16px 0;
      box-shadow: 0 12px 35px rgba(253, 224, 71, .15);
    }
    .evalCard .evalTitle{
      font-size: 26px;
      font-weight: 950;
      color: #0b1220;
      margin: 0 0 16px;
      letter-spacing: -.4px;
    }
    .evalSection{
      margin: 20px 0;
      padding: 16px;
      background: rgba(255,255,255,.7);
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.08);
    }
    .evalSection h4{
      font-size: 16px;
      font-weight: 950;
      color: #0b1220;
      margin: 0 0 10px;
    }
    .statusLabel{
      display: inline-block;
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 950;
      font-size: 14px;
      margin: 8px 0;
    }
    .statusLabel.likely{
      background: #dcfce7;
      color: #166534;
      border: 2px solid #86efac;
    }
    .statusLabel.stretch{
      background: #fef3c7;
      color: #92400e;
      border: 2px solid #fcd34d;
    }
    .statusLabel.unlikely{
      background: #fee2e2;
      color: #991b1b;
      border: 2px solid #fca5a5;
    }
    .mergePrompt{
      background: #fff;
      border: 2px dashed #cbd5e1;
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }
    .mergePrompt .mergeTitle{
      font-size: 18px;
      font-weight: 950;
      color: #0b1220;
      margin: 0 0 12px;
    }
    .mergeBtn{
      background: linear-gradient(135deg, #0b5cff, #0047cc);
      border: none;
      color: #fff;
      padding: 14px 24px;
      border-radius: 12px;
      font-weight: 950;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(11, 92, 255, .25);
      transition: all .12s ease;
    }
    .mergeBtn:hover{
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(11, 92, 255, .35);
    }
    .mergeBtn:active{
      transform: translateY(0);
    }
    .advancedFilters{
      margin: 20px 0;
      padding: 18px;
      background: #fafbfc;
      border: 1px solid #e5e7eb;
      border-radius: 14px;
    }
    .advancedFilters .advTitle{
      font-size: 16px;
      font-weight: 950;
      color: #0b1220;
      margin: 0 0 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .advancedFilters .advBody{
      margin-top: 14px;
    }
    .helperText{
      font-size: 13px;
      color: #64748b;
      font-weight: 750;
      margin: 8px 0 0;
      font-style: italic;
    }
    .refineSection{
      margin: 24px 0;
      padding: 20px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
    }
    .refineSection h3{
      font-size: 20px;
      font-weight: 950;
      color: #0b1220;
      margin: 0 0 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      user-select: none;
    }
    .refineSection h3:hover{
      color: #0071c2;
    }
    .refineSection .refineToggle{
      font-size: 14px;
      color: #64748b;
      margin-left: auto;
      transition: transform 0.2s;
    }
    .refineSection.collapsed .refineToggle{
      transform: rotate(-90deg);
    }
    .refineSection .refineBody{
      display: block;
    }
    .refineSection.collapsed .refineBody{
      display: none;
    }
    .refineSection .refineGrid{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 16px;
    }
    @media (max-width: 768px){
      .refineSection .refineGrid{
        grid-template-columns: 1fr;
      }
    }

    /* Cards */
    .card{
      background: linear-gradient(135deg, #fff 0%, #fafbfc 100%);
      border:1px solid #e0e0e0;
      border-radius: var(--radius);
      padding:20px;
      box-shadow: var(--shadow2);
      margin: 12px 0;
      cursor:pointer;
      transition: all .2s ease;
    }
    .card:hover{
      box-shadow: var(--shadow-hover);
      border-color: #bdbdbd;
      transform: translateY(-2px);
    }
    .card:active{transform: translateY(1px);}
    .realityCheck{
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border: 2px solid #fcd34d;
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }
    .realityCheckIcon{
      font-size: 24px;
      flex-shrink: 0;
    }
    .realityCheckContent{
      flex: 1;
    }
    .realityCheckTitle{
      font-size: 16px;
      font-weight: 950;
      color: #92400e;
      margin-bottom: 6px;
    }
    .realityCheckText{
      font-size: 14px;
      font-weight: 600;
      color: #78350f;
      line-height: 1.5;
    }
    .cardTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .cardTitle{
      font-size:20px;
      font-weight:700;
      margin:0 0 10px;
      letter-spacing:-.2px;
      color:var(--text);
    }
    .match{
      font-size:18px;
      font-weight:700;
      color:var(--brand);
      white-space:nowrap;
    }
    .tags{
      display:flex; flex-wrap:wrap; gap:6px;
      margin-bottom:12px;
    }
    .tag{
      font-size:12px;
      font-weight:600;
      color:#595959;
      background:#f5f5f5;
      border:1px solid #e0e0e0;
      padding:4px 10px;
      border-radius:4px;
    }
    .facts{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap:8px;
      margin-top:10px;
    }
    .fact{
      background:#fafafa;
      border:1px solid #e0e0e0;
      border-radius: 6px;
      padding:10px 12px;
    }
    .fact .k{font-size:11px;color:#717171;font-weight:700;margin-bottom:4px;text-transform:uppercase;}
    .fact .v{font-size:14px;color:var(--text);font-weight:600;}

    .cardBody{
      margin-top:12px;
      display:none;
      border-top:1px solid #e5e7eb;
      padding-top:14px;
    }
    .card.open .cardBody{display:block;}

    .sectionTitle{
      font-weight:700;
      margin:16px 0 8px;
      color:var(--text);
      font-size:16px;
    }
    .bullets{
      margin:0;
      padding-left:20px;
      color:var(--text);
      font-weight:400;
      line-height:1.6;
    }
    .bullets li{margin:8px 0;}
    .noteRow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:12px;
    }
    .badge{
      font-size:11px;
      font-weight:600;
      padding:6px 10px;
      border-radius:4px;
      border:1px solid #e0e0e0;
      background:#fff;
      color:var(--text);
    }
    .badge.rule{background:#fff9e6;border-color:#ffd966;}
    .badge.formal{background:#e8f5e9;border-color:#81c784;}
    .badge.varies{background:#e3f2fd;border-color:#64b5f6;}
    .sources{
      margin-top:10px;
      font-size:12px;
      color:#717171;
      font-weight:400;
    }

    .btnRow{
      display:flex;
      gap:12px;
      margin-top:20px;
    }
    .ghost{
      background:#fff;
      border:1px solid #e0e0e0;
      border-radius: 6px;
      padding:12px 20px;
      font-weight:600;
      cursor:pointer;
      transition: all .2s;
    }
    .ghost:hover{
      border-color: #bdbdbd;
      background: #fafafa;
    }

    /* Profession dropdown (booking-ish) */
    .dropdown{
      position:relative;
      width:100%;
      z-index:40;
    }
    .dropPanel{
      position:absolute;
      left:0; right:0;
      top:74px;
      background:#fff;
      border-radius: 18px;
      border:1px solid #e5e7eb;
      box-shadow: var(--shadow);
      overflow:hidden;
      display:none;
      z-index:50;
      max-height: 400px;
    }
    .dropPanel.open{display:block;}
    .dropHeader{
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid #eef2f7;
      background: linear-gradient(180deg, #fbfdff, #ffffff);
    }
    .dropHeader .t{
      font-size:20px;
      font-weight:950;
      color:#0b1220;
    }
    .dropHeader .h{
      font-size:13px;
      color:#6b7280;
      font-weight:850;
    }
    .dropList{
      max-height: 360px;
      overflow:auto;
    }
    .row{
      display:flex;
      gap:12px;
      padding:14px 16px;
      cursor:pointer;
      border-bottom:1px solid #f1f5f9;
      align-items:center;
      color:#0b1220;             /* FIX: not white */
      background:#fff;
    }
    .row:hover{background:#f7fbff;}
    .row.active{background:#eef6ff;}
    .rowIcon{
      width:42px;height:42px;border-radius:999px;
      background:#f1f5f9;
      border:1px solid #e2e8f0;
      display:flex;align-items:center;justify-content:center;
      flex:0 0 auto;
    }
    .rowMain{min-width:0;}
    .rowMain .name{
      font-weight:950;
      font-size:16px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      color:#0b1220;
    }
    .rowMain .meta{
      font-weight:850;
      font-size:13px;
      color:#64748b;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Modal (ATAR vs GPA) */
    .modalWrap{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
      padding:18px;
    }
    .modalWrap.show{display:flex !important;}
    .modal{
      width:min(760px, 95vw);
      border-radius: 18px;
      overflow:hidden;
      box-shadow: var(--shadow);
      background:#fff;
      position: relative;
      z-index: 101;
    }
    .modalTop{
      background: linear-gradient(180deg, #0a4bb8, #062b6f);
      padding:18px 18px 14px;
      color:#fff;
    }
    .modalTop h3{
      margin:0 0 6px;
      font-size:28px;
      letter-spacing:-.4px;
    }
    .modalTop p{
      margin:0;
      color:rgba(255,255,255,.88);
      font-weight:750;
      line-height:1.35;
    }
    .modalBody{
      padding:16px 16px 14px;
      pointer-events: auto;
    }
    .modeGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      pointer-events: auto;
    }
    .modeCard{
      border:1px solid #e5e7eb;
      border-radius: 16px;
      padding:14px;
      cursor:pointer;
      box-shadow: 0 8px 20px rgba(0,0,0,.08);
      background:#fff;
      pointer-events: auto;
      user-select: none;
    }
    .modeCard:hover{background:#f7fbff;}
    .modeCard:active{transform: scale(0.98);}
    .modeCard .m1{font-weight:950; font-size:18px; margin-bottom:2px;}
    .modeCard .m2{color:#64748b; font-weight:800; font-size:13px;}
    .modalFoot{
      padding:0 16px 14px;
      color:#64748b;
      font-weight:800;
      font-size:13px;
    }
    .modalFoot .btn{
      background: var(--brand);
      color: #fff;
      border: none;
      padding: 10px 24px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .modalFoot .btn:hover{
      background: var(--brand2);
      transform: translateY(-1px);
    }
    .modalFoot .btn:active{
      transform: translateY(0);
    }

    /* Job detail modal (full-screen career + universities) */
    .jobDetailModalWrap{ align-items: flex-start; padding: 24px; overflow-y: auto; }
    .jobDetailModal{
      width: min(900px, 96vw);
      max-height: calc(100vh - 48px);
      overflow-y: auto;
      padding: 0;
      position: relative;
    }
    .jobDetailClose{
      position: absolute;
      top: 16px;
      right: 16px;
      width: 40px;
      height: 40px;
      border: none;
      background: rgba(0,0,0,.08);
      border-radius: 50%;
      font-size: 24px;
      line-height: 1;
      cursor: pointer;
      z-index: 10;
    }
    .jobDetailClose:hover{ background: rgba(0,0,0,.15); }
    .jobDetailContent{ padding: 32px 40px 40px; }
    .jobDetailContent .jobDetailTitle{ font-size: 28px; font-weight: 800; margin: 0 0 8px; color: var(--text); }
    .jobDetailContent .jobDetailMatch{ font-size: 16px; font-weight: 700; color: #10b981; margin-bottom: 16px; }
    .jobDetailContent .jobDetailFacts{ display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin: 20px 0; }
    .jobDetailContent .jobDetailSection{ margin: 24px 0 0; }
    .jobDetailContent .jobDetailSectionTitle{ font-size: 15px; font-weight: 700; margin: 0 0 10px; color: var(--text); }
    .jobDetailContent .universityList{ margin-top: 12px; }
    .jobDetailContent .universityItem{
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 14px 18px;
      margin-bottom: 10px;
    }
    .jobDetailContent .universityItem strong{ font-size: 15px; color: var(--text); }
    .jobDetailContent .universityItem .univNote{ font-size: 13px; color: #64748b; margin-top: 4px; }

    /* Responsive */
    @media (max-width: 980px){
      .searchGrid{grid-template-columns: 1fr; }
      .cta{min-height:64px;}
      .facts{grid-template-columns: 1fr 1fr;}
      .hero h1{font-size:42px;}
      .intentFork{grid-template-columns: 1fr;}
      .intentCard .badge-primary{top: 12px; right: 12px; font-size: 10px; padding: 4px 8px;}
    }
  </style>
</head>

<body>
  <!-- Country / Location front screen (shown first) -->
  <section class="countryScreen" id="countryScreen">
    <div class="wrap">
      <div class="countryScreenCard">
        <h1>Where are you based?</h1>
        <p class="countrySub">We'll tailor opportunities and universities to your location.</p>
        <div class="countryField">
          <label for="countryInput">Country</label>
          <div class="dropdown countryDropdown">
            <input 
              type="text" 
              id="countryInput" 
              class="inputlike countryInput" 
              placeholder="Type to search countries..." 
              autocomplete="off"
            />
            <div class="dropPanel countryDropPanel" id="countryDropPanel">
              <div class="dropHeader">
                <div class="t">Countries</div>
                <div class="h">Type to filter ‚Ä¢ Scroll ‚Ä¢ Enter to select</div>
              </div>
              <div class="dropList countryDropList" id="countryDropList"></div>
            </div>
          </div>
          <div class="countryHint">Select your country for tailored opportunities</div>
        </div>
        <button class="cta countryContinueBtn" id="countryContinueBtn" type="button">
          Continue ‚Üí
        </button>
        <p class="countrySkip">Or <button type="button" class="linkBtn" id="countrySkipBtn">skip for now</button></p>
      </div>
      <div class="countryScreenGlobeArea" aria-hidden="true">
        <div class="countryGlobeDecorative">
          <svg viewBox="0 0 240 240" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <radialGradient id="globeGlowBg" cx="32%" cy="32%" r="55%">
                <stop offset="0%" stop-color="rgba(254,186,2,.25)"/>
                <stop offset="50%" stop-color="rgba(255,255,255,.15)"/>
                <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
              </radialGradient>
              <linearGradient id="globeStroke" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="rgba(255,255,255,.5)"/>
                <stop offset="100%" stop-color="rgba(255,255,255,.25)"/>
              </linearGradient>
            </defs>
            <!-- Lat/long grid lines - more detailed -->
            <ellipse cx="120" cy="120" rx="105" ry="42" fill="none" stroke="rgba(255,255,255,.12)" stroke-width="1" stroke-dasharray="3 6" transform="rotate(-25 120 120)"/>
            <ellipse cx="120" cy="120" rx="105" ry="42" fill="none" stroke="rgba(255,255,255,.1)" stroke-width="1" stroke-dasharray="2 5" transform="rotate(20 120 120)"/>
            <ellipse cx="120" cy="120" rx="105" ry="42" fill="none" stroke="rgba(255,255,255,.08)" stroke-width="1" stroke-dasharray="2 4" transform="rotate(65 120 120)"/>
            <ellipse cx="120" cy="120" rx="105" ry="42" fill="none" stroke="rgba(255,255,255,.06)" stroke-width="0.8" stroke-dasharray="2 3" transform="rotate(-70 120 120)"/>
            <!-- Orbital arcs -->
            <ellipse cx="120" cy="120" rx="108" ry="44" fill="none" stroke="rgba(255,255,255,.25)" stroke-width="1.5" stroke-dasharray="5 10" transform="rotate(-20 120 120)"/>
            <ellipse cx="120" cy="120" rx="108" ry="44" fill="none" stroke="rgba(255,255,255,.2)" stroke-width="1.2" stroke-dasharray="4 8" transform="rotate(25 120 120)"/>
            <ellipse cx="120" cy="120" rx="108" ry="44" fill="none" stroke="rgba(255,255,255,.15)" stroke-width="1" stroke-dasharray="3 6" transform="rotate(70 120 120)"/>
            <!-- Globe outline -->
            <circle cx="120" cy="120" r="98" fill="none" stroke="url(#globeStroke)" stroke-width="2"/>
            <!-- Continent outlines - more detailed shapes -->
            <path d="M52 88 Q62 82 75 85 Q90 80 100 88 Q108 98 105 114 Q98 128 85 124 Q72 122 62 130 Q52 118 50 100 Z" fill="none" stroke="rgba(255,255,255,.65)" stroke-width="2" stroke-dasharray="3 5" stroke-linecap="round"/>
            <path d="M108 68 Q122 65 135 72 Q145 85 140 100 Q132 112 118 108 Q108 95 108 78 Z" fill="none" stroke="rgba(255,255,255,.6)" stroke-width="1.8" stroke-dasharray="2 4" stroke-linecap="round"/>
            <path d="M155 95 Q168 100 175 112 Q170 128 158 135 Q145 130 142 115 Z" fill="none" stroke="rgba(255,255,255,.55)" stroke-width="1.6" stroke-dasharray="2 3" stroke-linecap="round"/>
            <path d="M65 140 Q80 138 92 145 Q98 158 88 172 Q75 175 65 165 Q58 152 62 138 Z" fill="none" stroke="rgba(255,255,255,.6)" stroke-width="1.6" stroke-dasharray="2 3" stroke-linecap="round"/>
            <path d="M118 138 Q132 135 142 145 Q138 162 125 168 Q112 165 108 150 Z" fill="none" stroke="rgba(255,255,255,.55)" stroke-width="1.5" stroke-dasharray="2 3" stroke-linecap="round"/>
            <path d="M35 115 Q48 112 58 118 Q55 132 48 142 Q38 138 35 125 Z" fill="none" stroke="rgba(255,255,255,.5)" stroke-width="1.4" stroke-dasharray="2 3" stroke-linecap="round"/>
            <path d="M175 138 Q185 132 192 142 Q188 155 178 160 Q168 155 168 142 Z" fill="none" stroke="rgba(255,255,255,.45)" stroke-width="1.3" stroke-dasharray="2 3" stroke-linecap="round"/>
            <!-- Central hub glow with accent -->
            <circle cx="88" cy="100" r="32" fill="url(#globeGlowBg)"/>
            <circle cx="88" cy="100" r="12" fill="rgba(255,255,255,.98)"/>
            <circle cx="88" cy="100" r="6" fill="rgba(254,186,2,.4)"/>
          </svg>
        </div>
      </div>
    </div>
  </section>

  <div class="topbar">
    <div class="brand"><span class="dot"></span><span>CareerPicker</span></div>
    <div class="top-actions">
      <button class="backBtn" id="backBtn" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back
      </button>
      <div class="pill">About</div>
      <div class="pill primary">Save (later)</div>
    </div>
  </div>

  <div id="appContent" style="display:none;">
  <section class="hero mainContent" id="mainContent">
    <div class="wrap">
      <h1>Find your next career</h1>
      <p id="heroLine">
        <strong>First question:</strong> Do you already have a dream job in mind, or do you want to explore what's possible with your score?
      </p>

      <!-- Intent fork CTAs -->
      <div class="intentFork" id="intentFork">
        <div class="intentCard primary" data-intent="score-first" id="intentScoreFirst">
          <span class="badge-primary">Primary</span>
          <span class="emoji">üéØ</span>
          <h3 class="intentTitle">I have an ATAR/GPA ‚Äî show my options</h3>
          <p class="intentDesc">See realistic career pathways based on your score. Quick exploration mode.</p>
        </div>
        <div class="intentCard" data-intent="job-first" id="intentJobFirst">
          <span class="emoji">‚≠ê</span>
          <h3 class="intentTitle">I have a dream job ‚Äî what ATAR do I need?</h3>
          <p class="intentDesc">Evaluate a specific career and get a reality check with alternative pathways.</p>
        </div>
      </div>

      <div class="searchRow" id="searchRow" style="display:none;">
        <div class="searchGrid" id="searchGrid">
          <!-- Profession -->
          <div class="field">
            <div class="icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M7 7h10v14H7V7z" stroke="#0f172a" stroke-width="1.8" />
                <path d="M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2" stroke="#0f172a" stroke-width="1.8"/>
              </svg>
            </div>
            <div class="fieldcol">
              <div class="label">Already have a job in mind? (optional)</div>
              <div class="dropdown">
                <input id="professionInput" class="inputlike" placeholder="Start typing‚Ä¶ (real list only)" autocomplete="off" />
                <div class="sub" id="professionSub">Real list: leave blank to see options for your score.</div>

                <div class="dropPanel" id="dropPanel">
                  <div class="dropHeader">
                    <div class="t">Professions</div>
                    <div class="h">Type to filter ‚Ä¢ Scroll ‚Ä¢ Enter to select</div>
                  </div>
                  <div class="dropList" id="dropList"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Score -->
          <div class="field">
            <div class="icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M7 3h10v18H7V3z" stroke="#0f172a" stroke-width="1.8"/>
                <path d="M9 7h6M9 11h6M9 15h4" stroke="#0f172a" stroke-width="1.8"/>
              </svg>
            </div>
            <div class="fieldcol"> 
              <div class="label" id="scoreLabel">ATAR (0.00‚Äì99.95)</div>
              <div class="smallrow">
                <input id="scoreInput" class="inputlike" type="text" inputmode="decimal" placeholder="Enter your ATAR" />
              </div>
              <div class="sub" id="modeText">Mode: ATAR</div>
            </div>
          </div>

          <!-- Lifestyle goal -->
          <div class="field">
            <div class="icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M12 2v20" stroke="#0f172a" stroke-width="1.8"/>
                <path d="M17 6.5c0-1.7-1.6-3-5-3s-5 1.3-5 3 1.2 2.6 5 3 5 1.3 5 3-1.6 3-5 3-5-1.3-5-3" stroke="#0f172a" stroke-width="1.8"/>
              </svg>
            </div>
            <div class="fieldcol">
              <div class="label">Lifestyle goal (long-term)</div>
              <div class="value" style="margin-top:2px;">
                <select id="salarySelect" class="inputlike" style="font-size:18px;font-weight:950;">
                  <option value="self">Low ‚Äî self only ($45k‚Äì$70k)</option>
                  <option value="couple" selected>Medium ‚Äî couple/shared ($70k‚Äì$110k)</option>
                  <option value="family">High ‚Äî family costs ($110k‚Äì$160k)</option>
                  <option value="growth">High growth ‚Äî ambitious ($160k+)</option>
                </select>
              </div>
              <div class="sub">Used to prioritise results, not remove options.</div>
            </div>
          </div>

          <!-- CTA -->
          <button class="cta" id="searchBtn" type="button" aria-label="Get shortlist">
            <div class="btn-inner">
              <div class="main" id="ctaText">Show my options ‚Üí</div>
              <div class="sub" id="ctaSub">Two paths (explore mode)</div>
            </div>
          </button>
        </div>
      </div>

      <div class="chipRow">
        <div class="chip clickable" data-chip="real-list"><span class="dot2"></span><strong>Real-list matching</strong></div>
        <div class="chip clickable" data-chip="explainable"><span class="dot2"></span><strong>Explainable output</strong></div>
        <div class="chip clickable" data-chip="evidence"><span class="dot2"></span><strong>Prototype-safe evidence notes</strong></div>
        <div class="chip clickable" id="eligibleChip" data-chip="eligible"><span class="dot2"></span><strong>Eligible in list:</strong> 0 / 0</div>
      </div>

      <!-- Career Picker logo (shown before intent selection) -->
      <div class="aestheticStudyBlock" id="aestheticStudyBlock">
        <div class="aestheticFrame">
          <div class="aestheticImgWrap">
            <div class="logoMark" aria-hidden="true">
              <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs>
                  <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#0071c2"/>
                    <stop offset="100%" stop-color="#003580"/>
                  </linearGradient>
                </defs>
                <circle cx="32" cy="32" r="30" fill="url(#logoGrad)"/>
                <path d="M20 32 L28 40 L44 24" fill="none" stroke="#feba02" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <h2 class="logoText">Career Picker</h2>
            <p class="logoSlogan">Your path to the right career</p>
            <p class="logoAbout">Career Picker helps you discover career paths that match your ATAR or GPA score, or find out what score you need for your dream job. Explore hundreds of real professions with tailored pathways and reality checks.</p>
          </div>
        </div>
      </div>

      <!-- Studies & Interests Input (shown after intent selection) -->
      <div class="studiesSection hidden" id="studiesSection">
        <div class="studiesHeader">
          <span class="studiesIcon">üìñ</span>
          <div class="studiesTitle">What have you studied so far and what are you liking?</div>
        </div>
        <div class="studiesInputWrapper">
          <div class="studiesTagsContainer" id="studiesTagsContainer"></div>
          <div class="studiesInputContainer">
            <input 
              type="text" 
              id="studiesInput" 
              class="studiesInput" 
              placeholder="Type to search subjects (e.g., Biology, Math, Business)..."
              autocomplete="off"
            />
            <div class="studiesDropdown" id="studiesDropdown">
              <div class="studiesDropdownList" id="studiesDropdownList"></div>
            </div>
          </div>
          <div class="studiesHint">Select subjects you're studying or interested in. This helps us match careers that align with your background.</div>
        </div>
      </div>

      <div class="filters hidden" id="filters">
        <div class="filterGroup">
          <span class="groupLabel">üìö Study Duration</span>
          <div class="filterOptions">
            <div class="filterPill on" data-group="study" data-value="any">Any</div>
            <div class="filterPill" data-group="study" data-value="0-1">0‚Äì1 year</div>
            <div class="filterPill" data-group="study" data-value="2-3">2‚Äì3 years</div>
            <div class="filterPill" data-group="study" data-value="4+">4+ years</div>
          </div>
        </div>
        
        <div class="filterGroup">
          <span class="groupLabel">üë• Work Focus</span>
          <div class="filterOptions">
            <div class="filterPill on" data-group="ps" data-value="any">Any</div>
            <div class="filterPill" data-group="ps" data-value="people">More people</div>
            <div class="filterPill" data-group="ps" data-value="systems">More systems</div>
          </div>
        </div>
        
        <div class="filterGroup">
          <span class="groupLabel">üíº Activity Level</span>
          <div class="filterOptions">
            <div class="filterPill on" data-group="da" data-value="any">Any</div>
            <div class="filterPill" data-group="da" data-value="desk">Desk-based</div>
            <div class="filterPill" data-group="da" data-value="active">On your feet</div>
          </div>
        </div>
        
        <div class="filterGroup">
          <span class="groupLabel">üè¢ Work Environment</span>
          <div class="filterOptions">
            <div class="filterPill on" data-group="io" data-value="any">Any</div>
            <div class="filterPill" data-group="io" data-value="indoor">Indoor</div>
            <div class="filterPill" data-group="io" data-value="outdoor">Outdoor</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <main class="main">
    <div class="wrap">
      <div id="resultsFramingContainer" style="display:none;"></div>
      
      <h2 id="mainHeading">Your shortlist</h2>
      <p class="hint" id="mainHint">Click a card to expand details. (Each card is different.)</p>

      <div id="evaluationContainer" style="display:none;"></div>
      <div id="mergePromptContainer" style="display:none;"></div>
      <div id="refineContainer" style="display:none;"></div>
      <div id="results" style="display:none;"></div>

      <div class="btnRow">
        <button class="ghost" id="resetBtn">Reset</button>
      </div>
    </div>
  </main>
  </div>

  <!-- Mode modal -->
  <div class="modalWrap" id="modeModal" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalTop">
        <h3>Start: Are you using ATAR or GPA?</h3>
        <p>
          We‚Äôll filter professions based on your score. Low scores still have options (traineeships, retail, hospitality, trades).<br/>
          Example: ‚ÄúDoctor‚Äù won‚Äôt appear unless your score is high enough.
        </p>
      </div>
      <div class="modalBody">
        <div class="modeGrid">
          <div class="modeCard" data-mode="ATAR" id="modeCardATAR">
            <div class="m1">ATAR (0‚Äì99.95)</div>
            <div class="m2">Australian high school planning.</div>
          </div>
          <div class="modeCard" data-mode="GPA" id="modeCardGPA">
            <div class="m1">GPA (0‚Äì100)</div>
            <div class="m2">If you‚Äôre treating GPA like a 0‚Äì100 score.</div>
          </div>
        </div>
      </div>
      <div class="modalFoot">
        Note: These are simple cutoffs (not official requirements). We can refine later by university/state.
      </div>
    </div>
  </div>

  <!-- Info modal -->
  <div class="modalWrap" id="infoModal" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalTop">
        <h3 id="infoModalTitle">Information</h3>
        <p id="infoModalContent"></p>
      </div>
      <div class="modalFoot">
        <button class="btn primary" id="infoModalClose">Close</button>
      </div>
    </div>
  </div>

  <!-- Job detail modal (full-screen career + universities) -->
  <div class="modalWrap jobDetailModalWrap" id="jobDetailModal" role="dialog" aria-modal="true">
    <div class="modal jobDetailModal">
      <button class="jobDetailClose" id="jobDetailClose" type="button" aria-label="Close">√ó</button>
      <div id="jobDetailContent" class="jobDetailContent"></div>
    </div>
  </div>

  <script>
    // ---------- State ----------
    const state = {
      country: null,              // user's country name (e.g. "Australia")
      selectedCountry: null,     // full country object { name, usesATAR } - set on front screen
      mode: null,                 // "ATAR" | "GPA"
      intent: null,               // "score-first" | "job-first" - tracks user's primary entry flow
      score: 0,
      salary: "couple",            // self | couple | family | growth
      selectedProfession: null,    // profession object
      studiesAndInterests: [],     // array of selected subject IDs
      filters: {
        study: "any",  // any | 0-1 | 2-3 | 4+
        ps: "any",     // any | people | systems
        da: "any",     // any | desk | active
        io: "any"      // any | indoor | outdoor
      },
      showAdvancedFilters: false,  // toggle for lifestyle goal section
      contextMerged: false,        // true when user adds second context (ATAR+job or job+ATAR)
      hasSearched: false           // true after user clicks "Show my options" - prevents auto-showing results
    };

    // ---------- Helpers ----------
    const $ = (id) => document.getElementById(id);

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function parseScore(raw){
      const x = Number(String(raw).replace(/[^0-9.]/g,''));
      if (!Number.isFinite(x)) return null;
      if (state.mode === "ATAR") return clamp(x, 0, 99.95);
      return clamp(x, 0, 100);
    }

    function salaryBiasPoints(salaryBand){
      // IMPORTANT: Salary is used for RANKING BIAS ONLY, not exclusion
      // It adds 0-12 points to scoring to prioritize matching salary bands
      const map = {
        self:   {low: 10, mid: 4,  high: 1,  elite: 0},
        couple: {low: 3,  mid: 10, high: 4,  elite: 1},
        family: {low: 1,  mid: 4,  high: 10, elite: 5},
        growth: {low: 0,  mid: 2,  high: 7,  elite: 12},
      };
      return (map[state.salary] || map.couple)[salaryBand] ?? 0;
    }

    // ---------- Intent flow helpers ----------
    function renderIntentFork(){
      const hasMode = state.mode !== null;
      const hasJob = state.selectedProfession !== null;
      
      // If both exist, skip straight to results
      if (hasMode && hasJob){
        $('intentFork').style.display = 'none';
        $('searchRow').style.display = 'block';
        renderSearchRow();
        $('heroLine').innerHTML = 'Viewing results for <strong>' + state.selectedProfession.name + '</strong> with your ' + state.mode + ' score.';
        return;
      }
      
      // If has mode but no job, show only job-first option
      if (hasMode && !hasJob){
        $('intentScoreFirst').style.display = 'none';
        $('intentJobFirst').style.display = 'block';
        $('heroLine').innerHTML = 'You have a ' + state.mode + ' score. Want to <strong>search for a specific career</strong> to evaluate?';
        return;
      }
      
      // If has job but no mode, show only score-first option
      if (!hasMode && hasJob){
        $('intentScoreFirst').style.display = 'block';
        $('intentJobFirst').style.display = 'none';
        $('heroLine').innerHTML = 'You picked <strong>' + state.selectedProfession.name + '</strong>. Now choose your scoring system to see if it\'s achievable.';
        return;
      }
      
      // Show both options (initial state)
      const intentFork = $('intentFork');
      if (intentFork) {
        intentFork.style.display = 'grid';
      }
      $('intentScoreFirst').style.display = 'block';
      $('intentJobFirst').style.display = 'block';
      $('heroLine').innerHTML = '<strong>First question:</strong> Do you already have a dream job in mind, or do you want to explore what\'s possible with your score?';
    }
    
    function selectIntent(intent){
      console.log('selectIntent called with:', intent);
      if (!intent) {
        console.error('No intent provided to selectIntent');
        return;
      }
      
      state.intent = intent;
      
      // Visual feedback
      document.querySelectorAll('.intentCard').forEach(card => {
        card.classList.remove('selected');
      });
      const selectedCard = $(`intent${intent === 'score-first' ? 'ScoreFirst' : 'JobFirst'}`);
      if (selectedCard) {
        selectedCard.classList.add('selected');
      }
      
      // Update hero text based on intent
      if (intent === 'score-first'){
        $('heroLine').innerHTML = 'Great! You want to <strong>explore options based on your score</strong>. First, choose your scoring system (ATAR or GPA).';
      } else {
        $('heroLine').innerHTML = 'Perfect! You have a <strong>dream job in mind</strong>. Choose your scoring system to see what score you need.';
      }
      
      // Show mode selection modal
      showModeModal();
      updateBackButton();
    }
    
    function renderSearchRow(){
      const grid = $('searchGrid');
      const searchRow = $('searchRow');
      
      if (state.intent === 'score-first'){
        // Flow A: Score-first - Just score + button, NO lifestyle goal at entry
        searchRow.style.display = 'block';
        grid.style.gridTemplateColumns = '1fr 1fr'; // 2 columns: score, button
        
        grid.innerHTML = `
          <!-- Score (main focus) -->
          <div class="field">
            <div class="icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M7 3h10v18H7V3z" stroke="#0f172a" stroke-width="1.8"/>
                <path d="M9 7h6M9 11h6M9 15h4" stroke="#0f172a" stroke-width="1.8"/>
              </svg>
            </div>
            <div class="fieldcol">
              <div class="label" id="scoreLabel">${labelForMode().label}</div>
              <div class="smallrow">
                <input id="scoreInput" class="inputlike" inputmode="decimal" placeholder="Enter your ${state.mode}" />
              </div>
              <div class="sub" id="modeText">Mode: ${state.mode}</div>
            </div>
          </div>
          
          <!-- CTA -->
          <button class="cta" id="searchBtn" type="button" aria-label="Get shortlist">
            <div class="btn-inner">
              <div class="main" id="ctaText">Show my options ‚Üí</div>
              <div class="sub" id="ctaSub">Score-based exploration</div>
            </div>
          </button>
        `;
        
        // Re-attach listeners - wait for DOM to be ready
        setTimeout(() => {
          const scoreInput = $('scoreInput');
          const searchBtn = $('searchBtn');
          
          if (scoreInput) {
            // Allow free typing - update state on input (but don't show results until button is clicked)
            scoreInput.addEventListener('input', (e) => {
              const rawValue = e.target.value.trim();
              console.log('Score input changed:', rawValue);
              
              // Only parse and update state if there's actual input (don't run search yet)
              if (rawValue) {
                const v = parseScore(rawValue);
                if (v !== null) {
                  state.score = v;
                  console.log('State updated to:', state.score);
                  // Don't auto-run - wait for button click
                }
              } else {
                // Clear state if input is empty
                state.score = 0;
              }
            });
            
            // Format the value when user finishes typing (blur) - only if they entered something
            scoreInput.addEventListener('blur', (e) => {
              const rawValue = e.target.value.trim();
              if (rawValue && state.score !== null && state.score > 0) {
                if (state.mode === 'ATAR') {
                  e.target.value = state.score.toFixed(2);
                } else {
                  e.target.value = state.score.toFixed(0);
                }
              }
            });
            
            // Focus the input - it's empty so cursor will be at start, ready for typing
            scoreInput.focus();
          }
          
          if (searchBtn) {
            searchBtn.addEventListener('click', () => {
              console.log('Score-first button clicked');
              state.hasSearched = true;
              runSearch(true);
            });
          }
          
          // Don't auto-run if input is empty - wait for user to type
          // runSearch(false); // Removed - let user type first
        }, 50);
        
      } else {
        // Flow B: Job-first - Just job search + button (NO score input yet)
        searchRow.style.display = 'block';
        grid.style.gridTemplateColumns = '2fr 1fr'; // 2 columns: profession search, CTA
        
        grid.innerHTML = `
          <!-- Profession (main focus for Flow B) -->
          <div class="field">
            <div class="icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M7 7h10v14H7V7z" stroke="#0f172a" stroke-width="1.8" />
                <path d="M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2" stroke="#0f172a" stroke-width="1.8"/>
              </svg>
            </div>
            <div class="fieldcol">
              <div class="label">Search for your dream job</div>
              <div class="dropdown">
                <input id="professionInput" class="inputlike" placeholder="Type to search (e.g., Doctor, Nurse, Lawyer)" autocomplete="off" />
                <div class="sub" id="professionSub">Select from real list of ~220 professions</div>

                <div class="dropPanel" id="dropPanel">
                  <div class="dropHeader">
                    <div class="t">Professions</div>
                    <div class="h">Type to filter ‚Ä¢ Scroll ‚Ä¢ Enter to select</div>
                  </div>
                  <div class="dropList" id="dropList"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- CTA -->
          <button class="cta" id="searchBtn" type="button" aria-label="Show requirements">
            <div class="btn-inner">
              <div class="main" id="ctaText">What ${state.mode} do I need? ‚Üí</div>
              <div class="sub" id="ctaSub">See required score</div>
            </div>
          </button>
        `;
        
        // Re-attach profession dropdown listeners (required)
        $('professionInput').addEventListener('focus', () => {
          openDrop();
          renderDropList();
        });
        $('professionInput').addEventListener('input', () => {
          if (state.selectedProfession && $('professionInput').value.trim() !== state.selectedProfession.name){
            state.selectedProfession = null;
            $('professionSub').textContent = 'Select from real list of ~220 professions';
          }
          openDrop();
          renderDropList();
        });
        $('professionInput').addEventListener('keydown', handleDropdownKeyboard);
        
        // Button shows requirements when job is selected
        $('searchBtn').addEventListener('click', () => {
          if (!state.selectedProfession) {
            alert('Select a job from the list to see requirements.');
            return;
          }
          showJobRequirements();
        });
        
        // Clear and hide results initially - only show after button click
        const framingContainerFlowB = $('resultsFramingContainer');
        const evalContainerFlowB = $('evaluationContainer');
        const mergeContainerFlowB = $('mergePromptContainer');
        const resultsDivFlowB = $('results');
        
        if (framingContainerFlowB) {
          framingContainerFlowB.innerHTML = '';
          framingContainerFlowB.style.display = 'none';
        }
        if (evalContainerFlowB) {
          evalContainerFlowB.innerHTML = '';
          evalContainerFlowB.style.display = 'none';
        }
        if (mergeContainerFlowB) {
          mergeContainerFlowB.innerHTML = '';
          mergeContainerFlowB.style.display = 'none';
        }
        if (resultsDivFlowB) {
          resultsDivFlowB.innerHTML = '';
          resultsDivFlowB.style.display = 'none';
        }
        $('mainHeading').textContent = 'Your evaluation';
        $('mainHint').textContent = 'Select a job above to see requirements and alternatives.';
      }
    }
    
    function handleDropdownKeyboard(e){
      if (!$("dropPanel").classList.contains("open")) return;

      if (e.key === "ArrowDown"){
        e.preventDefault();
        dropIndex = Math.min(dropIndex + 1, filteredList.length - 1);
        highlightRow();
      }
      if (e.key === "ArrowUp"){
        e.preventDefault();
        dropIndex = Math.max(dropIndex - 1, 0);
        highlightRow();
      }
      if (e.key === "Enter"){
        e.preventDefault();
        const pick = filteredList[dropIndex];
        if (pick){
          selectProfession(pick);
          closeDrop();
          state.hasSearched = true;
          runSearch(true);
        }
      }
      if (e.key === "Escape"){
        closeDrop();
      }
    }

    function labelForMode(){
      if (state.mode === "GPA") return {label:"GPA (0‚Äì100)", max:100};
      return {label:"ATAR (0.00‚Äì99.95)", max:99.95};
    }

    // ---------- Profession dataset ----------
    // Goal: "way more jobs" + real list filtering + always some low-score options.
    // We generate ~220 items from curated cores + variants.
    const BASE = [
      // Health
      {name:"Doctor", cat:"Health", minATAR:95.0, minGPA:90, study: "4+", ps:"people", da:"active", io:"indoor", salary:"elite",
        tags:["Medicine","Hospital","Care","Diagnosis"],
        why:["High academic cutoff (varies by uni/state).","Long training pathway.","High responsibility + strong long-term earnings."],
        start:["Strong science subjects (bio/chem recommended).","Research med entry pathways + prerequisites.","Volunteer/shadow where possible."],
        evidence:{formal:["University prerequisites + selection ranks vary."], rule:["Often requires top ATAR / high GPA."], varies:["State/uni & pathway (postgrad) change cutoffs."]}},
      {name:"Nurse", cat:"Health", minATAR:65.0, minGPA:60, study: "2-3", ps:"people", da:"active", io:"indoor", salary:"mid",
        tags:["Care","Hospital","Teamwork","Shift work"],
        why:["People-focused + practical work.","Many entry pathways (uni/TAFE).","Stable demand across Australia."],
        start:["Look up Bachelor of Nursing requirements.","Consider EN-to-RN pathway via TAFE.","First aid + volunteering helps."],
        evidence:{formal:["Registration required (AHPRA)."], rule:["Shift work common."], varies:["Entry depends on provider + locations."]}},
      {name:"Paramedic", cat:"Health", minATAR:78.0, minGPA:72, study:"2-3", ps:"people", da:"active", io:"outdoor", salary:"high",
        tags:["Emergency","Ambulance","Critical care","Stress"],
        why:["Hands-on urgent care.","Competitive in some states.","Fitness + communication important."],
        start:["Check state ambulance services + uni programs.","Improve fitness + first aid.","Build customer service + calm under pressure."],
        evidence:{formal:["Service selection processes vary."], rule:["Fitness testing common."], varies:["State intake changes yearly."]}},
      {name:"Psychologist", cat:"Health", minATAR:85.0, minGPA:78, study:"4+", ps:"people", da:"desk", io:"indoor", salary:"high",
        tags:["Mental health","Counselling","Research","Listening"],
        why:["People + communication heavy.","Postgrad often needed for registration.","Wide workplaces (schools, clinics, orgs)."],
        start:["Check accredited psychology pathways.","Build writing/research skills.","Volunteer in support roles."],
        evidence:{formal:["Accreditation + registration rules apply."], rule:["Postgrad is common for full registration."], varies:["Specialties have different pathways."]}},

      // Law / Justice / Government
      {name:"Lawyer", cat:"Law", minATAR:88.0, minGPA:80, study:"4+", ps:"people", da:"desk", io:"indoor", salary:"high",
        tags:["Law","Court","Contracts","Advice"],
        why:["Good match if you enjoy reading/writing/argument.","Entry depends on university selection + performance.","Strong progression once qualified."],
        start:["Research law degrees + double degrees.","Build writing + logic skills.","Try debating / mock trial."],
        evidence:{formal:["Admission requirements apply after degree."], rule:["Top firms are highly competitive."], varies:["Cutoffs vary by uni."]}},
      {name:"Paralegal", cat:"Law", minATAR:55.0, minGPA:55, study:"0-1", ps:"people", da:"desk", io:"indoor", salary:"mid",
        tags:["Legal support","Documents","Admin","Detail"],
        why:["Entry via diploma/experience possible.","Strong for detail + organisation.","Can be a pathway into law."],
        start:["Consider legal studies diploma/TAFE.","Build admin + writing skills.","Look for junior roles in firms."],
        evidence:{formal:["None always required."], rule:["Experience can matter more than ATAR."], varies:["Employer expectations differ."]}},
      {name:"Police Officer", cat:"Justice", minATAR:45.0, minGPA:45, study:"0-1", ps:"people", da:"active", io:"outdoor", salary:"mid",
        tags:["Public service","Fitness","Communication","Training"],
        why:["Fits if you like structure + public service.","Physical + communication skills matter.","Clear training pipelines."],
        start:["Check state police recruitment requirements.","Build fitness + community experience.","Work on calm decision-making."],
        evidence:{formal:["Recruitment tests + background checks."], rule:["Fitness + communication are key."], varies:["State rules differ."]}},
      {name:"Detective", cat:"Justice", minATAR:60.0, minGPA:60, study:"2-3", ps:"people", da:"active", io:"outdoor", salary:"high",
        tags:["Investigation","Interviews","Evidence","Casework"],
        why:["Usually a progression from policing.","Strong for curiosity + persistence.","Paperwork + people skills both matter."],
        start:["Start with policing or relevant degrees.","Practice report writing.","Develop observation skills."],
        evidence:{formal:["Internal selection/progression applies."], rule:["Not entry-level in most places."], varies:["Agency pathways differ."]}},
      {name:"Policy Officer", cat:"Government", minATAR:65.0, minGPA:60, study:"2-3", ps:"systems", da:"desk", io:"indoor", salary:"mid",
        tags:["Government","Systems","Research","Impact"],
        why:["Good if you like systems + fairness + large-scale impact.","Stable career paths.","Can combine with law/business."],
        start:["Consider public policy/arts/law degrees.","Build writing + analysis skills.","Follow current affairs + submissions."],
        evidence:{formal:["Role requirements vary by department."], rule:["Strong writing is a must."], varies:["APS/VPS/State hiring differs."]}},

      // Tech
      {name:"Software Developer", cat:"Tech", minATAR:60.0, minGPA:60, study:"2-3", ps:"systems", da:"desk", io:"indoor", salary:"high",
        tags:["Coding","Apps","Problem solving","Build"],
        why:["Strong for analytical problem solving.","Multiple entry paths (uni/TAFE/self-taught).","Good salary growth over time."],
        start:["Learn basics (Python/JS).","Build 2 small projects.","Try a diploma or CS/IT degree."],
        evidence:{formal:["None strictly required."], rule:["Portfolio matters a lot."], varies:["Employers differ on degrees."]}},
      {name:"Cybersecurity Analyst", cat:"Tech", minATAR:70.0, minGPA:68, study:"2-3", ps:"systems", da:"desk", io:"indoor", salary:"high",
        tags:["Security","Networks","Risk","Blue team"],
        why:["Systems-minded + detail-heavy.","Growing demand.","Certs help (but not mandatory)."],
        start:["Learn networking basics.","Try labs (CTFs).","Consider entry IT role ‚Üí security."],
        evidence:{formal:["Some gov roles need clearances."], rule:["Certs can boost employability."], varies:["Specialties vary widely."]}},
      {name:"Data Analyst", cat:"Tech", minATAR:65.0, minGPA:62, study:"2-3", ps:"systems", da:"desk", io:"indoor", salary:"high",
        tags:["Data","Excel/SQL","Insights","Charts"],
        why:["Great if you like patterns + numbers.","Wide industries.","Clear portfolio projects possible."],
        start:["Learn Excel + SQL.","Do a small dataset project.","Study business analytics / IT."],
        evidence:{formal:["None required for many roles."], rule:["Projects > grades often."], varies:["Tools differ by company."]}},

      // Trades / Low score must-have options
      {name:"Electrician", cat:"Trades", minATAR:20.0, minGPA:20, study:"2-3", ps:"systems", da:"active", io:"indoor", salary:"high",
        tags:["Apprenticeship","Hands-on","Licensed","Building"],
        why:["Strong option at low scores (apprenticeship).","Good long-term earnings once qualified.","Practical + problem-solving work."],
        start:["Look for apprenticeship programs.","Get white card + basic safety.","Build math + wiring fundamentals."],
        evidence:{formal:["Licensing required."], rule:["Apprenticeships are the main route."], varies:["State licensing rules differ."]}},
      {name:"Plumber", cat:"Trades", minATAR:15.0, minGPA:15, study:"2-3", ps:"people", da:"active", io:"outdoor", salary:"high",
        tags:["Apprenticeship","On-site","Fix/build","Licensed"],
        why:["Hands-on + strong demand.","Good pathways without high ATAR.","Income improves with experience."],
        start:["Apply for apprenticeship.","Get basic tickets (white card).","Build physical stamina + customer skills."],
        evidence:{formal:["Licensing required."], rule:["Weekend/emergency work can pay more."], varies:["Specialties (gas/roof) differ."]}},
      {name:"Retail Team Member", cat:"Retail", minATAR:0.0, minGPA:0, study:"0-1", ps:"people", da:"active", io:"indoor", salary:"low",
        tags:["Customer service","Entry","Flexible","Skills"],
        why:["Accessible at any score.","Builds communication + reliability.","Can lead to supervisor/manager roles."],
        start:["Resume + availability.","Practice customer service.","Learn POS + stock basics."],
        evidence:{formal:["None."], rule:["Reliability is the #1 factor."], varies:["Pay varies by award/role."]}},
      {name:"Hospitality Crew", cat:"Hospitality", minATAR:0.0, minGPA:0, study:"0-1", ps:"people", da:"active", io:"indoor", salary:"low",
        tags:["Fast pace","Customer","Teamwork","Shifts"],
        why:["Accessible + fast skill building.","Great for people skills.","Can move into chef/manager routes."],
        start:["RSA/food handling (if needed).","Learn time management.","Apply widely."],
        evidence:{formal:["Some venues require certificates."], rule:["Weekend shifts common."], varies:["Pay/conditions vary."]}},

      // Business & Finance
      {name:"Financial Planner", cat:"Business", minATAR:72.0, minGPA:68, study:"4+", ps:"people", da:"desk", io:"indoor", salary:"high",
        tags:["Finance","Advice","Clients","Investment"],
        why:["Strong people skills + financial knowledge.","Build client relationships.","Commission-based growth potential."],
        start:["Study business/finance.","Learn about investments + super.","Build trust + communication skills."],
        evidence:{formal:["ASIC registration required."], rule:["Experience matters for clients."], varies:["Qualifications are evolving."]}},
      {name:"Investment Banker", cat:"Business", minATAR:92.0, minGPA:88, study:"4+", ps:"systems", da:"desk", io:"indoor", salary:"elite",
        tags:["Finance","Deals","Analysis","Pressure"],
        why:["Top ATAR pathway.","Long hours but high earning potential.","Competitive + fast-paced."],
        start:["Target top-tier business/commerce degrees.","Build Excel + finance skills.","Network + apply for internships."],
        evidence:{formal:["Degree required."], rule:["Internships critical for entry."], varies:["Bank requirements differ."]}},
      {name:"Actuary", cat:"Business", minATAR:95.0, minGPA:90, study:"4+", ps:"systems", da:"desk", io:"indoor", salary:"elite",
        tags:["Math","Risk","Insurance","Analysis"],
        why:["High ATAR + strong math skills.","Specialized + well-compensated.","Long study pathway with exams."],
        start:["Study actuarial science/math.","Practice statistics + probability.","Join actuarial student programs."],
        evidence:{formal:["Actuarial Institute exams."], rule:["Math ability is critical."], varies:["Pathways are structured."]}},
      {name:"Economist", cat:"Business", minATAR:85.0, minGPA:80, study:"4+", ps:"systems", da:"desk", io:"indoor", salary:"high",
        tags:["Economics","Research","Policy","Data"],
        why:["Good for analytical thinking.","Work in government/banks/research.","Strong communication + data skills."],
        start:["Study economics degree.","Learn data analysis + stats.","Follow economic news."],
        evidence:{formal:["Degree usually required."], rule:["Research skills matter."], varies:["Roles vary widely."]}},
      {name:"Management Consultant", cat:"Business", minATAR:88.0, minGPA:83, study:"4+", ps:"people", da:"desk", io:"indoor", salary:"elite",
        tags:["Strategy","Clients","Problem solving","Travel"],
        why:["Fast-paced problem solving.","Work across industries.","Strong career progression."],
        start:["Study commerce/business.","Develop case interview skills.","Target top firms early."],
        evidence:{formal:["Top degrees preferred."], rule:["Internships key."], varies:["Firm cultures differ."]}},
      {name:"Supply Chain Manager", cat:"Business", minATAR:65.0, minGPA:62, study:"2-3", ps:"systems", da:"desk", io:"indoor", salary:"high",
        tags:["Logistics","Planning","Systems","Efficiency"],
        why:["Systems-focused + problem solving.","Critical business function.","Good progression paths."],
        start:["Study business/logistics.","Learn planning systems.","Start in operations roles."],
        evidence:{formal:["Varies by industry."], rule:["Experience valued."], varies:["Certifications optional."]}},

      // Engineering & Science
      {name:"Mechanical Engineer", cat:"Engineering", minATAR:80.0, minGPA:75, study:"4+", ps:"systems", da:"desk", io:"indoor", salary:"high",
        tags:["Engineering","Design","Machines","Math"],
        why:["Strong math + physics.","Design + build systems.","Wide industry applications."],
        start:["Study engineering degree.","Build CAD + math skills.","Join engineering projects."],
        evidence:{formal:["Engineers Australia accreditation."], rule:["Registration helps."], varies:["Specialties vary."]}},
      {name:"Electrical Engineer", cat:"Engineering", minATAR:82.0, minGPA:77, study:"4+", ps:"systems", da:"desk", io:"indoor", salary:"high",
        tags:["Electrical","Circuits","Power","Systems"],
        why:["Strong technical + problem solving.","Work on power/electronics/control.","Good job security."],
        start:["Study electrical engineering.","Learn circuit fundamentals.","Practice with projects."],
        evidence:{formal:["Accreditation preferred."], rule:["Math ability critical."], varies:["Roles diverse."]}},
      {name:"Environmental Scientist", cat:"Science", minATAR:75.0, minGPA:70, study:"4+", ps:"systems", da:"active", io:"outdoor", salary:"mid",
        tags:["Environment","Research","Field work","Sustainability"],
        why:["Outdoor + lab work mix.","Impact on environment.","Growing field."],
        start:["Study environmental science.","Gain field experience.","Learn GIS + data tools."],
        evidence:{formal:["Degree required."], rule:["Field skills valued."], varies:["Roles vary by sector."]}},
      {name:"Geologist", cat:"Science", minATAR:70.0, minGPA:68, study:"4+", ps:"systems", da:"active", io:"outdoor", salary:"high",
        tags:["Earth","Mining","Field work","Resources"],
        why:["Outdoor field work.","Work in mining/resources.","Strong demand in regions."],
        start:["Study geology degree.","Join field trips.","Learn mapping + sampling."],
        evidence:{formal:["Degree required."], rule:["FIFO work common."], varies:["Mining cycles affect jobs."]}},
      {name:"Marine Biologist", cat:"Science", minATAR:78.0, minGPA:72, study:"4+", ps:"systems", da:"active", io:"outdoor", salary:"mid",
        tags:["Ocean","Research","Conservation","Field work"],
        why:["Work with marine life.","Research + conservation focus.","Field + lab work."],
        start:["Study marine science.","Volunteer in conservation.","Get diving certification."],
        evidence:{formal:["Degree required."], rule:["Competitive field."], varies:["Funding affects roles."]}},
      {name:"Biotechnology Researcher", cat:"Science", minATAR:88.0, minGPA:83, study:"4+", ps:"systems", da:"desk", io:"indoor", salary:"high",
        tags:["Lab","Research","Innovation","Science"],
        why:["Cutting-edge science.","Lab-based work.","Postgrad often needed."],
        start:["Study biotechnology/science.","Gain lab experience.","Consider honors/PhD pathway."],
        evidence:{formal:["Advanced degrees common."], rule:["Research skills key."], varies:["Funding varies."]}},

      // Creative & Media
      {name:"Film Director", cat:"Media", minATAR:45.0, minGPA:45, study:"2-3", ps:"people", da:"active", io:"outdoor", salary:"mid",
        tags:["Film","Creative","Vision","Leadership"],
        why:["Creative leadership.","Portfolio matters most.","Competitive but rewarding."],
        start:["Study film/media.","Make short films.","Network in industry."],
        evidence:{formal:["Portfolio over grades."], rule:["Experience critical."], varies:["Paths highly varied."]}},
      {name:"Sound Engineer", cat:"Media", minATAR:35.0, minGPA:35, study:"0-1", ps:"systems", da:"active", io:"indoor", salary:"mid",
        tags:["Audio","Technical","Music","Events"],
        why:["Technical + creative mix.","Work in studios/live events.","Hands-on skills."],
        start:["Learn audio basics.","Practice with DAW software.","Get cert or apprenticeship."],
        evidence:{formal:["Certs help."], rule:["Portfolio key."], varies:["Freelance common."]}},
      {name:"Animator", cat:"Creative", minATAR:55.0, minGPA:52, study:"2-3", ps:"people", da:"desk", io:"indoor", salary:"mid",
        tags:["Animation","3D","Creative","Software"],
        why:["Creative + technical skills.","Work in film/games/ads.","Portfolio-based hiring."],
        start:["Learn animation software.","Create demo reel.","Study animation/design."],
        evidence:{formal:["Portfolio matters most."], rule:["Software skills critical."], varies:["Specialties vary."]}},
      {name:"Copywriter", cat:"Media", minATAR:60.0, minGPA:58, study:"2-3", ps:"people", da:"desk", io:"indoor", salary:"mid",
        tags:["Writing","Ads","Creative","Persuasion"],
        why:["Writing + creative thinking.","Work in agencies/brands.","Portfolio builds career."],
        start:["Study marketing/communications.","Build writing portfolio.","Pitch spec ads."],
        evidence:{formal:["Portfolio over degree."], rule:["Creativity valued."], varies:["Agency cultures differ."]}},
      {name:"Art Director", cat:"Creative", minATAR:65.0, minGPA:62, study:"2-3", ps:"people", da:"desk", io:"indoor", salary:"high",
        tags:["Design","Leadership","Campaigns","Vision"],
        why:["Creative leadership.","Work on campaigns.","Combine art + strategy."],
        start:["Study design/advertising.","Build portfolio.","Start as designer."],
        evidence:{formal:["Portfolio critical."], rule:["Experience > degree."], varies:["Progression varies."]}},

      // Education & Training
      {name:"University Lecturer", cat:"Education", minATAR:90.0, minGPA:85, study:"4+", ps:"people", da:"desk", io:"indoor", salary:"high",
        tags:["Teaching","Research","Academic","PhD"],
        why:["Research + teaching mix.","PhD usually required.","Academic career path."],
        start:["Excel in undergrad.","Complete honors/PhD.","Publish research."],
        evidence:{formal:["PhD required."], rule:["Publications matter."], varies:["Field affects jobs."]}},
      {name:"Corporate Trainer", cat:"Education", minATAR:55.0, minGPA:52, study:"2-3", ps:"people", da:"active", io:"indoor", salary:"mid",
        tags:["Training","Adults","Presenting","Skills"],
        why:["Teaching adults in workplace.","Presentation skills key.","Variety of topics."],
        start:["Gain workplace experience.","Develop presentation skills.","Get Cert IV TAE."],
        evidence:{formal:["TAE cert helps."], rule:["Experience valued."], varies:["Industries differ."]}},
      {name:"School Counsellor", cat:"Education", minATAR:80.0, minGPA:75, study:"4+", ps:"people", da:"desk", io:"indoor", salary:"mid",
        tags:["Counselling","Students","Support","Care"],
        why:["Help students.","Psychology + education.","Stable school environment."],
        start:["Study psychology/education.","Gain counselling qualifications.","Work with young people."],
        evidence:{formal:["Registration required."], rule:["Dual quals common."], varies:["State rules differ."]}},

      // Hospitality & Tourism
      {name:"Hotel Manager", cat:"Hospitality", minATAR:50.0, minGPA:50, study:"2-3", ps:"people", da:"active", io:"indoor", salary:"high",
        tags:["Management","Service","Operations","Leadership"],
        why:["Leadership in hospitality.","Work up from entry roles.","People + operations mix."],
        start:["Study hospitality management.","Work in hotels.","Build supervisory experience."],
        evidence:{formal:["Degree helps."], rule:["Experience critical."], varies:["Chain vs boutique differ."]}},
      {name:"Tour Guide", cat:"Tourism", minATAR:0.0, minGPA:0, study:"0-1", ps:"people", da:"active", io:"outdoor", salary:"low",
        tags:["Tourism","Presenting","Travel","People"],
        why:["Meet people from everywhere.","Share knowledge.","Flexible + seasonal."],
        start:["Get local tourism knowledge.","Practice presenting.","Apply to tour companies."],
        evidence:{formal:["Licenses vary by location."], rule:["People skills key."], varies:["Seasonal work."]}},
      {name:"Event Coordinator", cat:"Hospitality", minATAR:45.0, minGPA:45, study:"0-1", ps:"people", da:"active", io:"indoor", salary:"mid",
        tags:["Events","Planning","Coordination","Stress"],
        why:["Organize events + functions.","Fast-paced + varied.","People + logistics."],
        start:["Study event management.","Volunteer at events.","Build organization skills."],
        evidence:{formal:["Certs help."], rule:["Experience valued."], varies:["Event types vary."]}},

      // Trades - Additional
      {name:"Bricklayer", cat:"Trades", minATAR:10.0, minGPA:10, study:"2-3", ps:"systems", da:"active", io:"outdoor", salary:"high",
        tags:["Building","Apprenticeship","Physical","Hands-on"],
        why:["Physical + skilled work.","Apprenticeship pathway.","Good earnings potential."],
        start:["Apply for apprenticeship.","Build physical fitness.","Get white card."],
        evidence:{formal:["Apprenticeship standard."], rule:["Weather affects work."], varies:["Specialties exist."]}},
      {name:"Welder", cat:"Trades", minATAR:10.0, minGPA:10, study:"2-3", ps:"systems", da:"active", io:"indoor", salary:"high",
        tags:["Welding","Metal","Technical","Licensed"],
        why:["Precision technical work.","High demand in industries.","Multiple welding types."],
        start:["Get welding cert/apprenticeship.","Practice techniques.","Learn safety standards."],
        evidence:{formal:["Certs required."], rule:["Ticket levels vary."], varies:["Industries differ."]}},
      {name:"Locksmith", cat:"Trades", minATAR:10.0, minGPA:10, study:"0-1", ps:"systems", da:"active", io:"indoor", salary:"mid",
        tags:["Security","Keys","Technical","Mobile"],
        why:["Problem solving + security.","Mobile work often.","Self-employment possible."],
        start:["Get locksmith training.","Apprentice or course.","Build customer trust."],
        evidence:{formal:["Security licensing."], rule:["Background checks."], varies:["State rules differ."]}},
      {name:"Painter & Decorator", cat:"Trades", minATAR:5.0, minGPA:5, study:"0-1", ps:"people", da:"active", io:"indoor", salary:"mid",
        tags:["Painting","Finish","Detail","Apprenticeship"],
        why:["Accessible entry.","Detail + finish work.","Flexible work options."],
        start:["Apprenticeship or start as laborer.","Build finishing skills.","Get white card."],
        evidence:{formal:["Not always required."], rule:["Quality matters."], varies:["Residential vs commercial."]}},
      {name:"Landscaper", cat:"Trades", minATAR:0.0, minGPA:0, study:"0-1", ps:"people", da:"active", io:"outdoor", salary:"mid",
        tags:["Outdoors","Gardens","Physical","Design"],
        why:["Outdoor physical work.","Creative + practical.","Seasonal variations."],
        start:["Start as laborer.","Learn plants + design.","Build portfolio."],
        evidence:{formal:["Certs optional."], rule:["Experience valued."], varies:["Design vs maintenance."]}},
    ];

    // Add more categories quickly via templates (to reach 300+ jobs).
    const CATEGORY_SEEDS = [
      // name, cat, minATAR, study, ps, da, io, salaryBand, tags
      ["Accountant","Business",70,"2-3","systems","desk","indoor","high",["Finance","Compliance","Reporting","Detail"]],
      ["Marketing Specialist","Business",55,"2-3","people","desk","indoor","mid",["Campaigns","Brand","Copy","Analytics"]],
      ["Teacher (Primary)","Education",70,"4+","people","active","indoor","mid",["Teaching","Kids","Planning","Care"]],
      ["Teacher (Secondary)","Education",75,"4+","people","active","indoor","mid",["Teaching","Subjects","Planning","Care"]],
      ["Chef","Hospitality",20,"2-3","people","active","indoor","mid",["Food","Kitchen","Skills","Pressure"]],
      ["Mechanic","Trades",10,"2-3","systems","active","indoor","high",["Cars","Fixing","Tools","Apprenticeship"]],
      ["Carpenter","Trades",10,"2-3","systems","active","outdoor","high",["Building","Tools","Apprenticeship","Site"]],
      ["Graphic Designer","Creative",50,"2-3","people","desk","indoor","mid",["Design","Visual","Portfolio","Brand"]],
      ["UI/UX Designer","Creative",65,"2-3","people","desk","indoor","high",["Design","Research","Prototypes","Product"]],
      ["Journalist","Media",65,"2-3","people","desk","outdoor","mid",["Writing","News","Interviews","Story"]],
      ["Physiotherapist","Health",85,"4+","people","active","indoor","high",["Rehab","Movement","Care","Science"]],
      ["Pharmacist","Health",88,"4+","people","desk","indoor","high",["Medicines","Accuracy","Care","Science"]],
      ["Architect","Built",80,"4+","systems","desk","indoor","high",["Buildings","Design","CAD","Rules"]],
      ["Civil Engineer","Built",82,"4+","systems","desk","outdoor","high",["Infrastructure","Math","Projects","Sites"]],
      ["Registered Nurse (ICU)","Health",75,"4+","people","active","indoor","high",["Critical care","Hospital","Skills","Shift"]],
      ["Vet Nurse","Health",35,"0-1","people","active","indoor","mid",["Animals","Care","Clinic","Support"]],
      ["Veterinarian","Health",92,"4+","people","active","indoor","high",["Animals","Medicine","Science","Care"]],
      ["Air Traffic Controller","Aviation",85,"2-3","systems","desk","indoor","high",["Safety","Focus","Training","Rules"]],
      ["Pilot","Aviation",80,"2-3","systems","desk","indoor","high",["Flying","Training","Safety","Navigation"]],
      ["Firefighter","Emergency",55,"0-1","people","active","outdoor","high",["Fitness","Rescue","Team","Training"]],
      ["Social Worker","Community",70,"4+","people","desk","indoor","mid",["Support","Care","Communication","Systems"]],
      ["Occupational Therapist","Health",85,"4+","people","active","indoor","high",["Rehab","Care","Plans","Science"]],
      ["Speech Pathologist","Health",85,"4+","people","desk","indoor","high",["Communication","Care","Kids","Therapy"]],
      ["Dentist","Health",97,"4+","people","desk","indoor","elite",["Teeth","Precision","Care","Clinic"]],
      ["Dental Assistant","Health",20,"0-1","people","active","indoor","mid",["Clinic","Support","Care","Sterilization"]],
      ["Surveyor","Built",65,"2-3","systems","active","outdoor","high",["Mapping","Sites","Tools","Math"]],
      ["Real Estate Agent","Sales",30,"0-1","people","active","outdoor","mid",["Sales","Homes","Commission","People"]],
      ["Business Analyst","Business",70,"2-3","systems","desk","indoor","high",["Requirements","Process","Stakeholders","Data"]],
      ["Project Manager","Business",65,"2-3","people","desk","indoor","high",["Planning","Teams","Delivery","Comms"]],
      ["Navy Officer","Defence",70,"2-3","people","active","outdoor","mid",["Leadership","Training","Service","Discipline"]],
      ["Army Technician","Defence",20,"0-1","systems","active","outdoor","mid",["Technical","Training","Service","Tools"]],
      ["Librarian","Education",55,"2-3","people","desk","indoor","mid",["Research","Books","Organisation","Support"]],
      ["Translator","Language",55,"2-3","people","desk","indoor","mid",["Languages","Writing","Culture","Accuracy"]],
      ["Chef de Partie","Hospitality",30,"2-3","people","active","indoor","mid",["Kitchen","Skills","Pressure","Team"]],
      ["Aged Care Worker","Community",0,"0-1","people","active","indoor","low",["Care","Support","Patience","Shifts"]],
      ["Disability Support Worker","Community",0,"0-1","people","active","indoor","mid",["Care","Support","Communication","Plan"]],
      ["Childcare Educator","Education",0,"0-1","people","active","indoor","mid",["Kids","Care","Play","Safety"]],
      ["Barista","Hospitality",0,"0-1","people","active","indoor","low",["Coffee","Customer","Speed","Skills"]],
      ["Truck Driver","Logistics",0,"0-1","systems","active","outdoor","mid",["Driving","Routes","Safety","Deliveries"]],
      ["Warehouse Picker","Logistics",0,"0-1","systems","active","indoor","low",["Warehouse","Speed","Accuracy","Team"]],
      ["Forklift Operator","Logistics",0,"0-1","systems","active","indoor","mid",["Tickets","Safety","Warehouse","Ops"]],
      ["Receptionist","Admin",0,"0-1","people","desk","indoor","low",["Phones","Scheduling","Customer","Admin"]],
      ["Office Administrator","Admin",10,"0-1","people","desk","indoor","mid",["Admin","Docs","Support","Systems"]],
      ["Executive Assistant","Admin",45,"0-1","people","desk","indoor","mid",["Organisation","Calendars","Trust","Speed"]],
      ["HR Coordinator","Business",50,"0-1","people","desk","indoor","mid",["Hiring","People","Process","Support"]],
      ["HR Manager","Business",70,"2-3","people","desk","indoor","high",["People","Policy","Leadership","Comms"]],
      ["Content Creator","Media",20,"0-1","people","desk","indoor","mid",["Video","Social","Story","Consistency"]],
      ["Videographer","Media",35,"0-1","people","active","outdoor","mid",["Camera","Editing","Shoots","Story"]],
      ["Photographer","Media",20,"0-1","people","active","outdoor","mid",["Camera","Clients","Portfolio","Light"]],
      ["Fitness Trainer","Sports",0,"0-1","people","active","indoor","mid",["Fitness","Coaching","Clients","Energy"]],
      ["Nutritionist","Health",70,"2-3","people","desk","indoor","mid",["Food","Advice","Care","Science"]],
      
      // Additional seeds for more variety
      ["Chemical Engineer","Engineering",85,"4+","systems","desk","indoor","high",["Chemicals","Processes","Safety","Plant"]],
      ["Aerospace Engineer","Engineering",90,"4+","systems","desk","indoor","elite",["Aircraft","Space","Design","Math"]],
      ["Biomedical Engineer","Engineering",88,"4+","systems","desk","indoor","high",["Medical devices","Innovation","Health","Tech"]],
      ["Mining Engineer","Engineering",80,"4+","systems","active","outdoor","elite",["Mining","Resources","Sites","Planning"]],
      ["Software Architect","Tech",85,"4+","systems","desk","indoor","elite",["Architecture","Design","Systems","Leadership"]],
      ["DevOps Engineer","Tech",75,"2-3","systems","desk","indoor","high",["Automation","Cloud","CI/CD","Infrastructure"]],
      ["Game Developer","Tech",65,"2-3","systems","desk","indoor","mid",["Games","Unity","C#","Creative"]],
      ["Database Administrator","Tech",60,"2-3","systems","desk","indoor","high",["Databases","SQL","Backup","Performance"]],
      ["Network Engineer","Tech",65,"2-3","systems","desk","indoor","high",["Networks","Cisco","Infrastructure","Security"]],
      ["Web Developer","Tech",45,"0-1","systems","desk","indoor","mid",["Websites","HTML/CSS/JS","Frontend","Backend"]],
      ["Mobile App Developer","Tech",60,"2-3","systems","desk","indoor","high",["Apps","iOS/Android","Mobile","UX"]],
      ["AI/ML Engineer","Tech",88,"4+","systems","desk","indoor","elite",["AI","Machine learning","Python","Models"]],
      ["Blockchain Developer","Tech",75,"2-3","systems","desk","indoor","high",["Blockchain","Crypto","Smart contracts","Web3"]],
      ["Quality Assurance Tester","Tech",35,"0-1","systems","desk","indoor","mid",["Testing","Bugs","Quality","Detail"]],
      ["IT Support Technician","Tech",25,"0-1","systems","desk","indoor","mid",["Support","Troubleshoot","Help desk","Tickets"]],
      ["Systems Analyst","Tech",65,"2-3","systems","desk","indoor","high",["Analysis","Requirements","Business","Tech"]],
      ["UX Researcher","Creative",70,"2-3","people","desk","indoor","high",["Research","Users","Testing","Insights"]],
      ["Product Designer","Creative",68,"2-3","people","desk","indoor","high",["Product","Design","Figma","Strategy"]],
      ["Illustrator","Creative",40,"0-1","people","desk","indoor","mid",["Drawing","Digital art","Clients","Portfolio"]],
      ["3D Modeler","Creative",55,"2-3","systems","desk","indoor","mid",["3D","Blender/Maya","Modeling","Textures"]],
      ["Motion Graphics Designer","Creative",50,"2-3","people","desk","indoor","mid",["Motion","After Effects","Animation","Video"]],
      ["Interior Designer","Creative",60,"2-3","people","desk","indoor","mid",["Interiors","Space","CAD","Clients"]],
      ["Fashion Designer","Creative",55,"2-3","people","desk","indoor","mid",["Fashion","Textiles","Sewing","Portfolio"]],
      ["Industrial Designer","Creative",70,"4+","systems","desk","indoor","high",["Products","Manufacturing","CAD","Innovation"]],
      ["Midwife","Health",80,"4+","people","active","indoor","high",["Birth","Maternity","Care","Support"]],
      ["Radiographer","Health",82,"4+","people","active","indoor","high",["X-ray","Imaging","Medical","Technical"]],
      ["Optometrist","Health",88,"4+","people","desk","indoor","high",["Eyes","Vision","Testing","Glasses"]],
      ["Chiropractor","Health",85,"4+","people","active","indoor","high",["Spine","Musculoskeletal","Treatment","Clinic"]],
      ["Podiatrist","Health",78,"4+","people","desk","indoor","mid",["Feet","Treatment","Clinic","Care"]],
      ["Paramedic Supervisor","Health",80,"4+","people","active","outdoor","high",["Leadership","Emergency","Ambulance","Training"]],
      ["Dietitian","Health",80,"4+","people","desk","indoor","high",["Nutrition","Clinical","Health","Plans"]],
      ["Medical Scientist","Health",85,"4+","systems","desk","indoor","high",["Lab","Research","Pathology","Analysis"]],
      ["Epidemiologist","Health",88,"4+","systems","desk","indoor","high",["Disease","Public health","Data","Research"]],
      ["Audiologist","Health",82,"4+","people","desk","indoor","high",["Hearing","Testing","Aids","Clinic"]],
      ["Forensic Scientist","Science",85,"4+","systems","desk","indoor","high",["Crime","Lab","Analysis","Evidence"]],
      ["Meteorologist","Science",80,"4+","systems","desk","indoor","mid",["Weather","Forecasting","Data","Climate"]],
      ["Astronomer","Science",90,"4+","systems","desk","indoor","mid",["Space","Research","Telescopes","Physics"]],
      ["Chemist","Science",75,"4+","systems","desk","indoor","mid",["Chemistry","Lab","Research","Analysis"]],
      ["Physicist","Science",88,"4+","systems","desk","indoor","high",["Physics","Research","Theory","Lab"]],
      ["Agricultural Scientist","Science",70,"4+","systems","active","outdoor","mid",["Farming","Crops","Research","Sustainability"]],
      ["Food Technologist","Science",68,"4+","systems","desk","indoor","mid",["Food","Processing","Safety","Innovation"]],
      ["Conservation Officer","Science",65,"2-3","people","active","outdoor","mid",["Environment","Wildlife","Protection","Field"]],
      ["Town Planner","Built",75,"4+","systems","desk","indoor","high",["Urban planning","Zoning","Development","Community"]],
      ["Quantity Surveyor","Built",72,"4+","systems","desk","indoor","high",["Construction","Costs","Estimates","Contracts"]],
      ["Building Inspector","Built",50,"2-3","systems","active","outdoor","mid",["Inspections","Compliance","Building codes","Reports"]],
      ["Urban Designer","Built",78,"4+","people","desk","indoor","high",["Cities","Public space","Design","Planning"]],
      ["Construction Manager","Built",65,"2-3","people","active","outdoor","high",["Sites","Management","Teams","Projects"]],
      ["Structural Engineer","Built",85,"4+","systems","desk","indoor","high",["Structures","Calculations","Design","Safety"]],
      ["Flight Attendant","Aviation",0,"0-1","people","active","indoor","mid",["Service","Travel","Safety","Customer"]],
      ["Aircraft Maintenance Engineer","Aviation",60,"2-3","systems","active","indoor","high",["Aircraft","Maintenance","Safety","Licensed"]],
      ["Customs Officer","Government",50,"0-1","people","active","outdoor","mid",["Border","Inspections","Compliance","Security"]],
      ["Immigration Officer","Government",55,"2-3","people","desk","indoor","mid",["Immigration","Cases","Policy","Interviews"]],
      ["Diplomat","Government",90,"4+","people","desk","indoor","elite",["Foreign affairs","Negotiation","Policy","Travel"]],
      ["Intelligence Analyst","Government",80,"4+","systems","desk","indoor","high",["Security","Analysis","Intelligence","Clearance"]],
      ["Urban Planner","Government",75,"4+","systems","desk","indoor","high",["Planning","Cities","Policy","Development"]],
      ["Court Reporter","Law",40,"0-1","systems","desk","indoor","mid",["Transcription","Court","Accuracy","Speed"]],
      ["Judge","Law",98,"4+","people","desk","indoor","elite",["Law","Court","Decisions","Experience"]],
      ["Barrister","Law",92,"4+","people","desk","indoor","elite",["Court","Advocacy","Arguments","Law"]],
      ["Conveyancer","Law",45,"0-1","systems","desk","indoor","mid",["Property","Settlements","Contracts","Legal"]],
      ["Compliance Officer","Business",65,"2-3","systems","desk","indoor","high",["Compliance","Risk","Regulations","Audit"]],
      ["Auditor","Business",75,"4+","systems","desk","indoor","high",["Audit","Finance","Compliance","Analysis"]],
      ["Tax Accountant","Business",72,"4+","systems","desk","indoor","high",["Tax","Compliance","Planning","Returns"]],
      ["Financial Analyst","Business",75,"4+","systems","desk","indoor","high",["Finance","Analysis","Investment","Reports"]],
      ["Risk Manager","Business",78,"4+","systems","desk","indoor","high",["Risk","Insurance","Analysis","Strategy"]],
      ["Insurance Broker","Business",45,"0-1","people","desk","indoor","mid",["Insurance","Sales","Clients","Policies"]],
      ["Stockbroker","Business",80,"4+","people","desk","indoor","high",["Stocks","Trading","Clients","Markets"]],
      ["Commercial Pilot","Aviation",75,"2-3","systems","desk","indoor","elite",["Flying","Commercial","Training","Hours"]],
      ["Helicopter Pilot","Aviation",70,"2-3","systems","active","outdoor","high",["Helicopter","Flying","Training","Rescue"]],
      ["Air Marshal","Aviation",75,"2-3","people","active","indoor","high",["Security","Air travel","Protection","Training"]],
      ["Corrections Officer","Justice",35,"0-1","people","active","indoor","mid",["Prisons","Security","Supervision","Safety"]],
      ["Youth Worker","Community",50,"2-3","people","active","indoor","mid",["Youth","Support","Mentoring","Programs"]],
      ["Community Developer","Community",60,"2-3","people","desk","indoor","mid",["Community","Programs","Development","Social"]],
      ["Addiction Counsellor","Community",70,"4+","people","desk","indoor","mid",["Counselling","Addiction","Support","Recovery"]],
      ["Career Counsellor","Education",65,"4+","people","desk","indoor","mid",["Careers","Guidance","Students","Planning"]],
      ["Education Researcher","Education",85,"4+","systems","desk","indoor","mid",["Research","Education","Policy","Analysis"]],
      ["Museum Curator","Arts",75,"4+","people","desk","indoor","mid",["Collections","History","Exhibitions","Research"]],
      ["Archivist","Arts",68,"4+","systems","desk","indoor","mid",["Records","Preservation","History","Organisation"]],
      ["Art Therapist","Health",80,"4+","people","active","indoor","mid",["Therapy","Art","Mental health","Creative"]],
      ["Music Therapist","Health",78,"4+","people","active","indoor","mid",["Therapy","Music","Health","Wellbeing"]],
      ["Orchestra Conductor","Arts",85,"4+","people","active","indoor","mid",["Music","Leadership","Performance","Classical"]],
      ["Music Producer","Media",50,"2-3","systems","desk","indoor","mid",["Music","Production","Studio","Sound"]],
      ["Radio Presenter","Media",35,"0-1","people","desk","indoor","mid",["Radio","Presenting","Voice","Entertainment"]],
      ["Sports Journalist","Media",65,"2-3","people","active","outdoor","mid",["Sports","Writing","Broadcasting","Interviews"]],
      ["News Anchor","Media",75,"4+","people","desk","indoor","high",["News","Presenting","Broadcasting","Current affairs"]],
      ["Documentary Filmmaker","Media",60,"2-3","people","active","outdoor","mid",["Documentary","Film","Story","Research"]],
      ["Video Editor","Media",40,"0-1","systems","desk","indoor","mid",["Editing","Video","Post-production","Software"]],
      ["Podcast Producer","Media",35,"0-1","people","desk","indoor","mid",["Podcasts","Audio","Editing","Content"]],
      ["Public Relations Manager","Business",68,"2-3","people","desk","indoor","high",["PR","Media","Communications","Crisis"]],
      ["Brand Manager","Business",72,"4+","people","desk","indoor","high",["Brand","Strategy","Marketing","Campaigns"]],
      ["SEO Specialist","Business",50,"0-1","systems","desk","indoor","mid",["SEO","Google","Content","Analytics"]],
      ["Digital Marketing Manager","Business",65,"2-3","people","desk","indoor","high",["Digital","Marketing","Strategy","Analytics"]],
      ["Social Media Manager","Business",45,"0-1","people","desk","indoor","mid",["Social media","Content","Engagement","Strategy"]],
      ["E-commerce Manager","Business",60,"2-3","people","desk","indoor","mid",["Online sales","E-commerce","Strategy","Analytics"]],
      ["Sales Manager","Business",55,"2-3","people","desk","indoor","high",["Sales","Leadership","Targets","Team"]],
      ["Customer Success Manager","Business",58,"2-3","people","desk","indoor","mid",["Clients","Retention","Support","Strategy"]],
      ["Account Manager","Business",52,"2-3","people","desk","indoor","mid",["Clients","Relationships","Sales","Service"]],
      ["Recruitment Consultant","Business",40,"0-1","people","desk","indoor","mid",["Hiring","Candidates","Clients","Matching"]],
    ];

    function buildProfessionList(){
      const out = [];

      // 1) Base curated
      for (const p of BASE) out.push(attachDefaults(p));

      // 2) Seeds + variants to create "wayyy more jobs"
      const variants = [
        ["Assistant","Support ‚Ä¢ entry ‚Ä¢ help"],
        ["Coordinator","Organise ‚Ä¢ logistics ‚Ä¢ details"],
        ["Officer","Compliance ‚Ä¢ process ‚Ä¢ admin"],
        ["Specialist","Focused ‚Ä¢ skilled ‚Ä¢ growth"],
        ["Senior","Experience ‚Ä¢ leadership ‚Ä¢ mentoring"],
      ];

      for (const s of CATEGORY_SEEDS){
        const [name, cat, minATAR, study, ps, da, io, salary, tags] = s;
        out.push(attachDefaults({
          name, cat,
          minATAR, minGPA: Math.max(0, minATAR - 5),
          study, ps, da, io, salary,
          tags,
          why: [
            `Matches ${ps === "people" ? "people-focused" : "systems-focused"} work style.`,
            `Study length: ${study === "0-1" ? "short course/entry pathway" : (study === "2-3" ? "diploma/degree" : "longer degree path")}.`,
            `Typical progression exists with experience.`
          ],
          start: [
            "Look up entry pathways (TAFE/uni/entry role).",
            "Build 1 small project/experience proof (portfolio, volunteering, part-time).",
            "Talk to someone doing the job (short interview)."
          ],
          evidence:{
            formal:["Requirements vary by employer/provider."],
            rule:["Portfolio/experience often boosts entry."],
            varies:["State/industry changes requirements."]
          }
        }));

        // add variants (not for every seed to avoid being too repetitive)
        for (let i=0;i<variants.length;i++){
          const [suffix, meta] = variants[i];
          const vName = `${name} ${suffix}`;
          out.push(attachDefaults({
            name: vName,
            cat,
            minATAR: Math.max(0, minATAR - (i+1)*8),
            minGPA: Math.max(0, (Math.max(0, minATAR - (i+1)*8) - 5)),
            study: i < 2 ? "0-1" : study,
            ps, da, io,
            salary: i === 0 ? "low" : (i === 1 ? "mid" : salary),
            tags: [...tags.slice(0,2), ...meta.split(" ‚Ä¢ ").slice(0,2)].slice(0,4),
            why: [
              `Variant of ${name} (more ${suffix.toLowerCase()} / pathway-focused).`,
              `Good for building skills and moving up into ${name}.`,
              `Score cutoffs here are ‚Äúrule of thumb‚Äù for the prototype.`
            ],
            start: [
              "Start with an entry role or short course.",
              "Ask for more responsibility over time.",
              `Aim toward ${name} as a next step.`
            ],
            evidence:{
              formal:["Depends on employer."],
              rule:["Entry roles are common pathways."],
              varies:["Titles differ across companies."]
            }
          }));
        }
      }

      // 3) Deduplicate by name (keep first)
      const seen = new Set();
      const dedup = [];
      for (const p of out){
        const key = p.name.toLowerCase();
        if (seen.has(key)) continue;
        seen.add(key);
        dedup.push(p);
      }

      // Ensure we have 200+ (we will)
      return dedup;
    }

    function attachDefaults(p){
      return {
        id: p.id || p.name.toLowerCase().replace(/[^a-z0-9]+/g,"-"),
        name: p.name,
        cat: p.cat || "Other",
        minATAR: Number.isFinite(p.minATAR) ? p.minATAR : 0,
        minGPA: Number.isFinite(p.minGPA) ? p.minGPA : 0,
        study: p.study || "0-1",
        ps: p.ps || "any",
        da: p.da || "any",
        io: p.io || "any",
        salary: p.salary || "mid",
        tags: p.tags || [],
        why: p.why || [],
        start: p.start || [],
        evidence: p.evidence || {formal:[], rule:[], varies:[]},
        sources: p.sources || ["Prototype notes (add links later)."],
      };
    }

    const PROFESSIONS = buildProfessionList();

    // ---------- Countries List (for location + ATAR/GPA availability) ----------
    // usesATAR: true = Australia etc. (ATAR available), false = USA etc. (GPA only)
    const COUNTRY_LIST = [
      { id: "australia", name: "Australia", usesATAR: true },
      { id: "new-zealand", name: "New Zealand", usesATAR: false },
      { id: "usa", name: "United States", usesATAR: false },
      { id: "usa-alt", name: "USA", usesATAR: false },
      { id: "canada", name: "Canada", usesATAR: false },
      { id: "uk", name: "United Kingdom", usesATAR: false },
      { id: "uk-alt", name: "UK", usesATAR: false },
      { id: "ireland", name: "Ireland", usesATAR: false },
      { id: "india", name: "India", usesATAR: false },
      { id: "china", name: "China", usesATAR: false },
      { id: "singapore", name: "Singapore", usesATAR: false },
      { id: "malaysia", name: "Malaysia", usesATAR: false },
      { id: "south-africa", name: "South Africa", usesATAR: false },
      { id: "germany", name: "Germany", usesATAR: false },
      { id: "france", name: "France", usesATAR: false },
      { id: "netherlands", name: "Netherlands", usesATAR: false },
      { id: "japan", name: "Japan", usesATAR: false },
      { id: "south-korea", name: "South Korea", usesATAR: false },
      { id: "pakistan", name: "Pakistan", usesATAR: false },
      { id: "bangladesh", name: "Bangladesh", usesATAR: false },
      { id: "nigeria", name: "Nigeria", usesATAR: false },
      { id: "brazil", name: "Brazil", usesATAR: false },
      { id: "mexico", name: "Mexico", usesATAR: false },
      { id: "philippines", name: "Philippines", usesATAR: false },
      { id: "indonesia", name: "Indonesia", usesATAR: false },
      { id: "thailand", name: "Thailand", usesATAR: false },
      { id: "vietnam", name: "Vietnam", usesATAR: false },
      { id: "hong-kong", name: "Hong Kong", usesATAR: false },
      { id: "uae", name: "United Arab Emirates", usesATAR: false },
      { id: "saudi-arabia", name: "Saudi Arabia", usesATAR: false },
      { id: "egypt", name: "Egypt", usesATAR: false },
      { id: "spain", name: "Spain", usesATAR: false },
      { id: "italy", name: "Italy", usesATAR: false },
      { id: "sweden", name: "Sweden", usesATAR: false },
      { id: "norway", name: "Norway", usesATAR: false },
      { id: "denmark", name: "Denmark", usesATAR: false },
      { id: "finland", name: "Finland", usesATAR: false },
      { id: "switzerland", name: "Switzerland", usesATAR: false },
      { id: "austria", name: "Austria", usesATAR: false },
      { id: "belgium", name: "Belgium", usesATAR: false },
      { id: "poland", name: "Poland", usesATAR: false },
      { id: "russia", name: "Russia", usesATAR: false },
      { id: "ukraine", name: "Ukraine", usesATAR: false },
      { id: "turkey", name: "Turkey", usesATAR: false },
      { id: "israel", name: "Israel", usesATAR: false },
      { id: "argentina", name: "Argentina", usesATAR: false },
      { id: "chile", name: "Chile", usesATAR: false },
      { id: "colombia", name: "Colombia", usesATAR: false },
      { id: "peru", name: "Peru", usesATAR: false },
      { id: "kenya", name: "Kenya", usesATAR: false },
      { id: "ghana", name: "Ghana", usesATAR: false },
      { id: "ethiopia", name: "Ethiopia", usesATAR: false },
      { id: "morocco", name: "Morocco", usesATAR: false },
      { id: "other", name: "Other", usesATAR: true },
    ];

    // ---------- Universities by country and field (for job detail view) ----------
    // fields: profession categories/tags this university is strong in
    const UNIVERSITIES = [
      { name: "Deakin University", country: "Australia", note: "Strong nutrition & dietetics", fields: ["Health","Food","Science","Nutrition"] },
      { name: "University of Sydney", country: "Australia", note: "Top health sciences", fields: ["Health","Science","Medicine","Business"] },
      { name: "University of Melbourne", country: "Australia", note: "Leading research university", fields: ["Health","Engineering","Tech","Law","Business","Science"] },
      { name: "Monash University", country: "Australia", note: "Strong in health & pharmacy", fields: ["Health","Engineering","Tech","Science","Business"] },
      { name: "UNSW Sydney", country: "Australia", note: "Excellent engineering & tech", fields: ["Engineering","Tech","Business","Law","Science"] },
      { name: "University of Queensland", country: "Australia", note: "Strong health & sciences", fields: ["Health","Science","Engineering","Business"] },
      { name: "University of Western Australia", country: "Australia", note: "Strong research programs", fields: ["Health","Engineering","Science","Business"] },
      { name: "University of Adelaide", country: "Australia", note: "Health & wine science", fields: ["Health","Science","Engineering"] },
      { name: "Queensland University of Technology", country: "Australia", note: "Practical, industry-focused", fields: ["Tech","Creative","Business","Engineering"] },
      { name: "University of Newcastle", country: "Australia", note: "Strong nursing & health", fields: ["Health","Education","Engineering"] },
      { name: "University of Oxford", country: "United Kingdom", note: "World-leading across disciplines", fields: ["Health","Law","Science","Engineering","Business"] },
      { name: "University of Cambridge", country: "United Kingdom", note: "Top global university", fields: ["Health","Engineering","Science","Law","Tech"] },
      { name: "Imperial College London", country: "United Kingdom", note: "Science, engineering, medicine", fields: ["Engineering","Health","Science","Tech"] },
      { name: "UCL", country: "United Kingdom", note: "Strong health & sciences", fields: ["Health","Science","Law","Engineering"] },
      { name: "King's College London", country: "United Kingdom", note: "Leading health & law", fields: ["Health","Law","Business","Science"] },
      { name: "London School of Economics", country: "United Kingdom", note: "Social sciences & business", fields: ["Business","Law","Government"] },
      { name: "MIT", country: "United States", note: "Top engineering & tech", fields: ["Engineering","Tech","Science","Business"] },
      { name: "Stanford University", country: "United States", note: "Tech, business, medicine", fields: ["Tech","Business","Health","Engineering"] },
      { name: "Harvard University", country: "United States", note: "World-leading across fields", fields: ["Health","Law","Business","Science","Government"] },
      { name: "Johns Hopkins University", country: "United States", note: "Top medical & health", fields: ["Health","Science","Engineering"] },
      { name: "UC Berkeley", country: "United States", note: "Strong tech & sciences", fields: ["Tech","Engineering","Science","Business"] },
      { name: "University of Michigan", country: "United States", note: "Strong across disciplines", fields: ["Health","Engineering","Business","Law"] },
      { name: "University of Toronto", country: "Canada", note: "Leading Canadian university", fields: ["Health","Engineering","Tech","Law","Business"] },
      { name: "University of British Columbia", country: "Canada", note: "Strong health & sciences", fields: ["Health","Science","Engineering","Business"] },
      { name: "McGill University", country: "Canada", note: "Medical & health sciences", fields: ["Health","Engineering","Science","Law"] },
      { name: "University of Auckland", country: "New Zealand", note: "Top NZ university", fields: ["Health","Engineering","Business","Science"] },
      { name: "National University of Singapore", country: "Singapore", note: "Leading Asian university", fields: ["Tech","Engineering","Business","Health"] },
    ];

    function getUniversitiesForProfession(p, countryName){
      const c = (countryName || "").toLowerCase();
      const profFields = new Set([p.cat, ...(p.tags || [])].map(f => f.toLowerCase()));
      const inCountry = u => {
        const uc = u.country.toLowerCase();
        if (c.includes("australia")) return uc.includes("australia");
        if (c.includes("united states") || c.includes("usa")) return uc.includes("united states");
        if (c.includes("united kingdom") || c.includes("uk")) return uc.includes("united kingdom");
        if (c.includes("canada")) return uc.includes("canada");
        if (c.includes("new zealand")) return uc.includes("new zealand");
        if (c.includes("singapore")) return uc.includes("singapore");
        return true;
      };
      const matchesField = u => {
        const uf = new Set((u.fields||[]).map(f=>f.toLowerCase()));
        return uf.has(p.cat.toLowerCase()) || [...profFields].some(pf=>uf.has(pf));
      };
      let list = UNIVERSITIES.filter(u => inCountry(u) && matchesField(u));
      if (list.length === 0) list = UNIVERSITIES.filter(matchesField).slice(0, 8);
      return list.slice(0, 8);
    }

    // ---------- Studies & Interests Subjects List ----------
    const SUBJECTS_LIST = [
      // Sciences
      {id: "biology", name: "Biology", categories: ["Health", "Science", "Animals"], tags: ["Research", "Laboratory", "Medical"]},
      {id: "chemistry", name: "Chemistry", categories: ["Health", "Science", "Engineering"], tags: ["Laboratory", "Research", "Pharmaceutical"]},
      {id: "physics", name: "Physics", categories: ["Engineering", "Science", "Tech"], tags: ["Research", "Analysis", "Technology"]},
      {id: "mathematics", name: "Mathematics", categories: ["Engineering", "Business", "Tech", "Science"], tags: ["Analysis", "Data", "Finance"]},
      {id: "statistics", name: "Statistics", categories: ["Business", "Tech", "Science"], tags: ["Data", "Analysis", "Research"]},
      
      // Health & Medicine
      {id: "medicine", name: "Medicine", categories: ["Health"], tags: ["Medical", "Care", "Diagnosis"]},
      {id: "nursing", name: "Nursing", categories: ["Health"], tags: ["Care", "Hospital", "People"]},
      {id: "psychology", name: "Psychology", categories: ["Health", "Education"], tags: ["Mental Health", "People", "Counselling"]},
      {id: "pharmacy", name: "Pharmacy", categories: ["Health", "Science"], tags: ["Medical", "Pharmaceutical", "Care"]},
      {id: "physiotherapy", name: "Physiotherapy", categories: ["Health", "Sports"], tags: ["Rehabilitation", "Care", "Active"]},
      
      // Engineering & Tech
      {id: "engineering", name: "Engineering", categories: ["Engineering", "Tech", "Trades"], tags: ["Design", "Problem Solving", "Systems"]},
      {id: "software", name: "Software/Computer Science", categories: ["Tech"], tags: ["Coding", "Programming", "Technology"]},
      {id: "data-science", name: "Data Science", categories: ["Tech", "Business", "Science"], tags: ["Data", "Analysis", "Technology"]},
      {id: "cybersecurity", name: "Cybersecurity", categories: ["Tech"], tags: ["Security", "Technology", "Systems"]},
      {id: "information-technology", name: "Information Technology", categories: ["Tech"], tags: ["Technology", "Systems", "Networking"]},
      
      // Business & Finance
      {id: "business", name: "Business", categories: ["Business"], tags: ["Management", "Finance", "Strategy"]},
      {id: "accounting", name: "Accounting", categories: ["Business"], tags: ["Finance", "Numbers", "Analysis"]},
      {id: "finance", name: "Finance", categories: ["Business"], tags: ["Finance", "Investment", "Analysis"]},
      {id: "economics", name: "Economics", categories: ["Business", "Government"], tags: ["Analysis", "Policy", "Finance"]},
      {id: "marketing", name: "Marketing", categories: ["Business", "Creative"], tags: ["Communication", "Strategy", "Creative"]},
      
      // Law & Justice
      {id: "law", name: "Law", categories: ["Law", "Justice", "Government"], tags: ["Legal", "Justice", "Policy"]},
      {id: "criminology", name: "Criminology", categories: ["Justice", "Law"], tags: ["Justice", "Investigation", "Policy"]},
      {id: "policing", name: "Policing", categories: ["Justice"], tags: ["Public Service", "Safety", "Active"]},
      
      // Education
      {id: "education", name: "Education", categories: ["Education"], tags: ["Teaching", "People", "Learning"]},
      {id: "early-childhood", name: "Early Childhood Education", categories: ["Education"], tags: ["Teaching", "Children", "Care"]},
      
      // Creative & Arts
      {id: "arts", name: "Arts", categories: ["Creative", "Education"], tags: ["Creative", "Design", "Media"]},
      {id: "design", name: "Design", categories: ["Creative"], tags: ["Creative", "Design", "Visual"]},
      {id: "media", name: "Media/Communications", categories: ["Creative", "Business"], tags: ["Media", "Communication", "Creative"]},
      {id: "journalism", name: "Journalism", categories: ["Creative", "Media"], tags: ["Writing", "Media", "Communication"]},
      
      // Trades & Practical
      {id: "trades", name: "Trades", categories: ["Trades"], tags: ["Hands-on", "Practical", "Building"]},
      {id: "construction", name: "Construction", categories: ["Trades", "Built"], tags: ["Building", "Practical", "Active", "Construction", "Sites", "Projects"]},
      {id: "automotive", name: "Automotive", categories: ["Trades", "Transport"], tags: ["Mechanical", "Practical", "Repair"]},
      
      // Other
      {id: "environmental", name: "Environmental Science", categories: ["Science", "Government"], tags: ["Environment", "Research", "Policy"]},
      {id: "social-work", name: "Social Work", categories: ["Health", "Government"], tags: ["People", "Care", "Support"]},
      {id: "sports", name: "Sports Science", categories: ["Sports", "Health"], tags: ["Fitness", "Active", "Health"]},
      {id: "hospitality", name: "Hospitality", categories: ["Hospitality"], tags: ["Service", "People", "Active"]},
    ];

    // ---------- Filtering + scoring ----------
    function isEligibleByScore(p){
      const s = state.score;
      if (state.mode === "GPA") return s >= p.minGPA;
      return s >= p.minATAR;
    }

    function passesFilters(p){
      const f = state.filters;

      if (f.study !== "any"){
        if (p.study !== f.study) return false;
      }
      if (f.ps !== "any"){
        if (p.ps !== f.ps) return false;
      }
      if (f.da !== "any"){
        if (p.da !== f.da) return false;
      }
      if (f.io !== "any"){
        if (p.io !== f.io) return false;
      }
      return true;
    }

    function similarity(a, b){
      // very simple similarity: shared category/tags
      if (!a || !b) return 0;
      let score = 0;
      if (a.cat === b.cat) score += 18;

      const ta = new Set(a.tags.map(x=>x.toLowerCase()));
      const tb = new Set(b.tags.map(x=>x.toLowerCase()));
      for (const t of ta) if (tb.has(t)) score += 6;

      if (a.ps === b.ps) score += 6;
      if (a.da === b.da) score += 4;
      if (a.io === b.io) score += 4;
      if (a.study === b.study) score += 3;

      return score;
    }

    function scoreProfession(p){
      // Base score: closer to your score range + salary bias + filters.
      const s = state.score;
      const req = (state.mode === "GPA") ? p.minGPA : p.minATAR;

      // closeness: if you're well above requirement, slight bonus; if just above, bigger bonus
      const margin = clamp(s - req, 0, 100);
      let base = 35;

      // reward being eligible, but not too far (keeps realistic)
      base += (margin < 8) ? 22 : (margin < 20 ? 16 : 10);

      // salary circumstance bias
      base += salaryBiasPoints(p.salary);

      // Studies & Interests matching boost (improved accuracy)
      if (state.studiesAndInterests && state.studiesAndInterests.length > 0) {
        let totalBoost = 0;

        state.studiesAndInterests.forEach(subjectId => {
          const subject = SUBJECTS_LIST.find(s => s.id === subjectId);
          if (!subject) return;

          // Category match (strongest boost - 30 points)
          if (subject.categories.includes(p.cat)) {
            totalBoost += 30;
          }

          // Tag overlap (medium boost - 12 points per matching tag)
          const subjectTags = new Set(subject.tags.map(t => t.toLowerCase()));
          const professionTags = new Set(p.tags.map(t => t.toLowerCase()));
          let tagMatches = 0;
          subjectTags.forEach(tag => {
            if (professionTags.has(tag)) {
              tagMatches++;
            }
          });
          totalBoost += tagMatches * 12;

          // Name/description keyword match (smaller boost - 8 points)
          const professionText = (p.name + " " + p.cat).toLowerCase();
          if (professionText.includes(subject.name.toLowerCase().split("/")[0])) {
            totalBoost += 8;
          }
        });

        // Cap the total boost at 80 points to make correlation more visible
        base += Math.min(totalBoost, 80);
      }

      // if profession selected, add similarity boost
      if (state.selectedProfession){
        base += similarity(state.selectedProfession, p);
      } else {
        // explore mode: small preference for variety + stability at lower scores
        if (s < 45 && (p.cat === "Trades" || p.cat === "Logistics" || p.cat === "Hospitality" || p.cat === "Retail")) base += 10;
      }

      return clamp(base, 5, 99);
    }

    function buildShortlist(){
      // 1) always compute eligible count (score-only)
      const eligibleAll = PROFESSIONS.filter(isEligibleByScore);
      $("eligibleChip").innerHTML = `<span class="dot2"></span><strong>Eligible in list:</strong> ${eligibleAll.length} / ${PROFESSIONS.length}`;

      // 2) actual results: eligible + filters
      let pool = eligibleAll.filter(p => passesFilters(p));

      // 3) if user typed a profession, strongly center around it (but still show related)
      if (state.selectedProfession){
        pool = pool
          .filter(p => p.id !== state.selectedProfession.id)
          .slice(); // copy
      }

      // 4) rank
      const ranked = pool
        .map(p => ({p, score: scoreProfession(p)}))
        .sort((a,b)=> b.score - a.score);

      // 5) pick top 8 (or 0 if none)
      return ranked.slice(0, 8);
    }

    // ---------- Rendering ----------
    function fmtStudy(x){
      if (x === "0-1") return "0‚Äì1 years";
      if (x === "2-3") return "2‚Äì3 years";
      return "4+ years";
    }
    function fmtWork(p){
      const ps = p.ps === "people" ? "People" : "Systems";
      const da = p.da === "desk" ? "Desk" : "On-feet";
      const io = p.io === "indoor" ? "Indoor" : "Outdoor";
      return `${ps} ‚Ä¢ ${da} ‚Ä¢ ${io}`;
    }
    function fmtSalaryBand(p){
      const map = {
        low: "Typical pay: $45k‚Äì$70k",
        mid: "Typical pay: $70k‚Äì$110k",
        high: "Typical pay: $110k‚Äì$160k",
        elite: "Typical pay: $160k+"
      };
      return map[p.salary] || map.mid;
    }
    function reqText(p){
      const v = (state.mode === "GPA") ? p.minGPA.toFixed(0) : p.minATAR.toFixed(2);
      const label = (state.mode === "GPA") ? "GPA" : "ATAR";
      return `Rule-of-thumb cutoff: ${label} ‚â• ${v}`;
    }

    function renderResults(){
      const host = $("results");
      if (!host) return;
      host.innerHTML = "";
      // Make sure results container is visible when rendering
      host.style.display = "block";

      const list = buildShortlist();

      // If explore mode and no results because filters too strict, show a helpful message + relax suggestion.
      if (list.length === 0){
        const d = document.createElement("div");
        d.className = "card";
        d.style.cursor = "default";
        d.innerHTML = `
          <div class="cardTitle">No matches with your current filters.</div>
          <div class="tags">
            <span class="tag">Tip</span>
            <span class="tag">Try Study: Any</span>
            <span class="tag">People/Systems: Any</span>
          </div>
          <ul class="bullets">
            <li>Your score still has options ‚Äî your filters are just very tight right now.</li>
            <li>Set filters back to ‚ÄúAny‚Äù to see a broader shortlist.</li>
          </ul>
        `;
        host.appendChild(d);
        return;
      }

      // If a profession is selected, show it as #0 (anchor card)
      if (state.selectedProfession){
        const isEligible = isEligibleByScore(state.selectedProfession);
        // Calculate actual match score, but cap it if not eligible
        const actualScore = isEligible ? scoreProfession(state.selectedProfession) : Math.min(scoreProfession(state.selectedProfession), 30);
        host.appendChild(renderCard(state.selectedProfession, actualScore, true, !isEligible));
      }

      for (let i=0;i<list.length;i++){
        host.appendChild(renderCard(list[i].p, list[i].score, false));
      }
    }

    function getMatchedSubjects(p){
      // Returns array of subject names that match this profession
      const matched = [];
      if (!state.studiesAndInterests || state.studiesAndInterests.length === 0) return matched;

      state.studiesAndInterests.forEach(subjectId => {
        const subject = SUBJECTS_LIST.find(s => s.id === subjectId);
        if (!subject) return;

        // Check if subject matches profession
        const categoryMatch = subject.categories.includes(p.cat);
        const subjectTags = new Set(subject.tags.map(t => t.toLowerCase()));
        const professionTags = new Set(p.tags.map(t => t.toLowerCase()));
        const hasTagOverlap = [...subjectTags].some(tag => professionTags.has(tag));
        const professionText = (p.name + " " + p.cat).toLowerCase();
        const nameMatch = professionText.includes(subject.name.toLowerCase().split("/")[0]);

        if (categoryMatch || hasTagOverlap || nameMatch) {
          matched.push(subject.name);
        }
      });

      return matched;
    }

    function renderCard(p, score, isAnchor, showRealityCheck = false){
      const card = document.createElement("div");
      card.className = "card";
      card.setAttribute("tabindex","0");

      const uniqueWhy = pickUniqueWhy(p, score);
      const uniqueStart = pickUniqueStart(p);
      const matchedSubjects = getMatchedSubjects(p);

      const anchorTag = isAnchor ? `<span class="tag">Selected profession</span>` : ``;

      // Matched subjects indicator
      const matchedSubjectsHTML = matchedSubjects.length > 0 ?
        `<span class="tag" style="background-color: #10b981; color: white; font-weight: 600;">
          ‚úì Matches ${matchedSubjects.length} subject${matchedSubjects.length > 1 ? 's' : ''}: ${escapeHtml(matchedSubjects.join(', '))}
        </span>` : '';

      // Reality check message for ineligible selected professions
      const realityCheckHTML = showRealityCheck ? `
        <div class="realityCheck">
          <div class="realityCheckIcon">üí°</div>
          <div class="realityCheckContent">
            <div class="realityCheckTitle">Reality check</div>
            <div class="realityCheckText">
              This career typically requires a ${state.mode === 'ATAR' ? 'ATAR' : 'GPA'} of ${state.mode === 'ATAR' ? p.minATAR.toFixed(2) : p.minGPA.toFixed(0)}+,
              and your current score is ${state.mode === 'ATAR' ? state.score.toFixed(2) : state.score.toFixed(0)}.
              While this path may be challenging, consider exploring alternative pathways or adjacent careers below that align with your interests and current score.
            </div>
          </div>
        </div>
      ` : '';

      card.innerHTML = `
        <div class="cardTop">
          <div>
            <div class="cardTitle">${isAnchor ? "Your pick: " : ""}${escapeHtml(p.name)}</div>
            <div class="tags">
              ${anchorTag}
              ${matchedSubjectsHTML}
              <span class="tag">${escapeHtml(p.cat)}</span>
              ${p.tags.slice(0,4).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("")}
            </div>
          </div>
          <div class="match">${Math.round(score)}% match</div>
        </div>
        ${realityCheckHTML}
        <div class="facts">
          <div class="fact"><div class="k">Study length</div><div class="v">${fmtStudy(p.study)}</div></div>
          <div class="fact"><div class="k">Work style</div><div class="v">${fmtWork(p)}</div></div>
          <div class="fact"><div class="k">Earnings (rough)</div><div class="v">${fmtSalaryBand(p)}</div></div>
          <div class="fact"><div class="k">Eligibility</div><div class="v">${escapeHtml(reqText(p))}</div></div>
        </div>

        <div class="cardBody">
          <div class="sectionTitle">Why you got this</div>
          <ul class="bullets">
            ${uniqueWhy.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}
          </ul>

          <div class="sectionTitle">Day-to-day (quick picture)</div>
          <ul class="bullets">
            ${dayToDayBullets(p).map(x=>`<li>${escapeHtml(x)}</li>`).join("")}
          </ul>

          <div class="sectionTitle">How to start (first 3 steps)</div>
          <ul class="bullets">
            ${uniqueStart.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}
          </ul>

          <div class="sectionTitle">Evidence notes</div>
          <div class="noteRow">
            ${(p.evidence.rule||[]).slice(0,2).map(x=>`<span class="badge rule">Rule of thumb: ${escapeHtml(x)}</span>`).join("")}
            ${(p.evidence.formal||[]).slice(0,2).map(x=>`<span class="badge formal">Formal: ${escapeHtml(x)}</span>`).join("")}
            ${(p.evidence.varies||[]).slice(0,2).map(x=>`<span class="badge varies">Varies: ${escapeHtml(x)}</span>`).join("")}
          </div>

          <div class="sources">
            <strong>Sources (placeholder):</strong>
            ${p.sources.map(s=>escapeHtml(s)).join(" ‚Ä¢ ")}
          </div>
        </div>
      `;

      card.addEventListener("click", () => {
        showJobDetailModal(p, score);
      });
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          showJobDetailModal(p, score);
        }
      });

      return card;
    }

    function showJobDetailModal(p, score){
      const uniqueWhy = pickUniqueWhy(p, score);
      const uniqueStart = pickUniqueStart(p);
      const matchedSubjects = getMatchedSubjects(p);
      const countryName = state.selectedCountry ? state.selectedCountry.name : state.country;
      const universities = getUniversitiesForProfession(p, countryName);

      const univHTML = universities.length > 0 ? `
        <div class="jobDetailSection">
          <div class="jobDetailSectionTitle">Universities in your area</div>
          <p style="margin: 0 0 12px; font-size: 14px; color: #64748b;">Institutions with strong programs for ${escapeHtml(p.name)}:</p>
          <div class="universityList">
            ${universities.map(u => `
              <div class="universityItem">
                <strong>${escapeHtml(u.name)}</strong>
                <div class="univNote">${escapeHtml(u.note || "")}</div>
              </div>
            `).join("")}
          </div>
        </div>
      ` : `
        <div class="jobDetailSection">
          <div class="jobDetailSectionTitle">Universities</div>
          <p style="margin: 0; font-size: 14px; color: #64748b;">Search for universities in ${escapeHtml(countryName || "your area")} that offer programs in ${escapeHtml(p.cat)} or related fields.</p>
        </div>
      `;

      const content = document.getElementById("jobDetailContent");
      content.innerHTML = `
          <h1 class="jobDetailTitle">${escapeHtml(p.name)}</h1>
          <div class="jobDetailMatch">${Math.round(score)}% match</div>
          <div class="tags" style="margin-bottom: 16px;">
            <span class="tag">${escapeHtml(p.cat)}</span>
            ${p.tags.slice(0,4).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("")}
          </div>
          <div class="jobDetailFacts">
            <div class="fact"><div class="k">Study length</div><div class="v">${fmtStudy(p.study)}</div></div>
            <div class="fact"><div class="k">Work style</div><div class="v">${fmtWork(p)}</div></div>
            <div class="fact"><div class="k">Earnings (rough)</div><div class="v">${fmtSalaryBand(p)}</div></div>
            <div class="fact"><div class="k">Eligibility</div><div class="v">${escapeHtml(reqText(p))}</div></div>
          </div>
          <div class="jobDetailSection">
            <div class="jobDetailSectionTitle">Why you got this</div>
            <ul class="bullets">${uniqueWhy.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
          </div>
          <div class="jobDetailSection">
            <div class="jobDetailSectionTitle">Day-to-day (quick picture)</div>
            <ul class="bullets">${dayToDayBullets(p).map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
          </div>
          <div class="jobDetailSection">
            <div class="jobDetailSectionTitle">How to start (first 3 steps)</div>
            <ul class="bullets">${uniqueStart.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
          </div>
          <div class="jobDetailSection">
            <div class="jobDetailSectionTitle">Evidence notes</div>
            <div class="noteRow">
              ${(p.evidence.rule||[]).slice(0,2).map(x=>`<span class="badge rule">Rule of thumb: ${escapeHtml(x)}</span>`).join("")}
              ${(p.evidence.formal||[]).slice(0,2).map(x=>`<span class="badge formal">Formal: ${escapeHtml(x)}</span>`).join("")}
              ${(p.evidence.varies||[]).slice(0,2).map(x=>`<span class="badge varies">Varies: ${escapeHtml(x)}</span>`).join("")}
            </div>
          </div>
          ${univHTML}
      `;

      const modal = document.getElementById("jobDetailModal");
      modal.style.display = "";
      modal.classList.add("show");
      document.body.style.overflow = "hidden";
    }

    function hideJobDetailModal(){
      const modal = document.getElementById("jobDetailModal");
      modal.classList.remove("show");
      modal.style.display = "none";
      document.body.style.overflow = "";
    }

    function pickUniqueWhy(p, score){
      // Make sure expanded content is NOT identical across cards:
      const s = state.score;
      const modeWord = state.mode === "GPA" ? "GPA" : "ATAR";
      const req = state.mode === "GPA" ? p.minGPA : p.minATAR;
      const margin = Math.max(0, s - req);
      const isEligible = isEligibleByScore(p);

      const base = [];

      // Check for matched subjects
      const matchedSubjects = getMatchedSubjects(p);
      if (matchedSubjects.length > 0) {
        base.push(`Matches your selected subject${matchedSubjects.length > 1 ? 's' : ''}: ${matchedSubjects.join(', ')}. This career aligns with your interests and background.`);
      }

      if (state.selectedProfession){
        if (!isEligible) {
          base.push(`You selected this profession, but your current score is below the typical requirement.`);
          base.push(`Consider exploring alternative pathways or adjacent careers that match your interests.`);
        } else {
          base.push(`It shares similarities with your chosen profession (category/tags/work style).`);
        }
      } else {
        if (isEligible) {
          base.push(`Real list: this is a realistic option at your ${modeWord} score.`);
        } else {
          base.push(`This career requires a higher ${modeWord} than your current score.`);
        }
      }

      if (margin < 8) base.push(`It's close to your current score ‚Äî competitive but plausible if you keep improving.`);
      else if (margin < 20) base.push(`You're comfortably above the rough cutoff, so it's a solid "safe" option.`);
      else base.push(`You're well above the rough cutoff ‚Äî you likely have many options in this area.`);

      // Inject profession-specific "why" but keep it different by adding score context + salary bias context
      const salaryLine = {
        self: "You picked a lower-cost circumstance, so the shortlist leans toward faster-entry roles too.",
        couple: "You picked shared/couple, so the shortlist balances stability and growth.",
        family: "You picked family costs, so higher-paying paths get extra weight.",
        growth: "You picked high-growth, so ambitious earning tracks get extra weight."
      }[state.salary];

      const custom = (p.why || []).slice(0,2);
      return [...custom, ...base, salaryLine].slice(0,5); // Increased from 4 to 5 to accommodate subject match line
    }

    function dayToDayBullets(p){
      // lightweight but varied
      const bullets = [];
      if (p.ps === "people") bullets.push("You‚Äôll spend a lot of time communicating, coordinating, or helping people.");
      else bullets.push("You‚Äôll spend a lot of time analysing systems, tools, data, or processes.");

      if (p.da === "desk") bullets.push("Mostly desk-based work (planning, documentation, analysis).");
      else bullets.push("Active work with movement, practical tasks, or on-site duties.");

      if (p.io === "outdoor") bullets.push("Some work happens outside or on-site rather than only in an office.");
      else bullets.push("Mostly indoor environments (office, clinic, classroom, workshop).");

      // category flavor
      const cat = p.cat;
      if (cat === "Health") bullets.push("Accuracy and responsibility matter; training/registration can apply.");
      else if (cat === "Law") bullets.push("Reading/writing and careful reasoning are central.");
      else if (cat === "Tech") bullets.push("Continuous learning is normal; projects prove skill.");
      else if (cat === "Trades") bullets.push("Hands-on skill + safety rules are key; licensing may apply.");
      else if (cat === "Hospitality") bullets.push("Fast pace and teamwork matter; shifts are common.");
      else bullets.push("Progression usually comes from experience + specialisation.");

      return bullets.slice(0,4);
    }

    function pickUniqueStart(p){
      // Ensure different steps per category
      const steps = [];
      if (p.cat === "Tech"){
        steps.push("Build a tiny portfolio: 1 app or 1 analysis project you can show.");
        steps.push("Learn one core skill deeply (JS/Python/SQL/networking depending on role).");
        steps.push("Apply for internships / entry roles; keep iterating projects weekly.");
      } else if (p.cat === "Trades"){
        steps.push("Find an apprenticeship/traineeship pathway (most common route).");
        steps.push("Get basic tickets: white card + safety + reliability references.");
        steps.push("Ask tradespeople about the day-to-day before committing.");
      } else if (p.cat === "Health"){
        steps.push("Check prerequisites and accredited pathways (registration often applies).");
        steps.push("Volunteer or part-time in care/support settings to test fit.");
        steps.push("Build study habits early (science/communication depending on role).");
      } else if (p.cat === "Law"){
        steps.push("Improve writing and logical reasoning (debate, essays, mock trial).");
        steps.push("Research uni cutoffs and alternative pathways (double degrees, later transfer).");
        steps.push("Try admin/support roles to understand legal workplaces.");
      } else if (p.cat === "Education"){
        steps.push("Try tutoring/mentoring to test if teaching fits you.");
        steps.push("Research accredited teaching pathways + placement requirements.");
        steps.push("Pick a subject strength area (math, languages, science, humanities).");
      } else if (p.cat === "Hospitality"){
        steps.push("Get any required certificates (RSA/food handling if needed).");
        steps.push("Start part-time to build speed, teamwork, and customer skills.");
        steps.push("Decide if you want progression (chef/manager) and plan training.");
      } else {
        steps.push(...(p.start || []).slice(0,3));
      }
      // add profession-specific if available, but keep variety
      if (p.start && p.start.length){
        for (const s of p.start){
          if (steps.length >= 4) break;
          if (!steps.includes(s)) steps.push(s);
        }
      }
      return steps.slice(0,4);
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;");
    }

    // ---------- Profession dropdown ----------
    function iconForCat(cat){
      // simple emoji-ish icons via SVG path swap; using one generic badge for now
      return `
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 2l3 6 7 .8-5 4.3 1.6 7-6.6-3.7L5.4 20l1.6-7L2 8.8 9 8l3-6z" stroke="#0f172a" stroke-width="1.4"/>
        </svg>
      `;
    }

    let dropIndex = 0;
    let filteredList = [];

    function openDrop(){
      const panel = $("dropPanel");
      if (panel) panel.classList.add("open");
    }
    function closeDrop(){
      const panel = $("dropPanel");
      if (panel) panel.classList.remove("open");
    }

    function renderDropList(){
      const q = $("professionInput").value.trim().toLowerCase();
      
      // First filter by search query (if any), then separate eligible vs ineligible
      let allMatching = PROFESSIONS
        .filter(p => !q || p.name.toLowerCase().includes(q) || p.cat.toLowerCase().includes(q) || p.tags.join(" ").toLowerCase().includes(q));
      
      // Separate eligible and ineligible, with eligible first
      const eligible = allMatching.filter(isEligibleByScore);
      const ineligible = allMatching.filter(p => !isEligibleByScore(p));
      
      // Combine: eligible first, then ineligible (limit total to 200)
      filteredList = [...eligible, ...ineligible].slice(0, 200);

      dropIndex = 0;

      const list = $("dropList");
      list.innerHTML = "";

      if (filteredList.length === 0){
        const empty = document.createElement("div");
        empty.className = "row";
        empty.style.cursor = "default";
        empty.innerHTML = `
          <div class="rowIcon">${iconForCat("Other")}</div>
          <div class="rowMain">
            <div class="name">No matching professions found</div>
            <div class="meta">Try a different search term or spelling</div>
          </div>
        `;
        list.appendChild(empty);
        return;
      }

      filteredList.forEach((p, i) => {
        const isEligible = isEligibleByScore(p);
        const req = (state.mode === "GPA") ? p.minGPA : p.minATAR;
        const eligibilityText = isEligible ? "" : ` ‚Ä¢ Requires ${req}+ ${state.mode}`;
        const row = document.createElement("div");
        row.className = "row" + (i === 0 ? " active" : "") + (isEligible ? "" : " ineligible");
        row.innerHTML = `
          <div class="rowIcon">${iconForCat(p.cat)}</div>
          <div class="rowMain">
            <div class="name">${escapeHtml(p.name)}</div>
            <div class="meta">${escapeHtml(p.cat)} ‚Ä¢ ${escapeHtml(p.tags.slice(0,3).join(" ‚Ä¢ "))}${eligibilityText}</div>
          </div>
        `;
        row.addEventListener("mousedown", (e) => {
          // mousedown so it selects before blur closes panel
          e.preventDefault();
          selectProfession(p);
          closeDrop();
          // In job-first mode, immediately show evaluation; in score-first, just update filter
          if (state.intent === 'job-first') {
            state.hasSearched = true;
            runSearch(true);
          } else {
            updateCTA(); // Update button text to reflect filter
          }
        });
        list.appendChild(row);
      });
    }

    function highlightRow(){
      const rows = $("dropList").querySelectorAll(".row");
      rows.forEach((r, i) => r.classList.toggle("active", i === dropIndex));
      const active = rows[dropIndex];
      if (active) active.scrollIntoView({block:"nearest"});
    }
    
    // Refine section dropdown functions
    let dropIndexRefine = 0;
    let filteredListRefine = [];
    
    function openDropRefine(){
      const panel = $("dropPanelRefine");
      if (panel) panel.classList.add("open");
    }
    function closeDropRefine(){
      const panel = $("dropPanelRefine");
      if (panel) panel.classList.remove("open");
    }
    
    function renderDropListRefine(){
      const q = $("professionInputRefine").value.trim().toLowerCase();
      
      let allMatching = PROFESSIONS
        .filter(p => !q || p.name.toLowerCase().includes(q) || p.cat.toLowerCase().includes(q) || p.tags.join(" ").toLowerCase().includes(q));
      
      const eligible = allMatching.filter(isEligibleByScore);
      const ineligible = allMatching.filter(p => !isEligibleByScore(p));
      
      filteredListRefine = [...eligible, ...ineligible].slice(0, 200);
      dropIndexRefine = 0;
      
      const list = $("dropListRefine");
      list.innerHTML = "";
      
      if (filteredListRefine.length === 0){
        const empty = document.createElement("div");
        empty.className = "row";
        empty.style.cursor = "default";
        empty.innerHTML = `
          <div class="rowIcon">${iconForCat("Other")}</div>
          <div class="rowMain">
            <div class="name">No matching professions found</div>
            <div class="meta">Try a different search term or spelling</div>
          </div>
        `;
        list.appendChild(empty);
        return;
      }
      
      filteredListRefine.forEach((p, i) => {
        const isEligible = isEligibleByScore(p);
        const req = (state.mode === "GPA") ? p.minGPA : p.minATAR;
        const eligibilityText = isEligible ? "" : ` ‚Ä¢ Requires ${req}+ ${state.mode}`;
        const row = document.createElement("div");
        row.className = "row" + (i === 0 ? " active" : "") + (isEligible ? "" : " ineligible");
        row.innerHTML = `
          <div class="rowIcon">${iconForCat(p.cat)}</div>
          <div class="rowMain">
            <div class="name">${escapeHtml(p.name)}</div>
            <div class="meta">${escapeHtml(p.cat)} ‚Ä¢ ${escapeHtml(p.tags.slice(0,3).join(" ‚Ä¢ "))}${eligibilityText}</div>
          </div>
        `;
        row.addEventListener("mousedown", (e) => {
          e.preventDefault();
          state.selectedProfession = p;
          $("professionInputRefine").value = p.name;
          $("professionSubRefine").textContent = `Selected: ${p.cat} ‚Ä¢ ${p.tags.slice(0,3).join(" ‚Ä¢ ")}`;
          closeDropRefine();
          // Only auto-update if results are already shown
          if ($('results').style.display !== 'none') {
            autoRun(); // Re-run search with profession filter
          }
        });
        list.appendChild(row);
      });
    }
    
    function handleDropdownKeyboardRefine(e){
      if (!$("dropPanelRefine").classList.contains("open")) return;
      
      if (e.key === "ArrowDown"){
        e.preventDefault();
        dropIndexRefine = Math.min(dropIndexRefine + 1, filteredListRefine.length - 1);
        highlightRowRefine();
      }
      if (e.key === "ArrowUp"){
        e.preventDefault();
        dropIndexRefine = Math.max(dropIndexRefine - 1, 0);
        highlightRowRefine();
      }
      if (e.key === "Enter"){
        e.preventDefault();
        const pick = filteredListRefine[dropIndexRefine];
        if (pick){
          state.selectedProfession = pick;
          $("professionInputRefine").value = pick.name;
          $("professionSubRefine").textContent = `Selected: ${pick.cat} ‚Ä¢ ${pick.tags.slice(0,3).join(" ‚Ä¢ ")}`;
          closeDropRefine();
          // Only auto-update if results are already shown
          if ($('results') && $('results').style.display !== 'none') {
            autoRun();
          }
        }
      }
      if (e.key === "Escape"){
        closeDropRefine();
      }
    }
    
    function highlightRowRefine(){
      const rows = $("dropListRefine").querySelectorAll(".row");
      rows.forEach((r, i) => r.classList.toggle("active", i === dropIndexRefine));
      const active = rows[dropIndexRefine];
      if (active) active.scrollIntoView({block:"nearest"});
    }

    function selectProfession(p){
      state.selectedProfession = p;
      $("professionInput").value = p.name;
      
      // Update subtitle based on intent
      if (state.intent === 'job-first') {
        $("professionSub").textContent = `Selected: ${p.cat} ‚Ä¢ Ready to evaluate`;
      } else {
        $("professionSub").textContent = `Selected: ${p.cat} ‚Ä¢ ${p.tags.slice(0,3).join(" ‚Ä¢ ")}`;
      }
      
      updateCTA();
    }

    function clearProfession(){
      state.selectedProfession = null;
      $("professionInput").value = "";
      $("professionSub").textContent = "Real list: leave blank to see options for your score.";
      updateCTA();
    }

    // ---------- CTA: intent-aware ----------
    function updateCTA(){
      if (!$("ctaText") || !$("ctaSub")) return; // Elements might not exist yet
      
      const modeWord = (state.mode === "GPA") ? "GPA" : "ATAR";
      const p = state.selectedProfession?.name;

      if (state.intent === 'job-first') {
        // Job-first flow: focus on evaluation
        const main = p ? `Evaluate ${p} ‚Üí` : `Evaluate career ‚Üí`;
        const sub = p ? `Reality check + alternatives` : `Select a career first`;
        $("ctaText").textContent = main;
        $("ctaSub").textContent = sub;
      } else {
        // Score-first flow: focus on exploration
        const main = p ? `Show paths from ${p}` : `Show my options ‚Üí`;
        const sub = p ? `Related options filtered by your ${modeWord}` : `Exploring by score`;
        $("ctaText").textContent = main;
        $("ctaSub").textContent = sub;
      }
    }

    // ---------- Filters ----------
    function setFilter(group, value){
      state.filters[group] = value;

      // update UI: only one per group is "on"
      const pills = document.querySelectorAll(`.filterPill[data-group="${group}"]`);
      pills.forEach(p => p.classList.toggle("on", p.dataset.value === value));
    }

    // ---------- Search / Auto-run ----------
    function runSearch(scrollToResults){
      if (!state.mode) return;
      if (!state.intent) return;
      
      if (state.intent === 'score-first'){
        // Flow A: Score-first exploration
        const scoreInput = $("scoreInput");
        if (!scoreInput) {
          console.log('Score input not found');
          return;
        }
        
        const rawValue = scoreInput.value.trim();
        if (!rawValue) {
          // Empty input - don't run search yet
          return;
        }
        
        const v = parseScore(rawValue);
        if (v === null){
          console.log('Invalid score value');
          return;
        }
        state.score = v;

        // DON'T normalize display during typing - let user type freely
        // Only format on blur or explicit request

        renderResultsFlowA();
        updateEligibleCount();
        updateBackButton();

        if (scrollToResults){
          setTimeout(() => {
            // Scroll to the start of the results section instead of the bottom
            const resultsStart = $('resultsFramingContainer') || $('mainHeading');
            if (resultsStart) {
              resultsStart.scrollIntoView({behavior: 'smooth', block: 'start'});
            } else {
              window.scrollTo({top: 0, behavior:"smooth"});
            }
          }, 200);
        }
      } else {
        // Flow B: Job-first
        if (!state.selectedProfession){
          alert("Select a profession from the dropdown to continue.");
          return;
        }
        
        renderResultsFlowB();
        updateBackButton();
        
        if (scrollToResults){
          // Scroll to the start of the results section instead of the bottom
          const resultsStart = $('resultsFramingContainer') || $('mainHeading');
          if (resultsStart) {
            resultsStart.scrollIntoView({behavior: 'smooth', block: 'start'});
          } else {
            window.scrollTo({top: 0, behavior:"smooth"});
          }
        }
      }
    }
    
    function updateEligibleCount(){
      const eligible = PROFESSIONS.filter(p => isEligibleByScore(p));
      $('eligibleChip').innerHTML = `<span class="dot2"></span><strong>Eligible in list:</strong> ${eligible.length} / ${PROFESSIONS.length}`;
    }
    
    function renderResultsFlowA(){
      // Flow A: Two paths exploration
      const framingContainer = $('resultsFramingContainer');
      const evalContainer = $('evaluationContainer');
      const mergeContainer = $('mergePromptContainer');
      const refineContainer = $('refineContainer');
      const resultsDiv = $('results');
      
      // Show all result containers
      if (framingContainer) framingContainer.style.display = 'block';
      if (evalContainer) evalContainer.style.display = 'block';
      if (mergeContainer) mergeContainer.style.display = 'block';
      if (refineContainer) refineContainer.style.display = 'block';
      if (resultsDiv) resultsDiv.style.display = 'block';
      
      // Clear evaluation (only for Flow B)
      evalContainer.innerHTML = '';
      
      // Update back button visibility
      updateBackButton();
      
      // Show framing
      const modeLabel = state.mode === 'ATAR' ? 'ATAR' : 'GPA';
      const scoreDisplay = state.mode === 'ATAR' ? state.score.toFixed(2) : state.score.toFixed(0);
      framingContainer.innerHTML = `
        <div class="resultsFraming">
          <div class="framingTitle">Based on a ${modeLabel} of ${scoreDisplay}, these are your strongest realistic pathways:</div>
          <div class="framingText">Click any card to see details.</div>
        </div>
      `;
      
      // Update main heading
      $('mainHeading').textContent = 'Your options';
      $('mainHint').textContent = 'Ranked by match strength. Click cards to expand.';
      
      // Show results
      renderResults();
      
      // Show refine results section
      refineContainer.innerHTML = `
        <div class="refineSection" id="refineSection">
          <h3 id="refineToggle">
            üîß Refine results
            <span class="refineToggle">‚ñº</span>
          </h3>
          <div class="refineBody" id="refineBody">
            <div class="refineGrid">
              <!-- Profession filter (optional) -->
              <div class="field">
                <div class="icon" aria-hidden="true">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M7 7h10v14H7V7z" stroke="#0f172a" stroke-width="1.8" />
                    <path d="M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2" stroke="#0f172a" stroke-width="1.8"/>
                  </svg>
                </div>
                <div class="fieldcol">
                  <div class="label">Profession filter (optional)</div>
                  <div class="dropdown">
                    <input id="professionInputRefine" class="inputlike" placeholder="Filter by profession..." autocomplete="off" />
                    <div class="sub" id="professionSubRefine">Leave blank to see all options</div>
                    <div class="dropPanel" id="dropPanelRefine">
                      <div class="dropHeader">
                        <div class="t">Professions</div>
                        <div class="h">Type to filter ‚Ä¢ Scroll ‚Ä¢ Enter to select</div>
                      </div>
                      <div class="dropList" id="dropListRefine"></div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Lifestyle goal -->
              <div class="field">
                <div class="icon" aria-hidden="true">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M12 2v20" stroke="#0f172a" stroke-width="1.8"/>
                    <path d="M17 6.5c0-1.7-1.6-3-5-3s-5 1.3-5 3 1.2 2.6 5 3 5 1.3 5 3-1.6 3-5 3-5-1.3-5-3" stroke="#0f172a" stroke-width="1.8"/>
                  </svg>
                </div>
                <div class="fieldcol">
                  <div class="label">Lifestyle goal (long-term)</div>
                  <div class="value" style="margin-top:2px;">
                    <select id="salarySelectRefine" class="inputlike" style="font-size:18px;font-weight:950;">
                      <option value="self" ${state.salary === 'self' ? 'selected' : ''}>Low ‚Äî self only ($45k‚Äì$70k)</option>
                      <option value="couple" ${state.salary === 'couple' ? 'selected' : ''}>Medium ‚Äî couple/shared ($70k‚Äì$110k)</option>
                      <option value="family" ${state.salary === 'family' ? 'selected' : ''}>High ‚Äî family costs ($110k‚Äì$160k)</option>
                      <option value="growth" ${state.salary === 'growth' ? 'selected' : ''}>High growth ‚Äî ambitious ($160k+)</option>
                    </select>
                  </div>
                  <div class="sub">Used to prioritise results, not remove options.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // Attach refine section listeners
      setTimeout(() => {
        const refineToggle = $('refineToggle');
        const refineSection = $('refineSection');
        if (refineToggle && refineSection) {
          refineToggle.addEventListener('click', () => {
            refineSection.classList.toggle('collapsed');
          });
        }
        
        // Lifestyle goal selector
        const salarySelectRefine = $('salarySelectRefine');
        if (salarySelectRefine) {
          salarySelectRefine.addEventListener('change', (e) => {
            state.salary = e.target.value;
            // Only auto-update if results are already shown
            if ($('results').style.display !== 'none') {
              autoRun();
            }
          });
        }
        
        // Profession filter (optional)
        const professionInputRefine = $('professionInputRefine');
        if (professionInputRefine) {
          professionInputRefine.addEventListener('focus', () => {
            openDropRefine();
            renderDropListRefine();
          });
          professionInputRefine.addEventListener('input', () => {
            if (state.selectedProfession && professionInputRefine.value.trim() !== state.selectedProfession.name) {
              state.selectedProfession = null;
              $('professionSubRefine').textContent = 'Leave blank to see all options';
            }
            openDropRefine();
            renderDropListRefine();
          });
          professionInputRefine.addEventListener('keydown', handleDropdownKeyboardRefine);
        }
      }, 100);
      
      // Show merge prompt if not already merged
      if (!state.contextMerged && !state.selectedProfession){
        mergeContainer.innerHTML = `
          <div class="mergePrompt">
            <div class="mergeTitle">üí° Also have a dream job in mind?</div>
            <button class="mergeBtn" id="addDreamJobBtn">Add dream job to refine results</button>
          </div>
        `;
        setTimeout(() => {
          const btn = $('addDreamJobBtn');
          if (btn) btn.addEventListener('click', () => {
            state.contextMerged = true;
            // Open refine section and focus on profession filter
            const refineSection = $('refineSection');
            if (refineSection) {
              refineSection.classList.remove('collapsed');
              const professionInputRefine = $('professionInputRefine');
              if (professionInputRefine) {
                setTimeout(() => professionInputRefine.focus(), 100);
              }
            }
            mergeContainer.innerHTML = '';
          });
        }, 100);
      } else {
        mergeContainer.innerHTML = '';
      }
    }
    
    function showJobRequirements(){
      // Flow B: Show what ATAR/GPA is required for selected job
      const framingContainer = $('resultsFramingContainer');
      const evalContainer = $('evaluationContainer');
      const mergeContainer = $('mergePromptContainer');
      const resultsDiv = $('results');
      
      // Show all result containers
      if (framingContainer) framingContainer.style.display = 'block';
      if (evalContainer) evalContainer.style.display = 'block';
      if (mergeContainer) mergeContainer.style.display = 'block';
      if (resultsDiv) resultsDiv.style.display = 'block';
      
      // Clear other containers
      framingContainer.innerHTML = '';
      mergeContainer.innerHTML = '';
      
      const p = state.selectedProfession;
      
      if (!p) {
        alert('Select a job to see details.');
        return;
      }
      
      const modeLabel = state.mode;
      const minReq = state.mode === 'ATAR' ? p.minATAR : p.minGPA;
      const minReqDisplay = state.mode === 'ATAR' ? minReq.toFixed(2) : minReq.toFixed(0);
      
      $('mainHeading').textContent = p.name;
      $('mainHint').textContent = 'Here\'s what you need to know about this career path.';
      
      // Show requirement card
      evalContainer.innerHTML = `
        <div class="evalCard">
          <div class="evalTitle">üìã ${p.name} Requirements</div>
          
          <div class="evalSection">
            <h4>Minimum ${modeLabel} Required</h4>
            <div class="statusLabel likely" style="font-size: 24px; padding: 16px 24px;">
              ${minReqDisplay}
            </div>
            <p style="color: #64748b; font-weight: 750; margin: 12px 0 0;">
              This is the typical minimum ${modeLabel} needed for ${p.name}. Some universities or pathways may vary.
            </p>
          </div>
          
          <div class="evalSection">
            <h4>Study Duration</h4>
            <p style="margin: 8px 0; font-weight: 750;">${fmtStudy(p.study)}</p>
          </div>
          
          <div class="evalSection">
            <h4>Work Style</h4>
            <p style="margin: 8px 0; font-weight: 750;">${fmtWork(p)}</p>
          </div>
          
          <div class="evalSection">
            <h4>Expected Salary Range</h4>
            <p style="margin: 8px 0; font-weight: 750;">${fmtSalaryBand(p)}</p>
          </div>
          
          ${p.why && p.why.length > 0 ? `
            <div class="evalSection">
              <h4>Why this path?</h4>
              <ul class="bullets">
                ${p.why.slice(0, 3).map(w => `<li>${w}</li>`).join('')}
              </ul>
            </div>
          ` : ''}
          
          ${p.start && p.start.length > 0 ? `
            <div class="evalSection">
              <h4>How to start</h4>
              <ul class="bullets">
                ${p.start.slice(0, 3).map(s => `<li>${s}</li>`).join('')}
              </ul>
            </div>
          ` : ''}
          
          ${p.evidence && (p.evidence.formal?.length || p.evidence.rule?.length || p.evidence.varies?.length) ? `
            <div class="evalSection">
              <h4>Important notes</h4>
              <div class="noteRow">
                ${(p.evidence.formal || []).map(e => `<span class="badge formal">${e}</span>`).join('')}
                ${(p.evidence.rule || []).map(e => `<span class="badge rule">${e}</span>`).join('')}
                ${(p.evidence.varies || []).map(e => `<span class="badge varies">${e}</span>`).join('')}
              </div>
            </div>
          ` : ''}
        </div>
      `;
      
      // Show similar careers
      const adjacent = buildAdjacentCareers(p);
      
      if (adjacent.length > 0){
        resultsDiv.innerHTML = `
          <h3 style="margin: 32px 0 16px; font-size: 28px;">Similar Career Options</h3>
          <p class="hint" style="margin-bottom: 18px;">Based on similar work style, study time, and salary expectations.</p>
        `;
        adjacent.forEach(alt => {
          const card = renderCard(alt, 85, false);
          resultsDiv.appendChild(card);
        });
      } else {
        resultsDiv.innerHTML = '';
      }
      
      // Scroll to results
      setTimeout(() => {
        evalContainer.scrollIntoView({behavior: 'smooth', block: 'start'});
      }, 100);
    }
    
    function renderResultsFlowB(){
      // Flow B: Dream job evaluation
      const framingContainer = $('resultsFramingContainer');
      const evalContainer = $('evaluationContainer');
      const mergeContainer = $('mergePromptContainer');
      const refineContainer = $('refineContainer');
      const resultsDiv = $('results');
      
      // Show all result containers
      if (framingContainer) framingContainer.style.display = 'block';
      if (evalContainer) evalContainer.style.display = 'block';
      if (mergeContainer) mergeContainer.style.display = 'block';
      if (refineContainer) refineContainer.style.display = 'block';
      if (resultsDiv) resultsDiv.style.display = 'block';
      
      framingContainer.innerHTML = '';
      refineContainer.innerHTML = '';
      
      $('mainHeading').textContent = 'Dream Job Evaluation';
      $('mainHint').textContent = 'Reality check + smart alternatives based on what matters to you.';
      
      // Update back button visibility
      updateBackButton();
      
      const p = state.selectedProfession;
      
      // Determine status based on user's score (if they've provided one)
      let statusHTML = '';
      let alternativesHTML = '';
      let adjacentHTML = '';
      
      if (state.score > 0 && state.mode && state.contextMerged){
        // User has both job + score (merged context - user explicitly entered score)
        const minReq = state.mode === 'ATAR' ? p.minATAR : p.minGPA;
        const userScore = state.score;
        const modeLabel = state.mode === 'ATAR' ? 'ATAR' : 'GPA';
        
        let statusLabel = '';
        let statusClass = '';
        let statusText = '';
        
        if (userScore >= minReq + 5){
          statusLabel = 'Likely pathway';
          statusClass = 'likely';
          statusText = `Your ${modeLabel} of ${state.mode === 'ATAR' ? userScore.toFixed(2) : userScore.toFixed(0)} is above the typical cutoff of ${state.mode === 'ATAR' ? minReq.toFixed(2) : minReq.toFixed(0)}. This is a realistic option for you.`;
        } else if (userScore >= minReq - 3){
          statusLabel = 'Stretch goal';
          statusClass = 'stretch';
          statusText = `Your ${modeLabel} of ${state.mode === 'ATAR' ? userScore.toFixed(2) : userScore.toFixed(0)} is close to the typical cutoff of ${state.mode === 'ATAR' ? minReq.toFixed(2) : minReq.toFixed(0)}. Consider applying, but also explore backup pathways.`;
        } else {
          statusLabel = 'Alternative route needed';
          statusClass = 'unlikely';
          statusText = `The typical ${modeLabel} cutoff is ${state.mode === 'ATAR' ? minReq.toFixed(2) : minReq.toFixed(0)}, and your current score is ${state.mode === 'ATAR' ? userScore.toFixed(2) : userScore.toFixed(0)}. Consider the alternative pathways and adjacent careers below.`;
        }
        
        statusHTML = `
          <div class="evalSection">
            <h4>Reality Check</h4>
            <div><strong>Typical ${modeLabel} range:</strong> ${state.mode === 'ATAR' ? minReq.toFixed(2) : minReq.toFixed(0)}+</div>
            <div><strong>Your ${modeLabel}:</strong> ${state.mode === 'ATAR' ? userScore.toFixed(2) : userScore.toFixed(0)}</div>
            <div class="statusLabel ${statusClass}">${statusLabel}</div>
            <p style="margin:12px 0 0; font-weight:750; color:#334155;">${statusText}</p>
          </div>
        `;
        
        // Show alternative pathways if applicable
        if (userScore < minReq - 3 && (p.name === 'Doctor' || p.name === 'Lawyer' || p.cat === 'Health')){
          alternativesHTML = `
            <div class="evalSection">
              <h4>Alternative Pathways</h4>
              <ul class="bullets">
                ${p.name === 'Doctor' ? '<li><strong>Graduate-entry medicine:</strong> Complete another degree first, then apply to postgrad medicine (very competitive, limited places).</li>' : ''}
                ${p.cat === 'Health' ? '<li><strong>Pathway programs:</strong> Some universities offer foundation/bridging programs. Check specific institutions.</li>' : ''}
                ${p.name === 'Lawyer' ? '<li><strong>Graduate JD:</strong> Complete an undergraduate degree, then apply for Juris Doctor (3 years, competitive entry).</li>' : ''}
                <li><strong>Reality note:</strong> These routes exist but are competitive and take longer. Consider adjacent careers below.</li>
              </ul>
            </div>
          `;
        }
        
        // Show adjacent careers (similarity-based, but filtered by user's score)
        const adjacentCareers = buildAdjacentCareers(p);
        if (adjacentCareers.length > 0){
          adjacentHTML = `
            <div class="evalSection">
              <h4>Adjacent Careers That Match Your Interests</h4>
            </div>
          `;
          
          // Render adjacent career cards
          resultsDiv.innerHTML = '';
          adjacentCareers.forEach(item => {
            resultsDiv.appendChild(renderCard(item.p, item.score, false));
          });
          
          // Add "Why these matches" section after adjacent careers
          const whyMatchesSection = document.createElement('div');
          whyMatchesSection.className = 'evalSection';
          whyMatchesSection.style.marginTop = '24px';
          whyMatchesSection.innerHTML = `
            <h4>Why these matches</h4>
            <p style="margin:12px 0 0; font-weight:750; color:#334155; line-height:1.6;">
              You chose <strong>${escapeHtml(p.name)}</strong> because it involves <strong>${p.tags.slice(0,2).join(', ')}</strong>. 
              These careers also have similar qualities (${p.tags.slice(0,2).join(', ')}) and fit your ${modeLabel} of ${state.mode === 'ATAR' ? userScore.toFixed(2) : userScore.toFixed(0)}.
            </p>
          `;
          resultsDiv.appendChild(whyMatchesSection);
        } else {
          adjacentHTML = `
            <div class="evalSection">
              <h4>Adjacent Careers</h4>
              <p style="margin:0; font-weight:750; color:#64748b;">No close matches found at your current score. Consider raising your score or exploring broader career categories.</p>
            </div>
          `;
          resultsDiv.innerHTML = '';
        }
        
      } else {
        // User hasn't provided score yet - show job info + required score
        const modeLabel = state.mode === 'GPA' ? 'GPA' : 'ATAR';
        const reqScore = state.mode === 'GPA' ? p.minGPA.toFixed(0) : p.minATAR.toFixed(2);

        statusHTML = `
          <div class="evalSection">
            <h4>About ${escapeHtml(p.name)}</h4>
            <div style="margin-bottom:12px;">
              <strong>Typical ${modeLabel} required:</strong> ${reqScore}+
            </div>
            <ul class="bullets">
              ${p.why.map(w => `<li>${escapeHtml(w)}</li>`).join('')}
            </ul>
          </div>
        `;
        
        mergeContainer.innerHTML = `
          <div class="mergePrompt">
            <div class="mergeTitle">üìä Want to see if this is realistic for you?</div>
            <button class="mergeBtn" id="addScoreBtn">Enter your ATAR/GPA</button>
          </div>
        `;
        setTimeout(() => {
          const btn = $('addScoreBtn');
          if (btn) btn.addEventListener('click', showScoreInputSection);
        }, 100);
        
        resultsDiv.innerHTML = '';
      }
      
      evalContainer.innerHTML = `
        <div class="evalCard">
          <div class="evalTitle">${escapeHtml(p.name)}</div>
          ${statusHTML}
          ${alternativesHTML}
          ${adjacentHTML}
        </div>
      `;
    }
    
    function buildAdjacentCareers(targetProfession){
      // For Flow B: Find careers similar to the dream job, filtered by user's actual score
      const pool = PROFESSIONS.filter(p => 
        p.id !== targetProfession.id && 
        isEligibleByScore(p) && 
        passesFilters(p)
      );
      
      // Score by similarity (using existing similarity logic)
      const ranked = pool.map(p => {
        let score = 35;
        
        // Category match
        if (p.cat === targetProfession.cat) score += 18;
        
        // Tag overlap
        const sharedTags = p.tags.filter(t => targetProfession.tags.includes(t));
        score += sharedTags.length * 6;
        
        // Work style match
        if (p.ps === targetProfession.ps) score += 5;
        if (p.da === targetProfession.da) score += 5;
        if (p.io === targetProfession.io) score += 4;
        
        return {p, score: Math.min(99, score)};
      })
      .filter(item => item.score > 45) // Only show meaningful matches
      .sort((a,b) => b.score - a.score)
      .slice(0, 6); // Top 6 adjacent careers
      
      return ranked;
    }
    
    function showScoreInputSection(){
      // Switch to score-first flow while keeping the selected profession
      const selectedProfession = state.selectedProfession;

      // Change intent to score-first
      state.intent = 'score-first';
      state.score = 0;
      state.hasSearched = false;
      state.contextMerged = false;

      // Hide results containers
      const framingContainer = $('resultsFramingContainer');
      const evalContainer = $('evaluationContainer');
      const mergeContainer = $('mergePromptContainer');
      const refineContainer = $('refineContainer');
      const resultsDiv = $('results');

      if (framingContainer) framingContainer.style.display = 'none';
      if (evalContainer) evalContainer.style.display = 'none';
      if (mergeContainer) mergeContainer.style.display = 'none';
      if (refineContainer) refineContainer.style.display = 'none';
      if (resultsDiv) resultsDiv.style.display = 'none';

      // Restore the selected profession (so it's remembered when they search)
      state.selectedProfession = selectedProfession;

      // Re-render the search row for score-first flow
      renderSearchRow();

      // Update headings
      $('mainHeading').textContent = 'Find your next career';
      $('mainHint').innerHTML = 'Enter your <strong>' + (state.mode === 'GPA' ? 'GPA' : 'ATAR') + '</strong> score below to see what careers are <strong>realistically achievable</strong> with your results.';

      // Scroll to top
      window.scrollTo({top: 0, behavior: 'smooth'});
    }

    let autoTimer = null;
    function autoRun(){
      // Only auto-run search if user has already clicked "Show my options"
      if (!state.hasSearched) return;
      clearTimeout(autoTimer);
      autoTimer = setTimeout(()=> runSearch(false), 350);
    }

    // ---------- Mode modal ----------
    function showModeModal(){
      console.log('Showing mode modal');
      
      // Show/hide ATAR and GPA based on country
      const atarCard = $('modeCardATAR');
      const gpaCard = $('modeCardGPA');
      const countryObj = state.selectedCountry;
      const countryName = state.country || (countryObj && countryObj.name);
      const lookup = countryObj || (countryName ? COUNTRY_LIST.find(c => c.name.toLowerCase() === countryName.toLowerCase()) : null);
      const usesATAR = !lookup ? true : lookup.usesATAR;
      
      if (atarCard) {
        atarCard.style.display = usesATAR ? '' : 'none';
      }
      if (gpaCard) {
        gpaCard.style.display = '';
      }
      
      // If country doesn't use ATAR, auto-select GPA and skip modal
      if (!usesATAR) {
        setMode('GPA');
        return;
      }
      
      const modal = $("modeModal");
      modal.style.display = "";
      modal.classList.add("show");
    }
    function hideModeModal(){
      console.log('Hiding mode modal');
      const modal = $("modeModal");
      modal.classList.remove("show");
      modal.style.display = "none";
      // Double-check it's hidden
      setTimeout(() => {
        modal.style.display = "none";
      }, 50);
    }
    function setMode(mode){
      console.log('setMode called with:', mode);
      state.mode = mode;

      const info = labelForMode();
      
      // Don't set default score - let user enter it
      // Only parse if there's a value in the input
      const scoreInputEl = $("scoreInput");
      if (scoreInputEl && scoreInputEl.value.trim()) {
        const v = parseScore(scoreInputEl.value);
        if (v !== null) {
          state.score = v;
        } else {
          state.score = 0;
        }
      } else {
        state.score = 0;
      }

      // Show search row and render appropriate fields based on intent
      if (state.intent) {
        console.log('Showing search row for intent:', state.intent);
        
        // HIDE the intent fork cards
        const intentFork = $("intentFork");
        if (intentFork) {
          intentFork.style.display = 'none';
        }
        
        // Replace aesthetic block with studies section, show filters (user has chosen intent)
        const aestheticBlock = $('aestheticStudyBlock');
        const studiesSection = $('studiesSection');
        const filters = $('filters');
        if (aestheticBlock) aestheticBlock.classList.add('hidden');
        if (studiesSection) studiesSection.classList.remove('hidden');
        if (filters) filters.classList.remove('hidden');
        
        // Update back button visibility
        updateBackButton();
        
        // Show the search row with intent-specific layout
        renderSearchRow();
        
        // Update final hero text based on intent
        if (state.intent === 'score-first'){
          $("heroLine").innerHTML = 'Enter your <strong>' + mode + '</strong> score below to see what careers are <strong>realistically achievable</strong> with your results.';
        } else {
          $("heroLine").innerHTML = 'Search for your <strong>dream job</strong> below to see what <strong>' + mode + ' score you need</strong> to pursue it.';
        }
        
        // Scroll to search row smoothly
        setTimeout(() => {
          $("searchRow").scrollIntoView({behavior: 'smooth', block: 'nearest'});
        }, 100);
      } else {
        // No intent selected yet, re-render fork to show appropriate options
        renderIntentFork();
      }
    }

    // ---------- Wire up ----------
    // Don't show mode modal automatically - wait for intent selection
    // showModeModal(); // Removed - now triggered by selectIntent()

    document.querySelectorAll(".modeCard").forEach(el => {
      el.addEventListener("click", function(e) {
        e.stopPropagation();
        e.preventDefault();
        const mode = this.dataset.mode;
        console.log('Mode card clicked:', mode);
        
        // Immediately hide modal
        const modal = $("modeModal");
        modal.classList.remove("show");
        modal.style.display = "none";
        
        // Then set mode and show search
        setMode(mode);
      }, true);
    });
    
    // Also add click handler to modal backdrop to close it
    $("modeModal").addEventListener("click", function(e) {
      if (e.target === this) {
        hideModeModal();
      }
    });

    // Job detail modal close
    const jobDetailCloseBtn = document.getElementById("jobDetailClose");
    const jobDetailModal = document.getElementById("jobDetailModal");
    if (jobDetailCloseBtn) jobDetailCloseBtn.addEventListener("click", hideJobDetailModal);
    if (jobDetailModal) jobDetailModal.addEventListener("click", function(e) {
      if (e.target === jobDetailModal) hideJobDetailModal();
    });

    // ---------- Back button functionality ----------
    function updateBackButton(){
      const backBtn = $("backBtn");
      if (!backBtn) return;
      
      // Show back button if user has navigated away from initial state
      const hasNavigated = state.intent !== null || state.mode !== null || state.score > 0 || state.selectedProfession !== null;
      if (hasNavigated) {
        backBtn.classList.add("visible");
      } else {
        backBtn.classList.remove("visible");
      }
    }
    
    function goBackToStart(){
      // Reset all state
      state.intent = null;
      state.mode = null;
      state.country = null;
      state.selectedCountry = null;
      state.score = 0;
      state.selectedProfession = null;
      state.salary = "couple";
      state.contextMerged = false;
      state.hasSearched = false;
      
      // Reset filters
      setFilter("study","any");
      setFilter("ps","any");
      setFilter("da","any");
      setFilter("io","any");
      
      // Clear and hide UI
      const framingContainer = $('resultsFramingContainer');
      const evalContainer = $('evaluationContainer');
      const mergeContainer = $('mergePromptContainer');
      const refineContainer = $('refineContainer');
      const resultsDiv = $('results');
      
      if (framingContainer) {
        framingContainer.innerHTML = '';
        framingContainer.style.display = 'none';
      }
      if (evalContainer) {
        evalContainer.innerHTML = '';
        evalContainer.style.display = 'none';
      }
      if (mergeContainer) {
        mergeContainer.innerHTML = '';
        mergeContainer.style.display = 'none';
      }
      if (refineContainer) {
        refineContainer.innerHTML = '';
        refineContainer.style.display = 'none';
      }
      if (resultsDiv) {
        resultsDiv.innerHTML = '';
        resultsDiv.style.display = 'none';
      }
      $('searchRow').style.display = 'none';
      
      // Close mode modal if open
      hideModeModal();
      
      // Close any open dropdowns
      const dropPanel = $('dropPanel');
      if (dropPanel) {
        dropPanel.classList.remove('open');
      }
      const dropPanelRefine = $('dropPanelRefine');
      if (dropPanelRefine) {
        dropPanelRefine.classList.remove('open');
      }
      
      // Reset main heading
      $('mainHeading').textContent = 'Your shortlist';
      $('mainHint').textContent = 'Click a card to expand details. (Each card is different.)';
      
      // Explicitly show intent fork container and reset hero text
      const intentFork = $('intentFork');
      if (intentFork) {
        intentFork.style.display = 'grid';
      }
      
      // Show aesthetic block, hide studies section and filters (back to initial screen)
      const aestheticBlock = $('aestheticStudyBlock');
      const studiesSection = $('studiesSection');
      const filters = $('filters');
      if (aestheticBlock) aestheticBlock.classList.remove('hidden');
      if (studiesSection) studiesSection.classList.add('hidden');
      if (filters) filters.classList.add('hidden');
      
      // Remove selected state from intent cards
      document.querySelectorAll('.intentCard').forEach(card => {
        card.classList.remove('selected');
      });
      
      // Also clear any profession input fields
      const professionInput = $('professionInput');
      if (professionInput) {
        professionInput.value = '';
      }
      const professionInputRefine = $('professionInputRefine');
      if (professionInputRefine) {
        professionInputRefine.value = '';
      }
      
      // Clear profession sub text
      const professionSub = $('professionSub');
      if (professionSub) {
        professionSub.textContent = 'Select from real list of ~220 professions';
      }
      
      // Clear studies and interests
      state.studiesAndInterests = [];
      const studiesInputEl = $('studiesInput');
      if (studiesInputEl) {
        studiesInputEl.value = '';
      }
      renderStudiesTags();
      closeStudiesDropdown();
      
      // Show intent fork again (this will show both cards)
      renderIntentFork();
      updateBackButton();
      
      // Scroll to top
      window.scrollTo({top: 0, behavior: "smooth"});
    }
    
    // Wire up back button
    $("backBtn").addEventListener("click", goBackToStart);
    
    // Only attach if element exists (for initial page load)
    if ($("salarySelect")) {
      $("salarySelect").addEventListener("change", () => {
        state.salary = $("salarySelect").value;
        // Only auto-update if results are already shown (this is for the old search row, not used in Flow A anymore)
        if ($('results') && $('results').style.display !== 'none') {
          autoRun();
        }
      });
    }

    // These elements are created dynamically, so listeners are attached in renderSearchRow()

    $("resetBtn").addEventListener("click", () => {
      // Reset state completely
      state.intent = null;
      state.mode = "ATAR";
      state.score = 0;
      state.salary = "couple";
      state.selectedProfession = null;
      state.country = null;
      state.selectedCountry = null;
      state.studiesAndInterests = [];
      state.filters = {};
      state.contextMerged = false;
      state.hasSearched = false;
      
      // Reset salary select if it exists
      if ($("salarySelect")) {
        $("salarySelect").value = "couple";
      }
      
      // Reset filters
      setFilter("study","any");
      setFilter("ps","any");
      setFilter("da","any");
      setFilter("io","any");

      // Clear profession
      clearProfession();

      // Clear ALL score input fields
      const scoreInput = $("scoreInput");
      if (scoreInput) {
        scoreInput.value = '';
      }
      const scoreInputMerge = $("scoreInputMerge");
      if (scoreInputMerge) {
        scoreInputMerge.value = '';
      }

      // Clear studies and interests
      const studiesInput = $("studiesInput");
      if (studiesInput) {
        studiesInput.value = '';
      }
      renderStudiesTags();
      closeStudiesDropdown();

      // Clear and hide all result containers
      const framingContainer = $('resultsFramingContainer');
      const evalContainer = $('evaluationContainer');
      const mergeContainer = $('mergePromptContainer');
      const refineContainer = $('refineContainer');
      const resultsDiv = $('results');
      
      if (framingContainer) {
        framingContainer.innerHTML = '';
        framingContainer.style.display = 'none';
      }
      if (evalContainer) {
        evalContainer.innerHTML = '';
        evalContainer.style.display = 'none';
      }
      if (mergeContainer) {
        mergeContainer.innerHTML = '';
        mergeContainer.style.display = 'none';
      }
      if (refineContainer) {
        refineContainer.innerHTML = '';
        refineContainer.style.display = 'none';
      }
      if (resultsDiv) {
        resultsDiv.innerHTML = '';
        resultsDiv.style.display = 'none';
      }
      
      // Hide search row
      $('searchRow').style.display = 'none';
      
      // Show aesthetic block, hide studies section and filters (back to initial screen)
      const aestheticBlock = $('aestheticStudyBlock');
      const studiesSection = $('studiesSection');
      const filters = $('filters');
      if (aestheticBlock) aestheticBlock.classList.remove('hidden');
      if (studiesSection) studiesSection.classList.add('hidden');
      if (filters) filters.classList.add('hidden');
      
      // Close mode modal if open
      hideModeModal();
      
      // Close any open dropdowns
      const dropPanel = $('dropPanel');
      if (dropPanel) {
        dropPanel.classList.remove('open');
      }
      const dropPanelRefine = $('dropPanelRefine');
      if (dropPanelRefine) {
        dropPanelRefine.classList.remove('open');
      }
      
      // Reset main heading
      $('mainHeading').textContent = 'Your shortlist';
      $('mainHint').textContent = 'Click a card to expand details. (Each card is different.)';
      
      // Remove selected state from intent cards
      document.querySelectorAll('.intentCard').forEach(card => {
        card.classList.remove('selected');
      });
      
      // Clear any profession input fields
      const professionInput = $('professionInput');
      if (professionInput) {
        professionInput.value = '';
      }
      const professionInputRefine = $('professionInputRefine');
      if (professionInputRefine) {
        professionInputRefine.value = '';
      }
      
      // Clear profession sub text
      const professionSub = $('professionSub');
      if (professionSub) {
        professionSub.textContent = 'Select from real list of ~220 professions';
      }
      
      // Show intent fork again (this will show both cards)
      renderIntentFork();
      updateBackButton();
      
      // Scroll to top
      window.scrollTo({top: 0, behavior: "smooth"});
    });

    // filter pills click - only auto-update if results are already shown
    $("filters").addEventListener("click", (e) => {
      const pill = e.target.closest(".filterPill");
      if (!pill) return;
      setFilter(pill.dataset.group, pill.dataset.value);
      // Only auto-update if results are already visible
      if ($('results') && $('results').style.display !== 'none') {
        autoRun();
      }
    });

    // dropdown open/close + keyboard
    $("professionInput").addEventListener("focus", () => {
      openDrop();
      renderDropList();
    });

    $("professionInput").addEventListener("input", () => {
      // If user types something that isn't the selected profession, clear selection
      if (state.selectedProfession && $("professionInput").value.trim() !== state.selectedProfession.name){
        state.selectedProfession = null;
        $("professionSub").textContent = "Real list: leave blank to see options for your score.";
      }
      openDrop();
      renderDropList();
      updateCTA();
    });

    document.addEventListener("click", (e) => {
      const inside = e.target.closest(".dropdown") || e.target.closest(".dropPanel");
      const insideCountry = e.target.closest(".countryDropdown") || e.target.closest(".countryDropPanel");
      if (!inside){
        closeDrop();
      }
      if (!insideCountry){
        closeCountryDrop();
      }
    });

    $("professionInput").addEventListener("keydown", (e) => {
      if (!$("dropPanel").classList.contains("open")) return;

      if (e.key === "ArrowDown"){
        e.preventDefault();
        dropIndex = Math.min(dropIndex + 1, filteredList.length - 1);
        highlightRow();
      }
      if (e.key === "ArrowUp"){
        e.preventDefault();
        dropIndex = Math.max(dropIndex - 1, 0);
        highlightRow();
      }
      if (e.key === "Enter"){
        e.preventDefault();
        const pick = filteredList[dropIndex];
        if (pick){
          selectProfession(pick);
          closeDrop();
          state.hasSearched = true;
          runSearch(true);
        }
      }
      if (e.key === "Escape"){
        closeDrop();
      }
    });

    // Initial render after mode selection (but keep empty until user picks mode)
    function safeInit(){
      // updateCTA(); // removed for dual-intent flow
      $("eligibleChip").innerHTML = `<span class="dot2"></span><strong>Total careers:</strong>  ${PROFESSIONS.length}`;
      $("results").innerHTML = `
        <div class="card" style="cursor:default;">
          <div class="cardTitle">Pick your starting point above</div>
          <div class="tags">
            <span class="tag">Two paths</span>
            <span class="tag">Real list</span>
            <span class="tag">Real list</span>
          </div>
          <ul class="bullets">
            <li>Pick a mode, enter your score, and you‚Äôll immediately see realistic options.</li>
            <li>Optional: search a profession from the list to get ‚Äúrelated paths‚Äù.</li>
          </ul>
        </div>
      `;
      renderIntentFork();
    }
    safeInit();
    
    // ---------- Country front screen ----------
    let countryDropIndex = 0;
    let filteredCountries = [];
    
    function openCountryDrop() {
      const panel = $('countryDropPanel');
      if (panel) panel.classList.add('open');
    }
    function closeCountryDrop() {
      const panel = $('countryDropPanel');
      if (panel) panel.classList.remove('open');
    }
    
    function renderCountryDropList() {
      const q = ($('countryInput') && $('countryInput').value.trim() || '').toLowerCase();
      filteredCountries = COUNTRY_LIST.filter(c => 
        !q || c.name.toLowerCase().includes(q)
      );
      countryDropIndex = 0;
      
      const list = $('countryDropList');
      if (!list) return;
      list.innerHTML = '';
      
      filteredCountries.forEach((c, i) => {
        const row = document.createElement('div');
        row.className = 'row' + (i === 0 ? ' active' : '');
        row.innerHTML = `
          <div class="rowMain">
            <div class="name">${escapeHtml(c.name)}</div>
            <div class="meta">${c.usesATAR ? 'ATAR & GPA' : 'GPA only'}</div>
          </div>
        `;
        row.addEventListener('mousedown', (e) => {
          e.preventDefault();
          selectCountry(c);
          closeCountryDrop();
        });
        list.appendChild(row);
      });
    }
    
    function selectCountry(country) {
      state.selectedCountry = country;
      const input = $('countryInput');
      if (input) input.value = country.name;
    }
    
    function showAppContent() {
      const countryScreen = $('countryScreen');
      const appContent = $('appContent');
      if (countryScreen) countryScreen.classList.add('hidden');
      if (appContent) appContent.style.display = '';
    }
    
    function hideCountryScreen() {
      let countryObj = state.selectedCountry;
      const input = $('countryInput');
      const typed = input ? input.value.trim() : '';
      if (!countryObj && typed) {
        countryObj = COUNTRY_LIST.find(c => c.name.toLowerCase() === typed.toLowerCase());
      }
      state.country = countryObj ? countryObj.name : (typed || null);
      state.selectedCountry = countryObj || null;
      showAppContent();
    }
    
    const countryContinueBtn = $('countryContinueBtn');
    const countrySkipBtn = $('countrySkipBtn');
    const countryInput = $('countryInput');
    
    if (countryContinueBtn) countryContinueBtn.addEventListener('click', hideCountryScreen);
    
    if (countrySkipBtn) countrySkipBtn.addEventListener('click', () => {
      state.country = null;
      state.selectedCountry = null;
      showAppContent();
    });
    
    // Country dropdown - focus, input, keyboard
    if (countryInput) {
      countryInput.addEventListener('focus', () => {
        openCountryDrop();
        renderCountryDropList();
      });
      countryInput.addEventListener('input', () => {
        openCountryDrop();
        renderCountryDropList();
      });
      countryInput.addEventListener('keydown', (e) => {
        const panel = $('countryDropPanel');
        if (!panel || !panel.classList.contains('open')) {
          if (e.key === 'Enter') {
            e.preventDefault();
            hideCountryScreen();
          }
          return;
        }
        if (e.key === 'ArrowDown') {
          e.preventDefault();
          countryDropIndex = Math.min(countryDropIndex + 1, filteredCountries.length - 1);
          const rows = $('countryDropList')?.querySelectorAll('.row');
          rows?.forEach((r, i) => r.classList.toggle('active', i === countryDropIndex));
          rows?.[countryDropIndex]?.scrollIntoView({ block: 'nearest' });
        }
        if (e.key === 'ArrowUp') {
          e.preventDefault();
          countryDropIndex = Math.max(countryDropIndex - 1, 0);
          const rows = $('countryDropList')?.querySelectorAll('.row');
          rows?.forEach((r, i) => r.classList.toggle('active', i === countryDropIndex));
        }
        if (e.key === 'Enter') {
          e.preventDefault();
          const pick = filteredCountries[countryDropIndex];
          if (pick) {
            selectCountry(pick);
            closeCountryDrop();
          } else {
            hideCountryScreen();
          }
        }
        if (e.key === 'Escape') {
          closeCountryDrop();
        }
      });
    }
    
    // Wire up intent fork CTAs - simple direct attachment (original working version)
    document.querySelectorAll('.intentCard').forEach(card => {
      card.addEventListener('click', function() {
        const intent = this.dataset.intent;
        if (intent) {
          selectIntent(intent);
        }
      });
    });
    
    // Wire up chip buttons - use event delegation to handle dynamically created chips
    document.addEventListener('click', (e) => {
      const chip = e.target.closest('.chip.clickable');
      if (chip) {
        const chipType = chip.dataset.chip;
        if (chipType) {
          showInfoModal(chipType);
        }
      }
    });
    
    // Info modal functions
    function showInfoModal(type) {
      const modal = $('infoModal');
      const title = $('infoModalTitle');
      const content = $('infoModalContent');
      const closeBtn = $('infoModalClose');
      
      let titleText = '';
      let contentText = '';
      
      switch(type) {
        case 'real-list':
          titleText = 'Real-list Matching';
          contentText = 'This tool uses a curated list of ~220 real professions with verified ATAR/GPA requirements. Each career has been researched with actual entry requirements, not estimated values. This ensures you get accurate, actionable information about career pathways.';
          break;
        case 'explainable':
          titleText = 'Explainable Output';
          contentText = 'Every career recommendation includes clear explanations of why it matches your profile. You\'ll see how your ATAR/GPA, salary preferences, and study interests contribute to each match percentage. The system is transparent about eligibility requirements and alternative pathways.';
          break;
        case 'evidence':
          titleText = 'Prototype-safe Evidence Notes';
          contentText = 'All career information includes evidence tags indicating the source of requirements: "Formal" (official university requirements), "Rule" (rule-of-thumb estimates), and "Varies" (requirements that differ by institution). This helps you understand the reliability of each data point.';
          break;
        case 'eligible':
          const eligibleCount = state.score > 0 ? PROFESSIONS.filter(p => isEligibleByScore(p)).length : 0;
          titleText = 'Eligible Careers';
          contentText = `This shows how many careers from our list of ${PROFESSIONS.length} professions are realistically achievable with your current ATAR/GPA. The count updates based on your score and filters. Careers are marked as eligible if your score meets or exceeds their minimum requirements.`;
          break;
        default:
          titleText = 'Information';
          contentText = 'Information about this feature.';
      }
      
      title.textContent = titleText;
      content.textContent = contentText;
      
      modal.style.display = '';
      modal.classList.add('show');
      
      // Close button handler
      closeBtn.onclick = () => {
        hideInfoModal();
      };
      
      // Close on backdrop click
      modal.onclick = (e) => {
        if (e.target === modal) {
          hideInfoModal();
        }
      };
    }
    
    function hideInfoModal() {
      const modal = $('infoModal');
      modal.classList.remove('show');
      modal.style.display = 'none';
    }
    
    // Initialize back button state
    updateBackButton();
    
    // ---------- Studies & Interests Dropdown Functions ----------
    let studiesDropdownIndex = 0;
    let filteredSubjects = [];
    
    function renderStudiesTags(){
      const container = $('studiesTagsContainer');
      if (!container) return;
      
      container.innerHTML = '';
      state.studiesAndInterests.forEach(subjectId => {
        const subject = SUBJECTS_LIST.find(s => s.id === subjectId);
        if (!subject) return;
        
        const tag = document.createElement('div');
        tag.className = 'studiesTag';
        tag.innerHTML = `
          <span>${escapeHtml(subject.name)}</span>
          <span class="removeTag" data-subject-id="${subjectId}">√ó</span>
        `;
        
        const removeBtn = tag.querySelector('.removeTag');
        removeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          removeSubject(subjectId);
        });
        
        container.appendChild(tag);
      });
    }
    
    function removeSubject(subjectId){
      state.studiesAndInterests = state.studiesAndInterests.filter(id => id !== subjectId);
      renderStudiesTags();
      if (state.intent && state.mode && state.score > 0) {
        autoRun();
      }
    }
    
    function addSubject(subjectId){
      if (state.studiesAndInterests.includes(subjectId)) return;
      state.studiesAndInterests.push(subjectId);
      renderStudiesTags();
      $('studiesInput').value = '';
      closeStudiesDropdown();
      if (state.intent && state.mode && state.score > 0) {
        autoRun();
      }
    }
    
    function openStudiesDropdown(){
      const dropdown = $('studiesDropdown');
      if (dropdown) {
        dropdown.classList.add('open');
      }
    }
    
    function closeStudiesDropdown(){
      const dropdown = $('studiesDropdown');
      if (dropdown) {
        dropdown.classList.remove('open');
      }
      studiesDropdownIndex = 0;
    }
    
    function renderStudiesDropdown(filterText = ''){
      const list = $('studiesDropdownList');
      if (!list) return;
      
      const filter = filterText.trim().toLowerCase();
      filteredSubjects = SUBJECTS_LIST.filter(s => {
        if (state.studiesAndInterests.includes(s.id)) return false; // Hide already selected
        if (!filter) return true;
        return s.name.toLowerCase().includes(filter) || 
               s.categories.some(c => c.toLowerCase().includes(filter)) ||
               s.tags.some(t => t.toLowerCase().includes(filter));
      });
      
      list.innerHTML = '';
      studiesDropdownIndex = 0;
      
      if (filteredSubjects.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'studiesDropdownItem';
        empty.style.cursor = 'default';
        empty.textContent = 'No matching subjects found';
        list.appendChild(empty);
        return;
      }
      
      filteredSubjects.forEach((subject, i) => {
        const item = document.createElement('div');
        item.className = 'studiesDropdownItem' + (i === 0 ? ' selected' : '');
        item.innerHTML = `
          <div style="font-weight: 700; margin-bottom: 2px;">${escapeHtml(subject.name)}</div>
          <div style="font-size: 12px; color: #64748b; font-weight: 500;">
            ${subject.categories.join(' ‚Ä¢ ')}
          </div>
        `;
        item.addEventListener('click', () => {
          addSubject(subject.id);
        });
        list.appendChild(item);
      });
    }
    
    function handleStudiesKeyboard(e){
      const dropdown = $('studiesDropdown');
      if (!dropdown || !dropdown.classList.contains('open')) return;
      
      const items = dropdown.querySelectorAll('.studiesDropdownItem');
      
      if (e.key === 'ArrowDown'){
        e.preventDefault();
        studiesDropdownIndex = Math.min(studiesDropdownIndex + 1, filteredSubjects.length - 1);
        items.forEach((item, i) => {
          item.classList.toggle('selected', i === studiesDropdownIndex);
        });
        items[studiesDropdownIndex]?.scrollIntoView({block: 'nearest'});
      } else if (e.key === 'ArrowUp'){
        e.preventDefault();
        studiesDropdownIndex = Math.max(studiesDropdownIndex - 1, 0);
        items.forEach((item, i) => {
          item.classList.toggle('selected', i === studiesDropdownIndex);
        });
        items[studiesDropdownIndex]?.scrollIntoView({block: 'nearest'});
      } else if (e.key === 'Enter'){
        e.preventDefault();
        if (filteredSubjects[studiesDropdownIndex]) {
          addSubject(filteredSubjects[studiesDropdownIndex].id);
        }
      } else if (e.key === 'Escape'){
        e.preventDefault();
        closeStudiesDropdown();
      }
    }
    
    // Wire up studies input
    const studiesInput = $('studiesInput');
    if (studiesInput) {
      studiesInput.addEventListener('focus', () => {
        openStudiesDropdown();
        renderStudiesDropdown(studiesInput.value);
      });
      
      studiesInput.addEventListener('input', (e) => {
        openStudiesDropdown();
        renderStudiesDropdown(e.target.value);
      });
      
      studiesInput.addEventListener('keydown', handleStudiesKeyboard);
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        const container = $('studiesInputWrapper');
        if (container && !container.contains(e.target)) {
          closeStudiesDropdown();
        }
      });
    }
    
    // Initialize tags display
    renderStudiesTags();
  </script>
</body>
</html>
