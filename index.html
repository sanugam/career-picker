<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CareerPicker</title>

  <style>
    :root{
      --blue:#003b95;
      --blue2:#002f7a;
      --yellow:#febb02;
      --bg:#f5f7fb;
      --text:#111827;
      --muted:#6b7280;
      --shadow: 0 18px 40px rgba(0,0,0,.12);
      --softshadow: 0 10px 28px rgba(0,0,0,.08);
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:var(--bg);
    }

    .topbar{ background:var(--blue); color:#fff; padding:18px 20px; }
    .topbarInner{
      max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:16px;
    }
    .brand{ font-weight:900; letter-spacing:.2px; font-size:20px; }
    .topActions{ display:flex; align-items:center; gap:10px; font-weight:700; }
    .pill{
      border:1px solid rgba(255,255,255,.35);
      border-radius:999px;
      padding:8px 12px;
      background:transparent;
      color:#fff;
      font-weight:800;
      cursor:pointer;
    }
    .pill.white{ background:#fff; color:var(--blue); border-color:#fff; }

    .hero{
      background:linear-gradient(180deg,var(--blue) 0%, var(--blue2) 100%);
      color:#fff;
      padding:34px 20px 54px;
      position:relative;
    }
    .wrap{ max-width:1100px; margin:0 auto; }
    .hero h1{ margin:0; font-size:56px; letter-spacing:-.6px; line-height:1.02; }
    .hero p{ margin:10px 0 0; font-size:18px; color:rgba(255,255,255,.88); max-width:900px; }

    .searchbar{
      margin-top:18px;
      background:var(--yellow);
      border-radius:18px;
      padding:4px;
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1.8fr .7fr 1fr .38fr;
      gap:4px;
      align-items:stretch;
    }
    .field{
      background:#fff;
      border-radius:14px;
      padding:12px 14px;
      display:flex;
      gap:10px;
      align-items:flex-start;
      min-height:74px;
      position:relative;
    }
    .icon{
      width:26px; height:26px; display:flex; align-items:center; justify-content:center;
      margin-top:6px; opacity:.75; font-weight:900;
    }
    .label{ font-size:14px; color:var(--muted); font-weight:800; margin-bottom:6px; }
    input, select{
      width:100%;
      border:none;
      outline:none;
      font-size:18px;
      font-weight:800;
      color:var(--text);
      background:transparent;
    }
    select{ padding-right:10px; cursor:pointer; }

    .btn{
      background:var(--blue);
      color:#fff;
      border:none;
      border-radius:14px;
      font-size:18px;
      font-weight:900;
      cursor:pointer;
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }
    .btn:hover{ filter:brightness(1.05); }

    /* Booking-like dropdown panel */
    .comboPanel{
      position:absolute;
      left:8px;
      right:8px;
      top:82px;
      background:#fff;
      border-radius:16px;
      box-shadow: var(--softshadow);
      border: 1px solid rgba(0,0,0,.08);
      overflow:hidden;
      display:none;
      z-index:30;
      color: var(--text);
    }
    .panelHeader{
      padding:12px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:#fff;
      color:var(--text);
    }
    .panelTitle{ font-weight:1000; color:var(--text); }
    .panelHint{ font-weight:900; color:var(--muted); font-size:12px; }
    .panelList{
      max-height:360px;
      overflow:auto;
      border-top:1px solid rgba(0,0,0,.06);
      background:#fff;
      color:var(--text);
    }
    .panelItem{
      display:flex;
      gap:12px;
      padding:12px 14px;
      align-items:center;
      border-top:1px solid rgba(0,0,0,.06);
      cursor:pointer;
      background:#fff;
      color:var(--text);
    }
    .panelItem:first-child{ border-top:none; }
    .panelItem:hover{ background:#f6f7fb; }
    .panelItem.active{ background:#eef2ff; }
    .badge{
      width:36px; height:36px; border-radius:999px;
      background:#f3f4f6;
      display:flex; align-items:center; justify-content:center;
      font-weight:1000; opacity:.95; flex:0 0 auto;
      color: var(--text);
    }
    .pTitle{ font-weight:1000; font-size:16px; color:var(--text); }
    .pSub{ color:var(--muted); font-weight:850; margin-top:2px; font-size:13px; }

    .errorLine{
      margin-top:8px;
      font-weight:900;
      color: #fff;
      background: rgba(180, 35, 24, .28);
      border:1px solid rgba(255,255,255,.25);
      padding:10px 12px;
      border-radius:12px;
      display:none;
    }
    .infoLine{
      margin-top:10px;
      font-weight:900;
      color:#fff;
      background: rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      padding:10px 12px;
      border-radius:12px;
    }
    .smallNote{ font-size:12px; font-weight:900; opacity:.85; margin-top:6px; }

    .section{ padding:26px 20px; }
    .resultsTitle{ margin:10px 0 0; font-size:34px; font-weight:1000; letter-spacing:-.4px; }
    #results{ display:none; margin-top:12px; }

    .resultCard{
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(0,0,0,.06);
      box-shadow: 0 12px 22px rgba(0,0,0,.06);
      padding:18px;
      margin:14px 0;
      cursor:pointer;
      transition: transform .08s ease;
    }
    .resultCard:hover{ transform: translateY(-1px); }
    .resultTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:14px; }
    .resultName{ font-size:28px; font-weight:1000; letter-spacing:-.2px; margin:0; }
    .match{ font-weight:1000; color:var(--blue); font-size:22px; white-space:nowrap; margin-top:2px; }
    .tags{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .tag{
      border:1px solid rgba(0,0,0,.10);
      background:#f7f8fb;
      border-radius:999px;
      padding:7px 10px;
      font-weight:1000;
      color:#334155;
      font-size:14px;
    }
    .why{ margin-top:12px; color:#111827; font-weight:1000; }
    ul{ margin:8px 0 0 18px; color:#475569; font-weight:800; line-height:1.45; }

    .details{ display:none; margin-top:14px; padding-top:14px; border-top:1px solid rgba(0,0,0,.08); }
    .resultCard.expanded .details{ display:block; }

    .detailsGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px 16px;
      margin-top:10px;
    }
    .detailItem{
      background:#f7f8fb;
      border:1px solid rgba(0,0,0,.06);
      border-radius:14px;
      padding:12px 12px;
      font-size:14px;
    }
    .detailTitle{ font-weight:1000; margin-bottom:4px; color:#0f172a; }
    .detailText{ color:#334155; font-weight:850; line-height:1.35; }

    .moreRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top:12px;
    }
    .hint{ opacity:.65; font-weight:1000; }
    .pillBtn{
      border:1px solid rgba(0,0,0,.12);
      background:#fff;
      padding:8px 10px;
      border-radius:999px;
      font-weight:1000;
      cursor:pointer;
    }
    .bottomRow{ display:flex; gap:10px; margin:16px 0 30px; }
    .secondaryBtn{
      background:#fff;
      border:1px solid rgba(0,0,0,.12);
      border-radius:14px;
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
    }

    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:9999;
      padding:18px;
    }
    .modal{
      width:min(720px, 100%);
      background:#fff;
      border-radius:22px;
      box-shadow: var(--shadow);
      border:1px solid rgba(0,0,0,.08);
      overflow:hidden;
    }
    .modalTop{
      background: linear-gradient(180deg, var(--blue) 0%, var(--blue2) 100%);
      color:#fff;
      padding:18px 18px 16px;
    }
    .modalTop h2{
      margin:0;
      font-size:28px;
      font-weight:1000;
      letter-spacing:-.2px;
    }
    .modalTop p{
      margin:8px 0 0;
      font-weight:850;
      opacity:.9;
      line-height:1.35;
    }
    .modalBody{ padding:16px 18px 18px; }
    .choiceGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    .choiceBtn{
      border:1px solid rgba(0,0,0,.10);
      background:#fff;
      border-radius:16px;
      padding:14px 14px;
      cursor:pointer;
      text-align:left;
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
    }
    .choiceBtn:hover{ transform: translateY(-1px); }
    .choiceTitle{ font-weight:1000; font-size:18px; }
    .choiceSub{ margin-top:6px; color:var(--muted); font-weight:850; }
    .finePrint{
      margin-top:12px;
      color:var(--muted);
      font-weight:850;
      font-size:13px;
      line-height:1.35;
    }

    @media (max-width: 980px){
      .searchbar{ grid-template-columns: 1fr; }
      .hero h1{ font-size:42px; }
      .detailsGrid{ grid-template-columns: 1fr; }
      .comboPanel{ top:76px; }
      .choiceGrid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="modalOverlay" id="startModal">
    <div class="modal">
      <div class="modalTop">
        <h2>Start: Are you using ATAR or GPA?</h2>
        <p>
          We‚Äôll filter professions based on your score. Low scores still have options (traineeships, retail, hospitality, trades).
          <br/>Example: ‚ÄúDoctor‚Äù won‚Äôt appear unless your score is high enough.
        </p>
      </div>
      <div class="modalBody">
        <div class="choiceGrid">
          <button class="choiceBtn" id="chooseATAR">
            <div class="choiceTitle">ATAR (0‚Äì100)</div>
            <div class="choiceSub">Australian high school planning.</div>
          </button>
          <button class="choiceBtn" id="chooseGPA">
            <div class="choiceTitle">GPA (0‚Äì100)</div>
            <div class="choiceSub">If you‚Äôre treating GPA like a 0‚Äì100 score.</div>
          </button>
        </div>
        <div class="finePrint">
          Note: These are simple cutoffs (not official requirements). We can refine later by university/state.
        </div>
      </div>
    </div>
  </div>

  <div class="topbar">
    <div class="topbarInner">
      <div class="brand">CareerPicker</div>
      <div class="topActions">
        <span style="opacity:.9;font-weight:900">AUD</span>
        <button class="pill">Register</button>
        <button class="pill white">Sign in</button>
      </div>
    </div>
  </div>

  <div class="hero">
    <div class="wrap">
      <h1>Find your next career</h1>
      <p id="heroSubtitle">
        Pick a real job from the dropdown (type to search, scroll to browse). Jobs are filtered by your ATAR/GPA score.
      </p>

      <div class="searchbar">
        <div class="field" id="jobField">
          <div class="icon">üíº</div>
          <div style="width:100%">
            <div class="label">Choose a profession</div>
            <input id="jobInput" autocomplete="off" placeholder="Start typing‚Ä¶ (e.g. Plumber, Nurse, Software Engineer)" />
            <div class="smallNote" id="jobCountNote"></div>
          </div>

          <div class="comboPanel" id="comboPanel">
            <div class="panelHeader">
              <div class="panelTitle">Professions (eligible)</div>
              <div class="panelHint">Type to filter ‚Ä¢ Scroll ‚Ä¢ Enter to select</div>
            </div>
            <div class="panelList" id="panelList"></div>
          </div>
        </div>

        <div class="field">
          <div class="icon">üßæ</div>
          <div style="width:100%">
            <div class="label" id="scoreLabel">ATAR (0‚Äì100)</div>
            <input id="scoreInput" type="number" min="0" max="100" value="70" />
          </div>
        </div>

        <div class="field">
          <div class="icon">üí∞</div>
          <div style="width:100%">
            <div class="label">Salary circumstance (AUD)</div>
            <select id="salary">
              <option value="solo" selected>Low: supporting only yourself ‚Äî $45k‚Äì$70k</option>
              <option value="family">Medium: supporting a family ‚Äî $70k‚Äì$120k</option>
              <option value="wealth">High: wealth-building / high growth ‚Äî $120k‚Äì$250k+</option>
            </select>
          </div>
        </div>

        <button class="btn" id="searchBtn" disabled>Search</button>
      </div>

      <div class="errorLine" id="errorLine">
        Please select a job from the dropdown list (only eligible jobs are shown).
      </div>

      <div class="infoLine" id="eligibleInfo">
        Eligible jobs shown for: <span id="modeText">ATAR</span> = <span id="scoreText">70</span>.
        Increase score to unlock more professions.
      </div>
    </div>
  </div>

  <div class="section">
    <div class="wrap">
      <div class="resultsTitle">Your shortlist (Strict mode)</div>
      <div id="results"></div>

      <div class="bottomRow">
        <button class="secondaryBtn" id="resetBtn">Reset</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // ======================
    // Categories (expanded to include low-score paths)
    // ======================
    const CATEGORIES = [
      { id:"law", name:"Law", tags:["Lawyer","Paralegal","Legal Aid","Corporate Law"],
        why:["Best if you like evidence + writing + rules.","Structured thinking: rules, exceptions, application.","High responsibility + precision."],
        details:{
          subjects:"English, Legal Studies, Humanities, Business/Accounting",
          pathways:"Uni law (or related degree) ‚Üí clerkships/grad roles ‚Üí specialize (corporate/criminal/family/etc.)",
          dayToDay:"Reading cases/contracts, writing advice, meetings with clients, preparing documents, negotiating.",
          skills:"Writing, analysis, public speaking, attention to detail, ethics",
          entry:"Often university-based; strong English helps a lot.",
          next:"Legal Studies, debate, read case summaries, talk to a lawyer."
        }
      },
      { id:"policing", name:"Justice & Policing", tags:["Police","Detective","Corrections","Forensics"],
        why:["Structure + public service.","Calm under pressure + communication.","Clear training routes."],
        details:{
          subjects:"English, Psychology, Health/PE, Science",
          pathways:"Recruit training ‚Üí experience ‚Üí specialist units (investigations/forensics/etc.)",
          dayToDay:"Incidents, reports, interviews, teamwork, decisions in real-time.",
          skills:"Communication, resilience, teamwork, fitness",
          entry:"Fitness + background checks + training requirements vary.",
          next:"Check requirements, build fitness, community volunteering."
        }
      },
      { id:"government", name:"Policy & Government", tags:["Policy","Compliance","Regulation","Public Service"],
        why:["Systems + fairness + scale.","Writing + research + organized thinking.","Links well with law/business/tech."],
        details:{
          subjects:"English, Humanities, Economics, Legal Studies",
          pathways:"Uni/TAFE ‚Üí grad programs ‚Üí policy/ops/regulatory specializations",
          dayToDay:"Reading data, writing briefs, stakeholder meetings, improving processes.",
          skills:"Research, writing, stakeholder management, systems thinking",
          entry:"Communication + structure matter a lot.",
          next:"Practice writing briefs, read role descriptions, leadership roles."
        }
      },
      { id:"tech", name:"Technology & Software", tags:["Software","Cyber","Data","Cloud"],
        why:["Build things + solve puzzles.","Fast learners win here.","Portfolio paths exist."],
        details:{
          subjects:"Maths, Digital Tech, Software Dev, Physics",
          pathways:"Uni/TAFE/self-taught ‚Üí portfolio ‚Üí junior role ‚Üí specialization",
          dayToDay:"Coding, debugging, code reviews, planning features, fixing issues, learning tools.",
          skills:"Coding, problem-solving, systems thinking, communication",
          entry:"Portfolio can matter more than scores (role-dependent).",
          next:"Build 3 projects, learn Git, pick JS or Python."
        }
      },
      { id:"health", name:"Healthcare", tags:["Nursing","Allied Health","Medicine","Psychology"],
        why:["Science + helping people.","Responsibility + teamwork.","Clear training routes with placements."],
        details:{
          subjects:"Biology, Chemistry, English, Maths",
          pathways:"Uni/TAFE ‚Üí placements ‚Üí registration ‚Üí specialization",
          dayToDay:"Assessments, care plans, documentation, teamwork, communication.",
          skills:"Empathy, accuracy, communication, stamina",
          entry:"Some pathways are very competitive (medicine/dentistry).",
          next:"Check prerequisites early, pick sciences, volunteer."
        }
      },
      { id:"business", name:"Business & Management", tags:["Business Analyst","Project","Marketing","Ops"],
        why:["Planning + persuasion + improvement.","Teamwork + outcomes.","Flexible across industries."],
        details:{
          subjects:"Business, Economics, Accounting, English",
          pathways:"Uni/TAFE ‚Üí grad roles ‚Üí specialize (BA/PM/Marketing/etc.)",
          dayToDay:"Meetings, planning, docs, analysis, coordination, process improvement.",
          skills:"Communication, analysis, planning, negotiation",
          entry:"Projects/internships are huge.",
          next:"Run small projects, learn Excel, practice presenting."
        }
      },
      { id:"creative", name:"Creative & Media", tags:["UI/UX","Graphic","Video","Content"],
        why:["Design + storytelling.","Portfolio is key.","Self-driven practice matters."],
        details:{
          subjects:"Art, Media, English, Digital Tech",
          pathways:"Portfolio ‚Üí courses ‚Üí internships ‚Üí niche specialization",
          dayToDay:"Designing, editing, iterating, feedback cycles, publishing.",
          skills:"Taste, iteration, storytelling, tools, feedback-handling",
          entry:"Portfolio often beats grades.",
          next:"Build a portfolio, learn Figma/Adobe, post weekly work."
        }
      },
      { id:"engineering", name:"Engineering", tags:["Civil","Mechanical","Electrical","Mechatronics"],
        why:["Maths + physics + building systems.","Design + testing mindset.","Strong demand in many areas."],
        details:{
          subjects:"Maths Methods/Specialist, Physics, Chemistry",
          pathways:"Uni engineering ‚Üí placements ‚Üí grad engineer ‚Üí chartered/specialist",
          dayToDay:"Design, modelling, testing, documentation, safety checks, stakeholder work.",
          skills:"Maths, modelling, design, teamwork, safety mindset",
          entry:"Advanced maths helps a lot.",
          next:"Choose advanced maths, STEM projects, robotics club."
        }
      },
      { id:"education", name:"Education", tags:["Teacher","Tutor","Early Childhood","Support"],
        why:["Explaining + helping people improve.","Patience + structure.","Stable long-term work."],
        details:{
          subjects:"English + your strongest specialty subjects",
          pathways:"Uni teaching degree ‚Üí placements ‚Üí registration",
          dayToDay:"Lesson plans, teaching, marking, communication, improving learning.",
          skills:"Communication, patience, structure, creativity",
          entry:"Requires qualifications + placements.",
          next:"Volunteer tutoring, practice explaining, check prerequisites."
        }
      },

      // NEW low-score-friendly categories
      { id:"trades", name:"Trades & Apprenticeships", tags:["Electrician","Plumber","Carpenter","Mechanic"],
        why:["Earn while you learn (apprenticeships).","Hands-on + practical problem solving.","Strong long-term income with experience."],
        details:{
          subjects:"Maths, Technology, Design, hands-on projects",
          pathways:"Apprenticeship/TAFE ‚Üí trade qualification ‚Üí specialize / run a business",
          dayToDay:"On-site work, tools, safety, fixes, installs, customer communication.",
          skills:"Practical skills, safety, reliability, teamwork",
          entry:"Often doesn‚Äôt require a high ATAR; attitude matters.",
          next:"Visit TAFE pages, talk to tradies, try work experience."
        }
      },
      { id:"hospitality", name:"Hospitality & Retail", tags:["Retail","Cafe","Customer Service","Supervision"],
        why:["Always hiring; fast way to earn.","Builds confidence + communication.","Can grow into management."],
        details:{
          subjects:"English, business basics, teamwork",
          pathways:"Entry role ‚Üí supervisor ‚Üí manager ‚Üí (optional) business owner",
          dayToDay:"Serving customers, stocking, cleaning, team coordination.",
          skills:"Communication, speed, reliability, resilience",
          entry:"Very accessible at low scores.",
          next:"Apply local jobs, build resume, practice interviews."
        }
      },
      { id:"logistics", name:"Transport & Logistics", tags:["Warehousing","Delivery","Forklift","Supply Chain"],
        why:["Stable demand.","Clear skill tickets (forklift, licenses).","Growth into coordination roles."],
        details:{
          subjects:"Maths basics, teamwork, safety",
          pathways:"Entry ‚Üí tickets/licenses ‚Üí lead hand ‚Üí supervisor ‚Üí planner",
          dayToDay:"Picking/packing, dispatch, deliveries, safety checks, schedules.",
          skills:"Reliability, time management, safety",
          entry:"Accessible; some roles need licenses.",
          next:"Look at forklift courses, get driver hours, learn basic Excel."
        }
      }
    ];

    // Strict-mode related categories (expanded)
    const RELATED = {
      law:        ["government","business","policing"],
      policing:   ["government","law","health"],
      government: ["law","business","tech"],
      tech:       ["engineering","business","creative"],
      health:     ["policing","education","government"],
      business:   ["government","tech","law"],
      creative:   ["tech","business","education"],
      engineering:["tech","business","government"],
      education:  ["health","government","creative"],

      trades:     ["logistics","business","engineering"],
      hospitality:["business","logistics","creative"],
      logistics:  ["business","trades","government"]
    };

    // Base minimums: now include low-score categories so you NEVER get "zero jobs"
    const CATEGORY_MIN = {
      hospitality: 0,
      logistics: 10,
      trades: 20,

      tech: 45,
      business: 50,
      creative: 40,
      policing: 55,
      government: 60,
      education: 60,
      health: 70,
      engineering: 75,
      law: 80
    };

    // Some job overrides (high requirements)
    const JOB_MIN_OVERRIDE = {
      "Doctor": 95,
      "Surgeon": 98,
      "General Practitioner": 95,
      "Dentist": 92,
      "Psychologist": 85,
      "Pharmacist": 85,
      "Radiographer": 80,
      "Sonographer": 82,
      "Paramedic": 78,
      "Midwife": 78,

      "Lawyer": 85,
      "Barrister": 90,

      "AI Engineer": 75,
      "Machine Learning Engineer": 78,
      "Data Scientist": 75,
      "Solutions Architect": 70,

      "Civil Engineer": 78,
      "Electrical Engineer": 80,
      "Mechanical Engineer": 78,

      "Teacher (Secondary)": 70,
      "Teacher (Primary)": 65
    };

    // ======================
    // Massive profession generator (~450+)
    // ======================
    function uniqueJobs(list){
      const seen = new Set();
      const out = [];
      for (const j of list){
        const key = j.title.toLowerCase();
        if (seen.has(key)) continue;
        seen.add(key);
        out.push(j);
      }
      return out;
    }
    function generateJobs(){
      const out = [];
      const add = (title, category, sub) => out.push({ title, category, sub });

      // Helper: add many with patterns
      const addMany = (baseTitles, category, sub) => baseTitles.forEach(t => add(t, category, sub));
      const addLevels = (levels, roles, category, subBuilder) => {
        levels.forEach(l => roles.forEach(r => add(`${l} ${r}`, category, subBuilder(l,r))));
      };

      // Hospitality & Retail (VERY accessible)
      addMany([
        "Retail Assistant","Retail Sales Associate","Cashier","Store Team Member","Customer Service Assistant",
        "Call Centre Agent","Receptionist (Entry)","Barista","Cafe All-rounder","Waiter","Waitress","Kitchen Hand",
        "Fast Food Team Member","Crew Member","Food Prep Assistant","Dishwasher",
        "Bar Staff","Bartender","Hotel Porter","Housekeeper","Cleaner","Car Wash Attendant",
        "Event Staff","Cinema Attendant","Grocery Team Member","Stock Replenisher","Merchandiser",
        "Shift Supervisor (Retail)","Shift Supervisor (Hospitality)","Duty Manager (Retail)","Duty Manager (Hospitality)",
        "Assistant Store Manager","Store Manager","Restaurant Manager","Venue Manager",
        "Customer Success Associate","Front Desk Agent"
      ], "hospitality", "Accessible ‚Ä¢ customer service ‚Ä¢ teamwork");

      // Logistics (accessible)
      addMany([
        "Warehouse Assistant","Picker Packer","Storeperson","Forklift Operator","Dispatch Coordinator",
        "Delivery Driver","Courier Driver","Truck Driver (MR)","Truck Driver (HR)","Truck Driver (HC)",
        "Inventory Controller","Supply Chain Assistant","Logistics Coordinator","Fleet Administrator",
        "Transport Scheduler","Route Planner","Freight Handler","Loading Dock Worker"
      ], "logistics", "Demand ‚Ä¢ safety ‚Ä¢ reliability");

      // Trades (often accessible)
      addMany([
        "Apprentice Electrician","Apprentice Plumber","Apprentice Carpenter","Apprentice Bricklayer","Apprentice Painter",
        "Apprentice Mechanic","Apprentice Cabinetmaker","Apprentice Refrigeration Mechanic",
        "Electrician","Plumber","Carpenter","Bricklayer","Painter","Tiler","Glazier","Welder","Boilermaker",
        "Mechanic","Diesel Mechanic","Auto Electrician","Panel Beater","Spray Painter (Auto)",
        "Landscaper","Gardener","Roofer","Concreter","Fitter and Turner","Machinist",
        "HVAC Technician","Solar Installer","Fire Systems Technician","Locksmith"
      ], "trades", "Hands-on ‚Ä¢ apprenticeship/TAFE ‚Ä¢ earn while learning");

      // Tech
      addMany([
        "Software Engineer","Frontend Developer","Backend Developer","Full Stack Developer","Web Developer",
        "Mobile App Developer","iOS Developer","Android Developer","Game Developer","QA Tester","QA Engineer",
        "Test Automation Engineer","DevOps Engineer","Site Reliability Engineer","Cloud Engineer","Network Engineer",
        "Systems Administrator","IT Support Officer","Helpdesk Technician","Cybersecurity Analyst","Security Engineer",
        "Data Analyst","Data Engineer","Data Scientist","Machine Learning Engineer","AI Engineer",
        "Solutions Architect","Product Analyst","Business Intelligence Analyst","UX Engineer"
      ], "tech", "Build ‚Ä¢ debug ‚Ä¢ ship");

      addLevels(
        ["Junior","Mid","Senior","Lead"],
        ["Software Engineer","Frontend Developer","Backend Developer","Full Stack Developer","Cloud Engineer","Security Engineer","Data Engineer","Data Analyst","QA Engineer"],
        "tech",
        () => "Progression ‚Ä¢ portfolio ‚Ä¢ teamwork"
      );
      ["Python","Java","JavaScript","TypeScript","C#","Go","Rust"].forEach(lang => add(`${lang} Developer`, "tech", "Programming ‚Ä¢ features ‚Ä¢ problem solving"));

      // Business
      addMany([
        "Business Analyst","Project Manager","Product Manager","Operations Coordinator","Operations Manager",
        "Marketing Assistant","Digital Marketer","SEO Specialist","Accountant","Bookkeeper","Payroll Officer",
        "Financial Analyst","Investment Analyst","Sales Representative","Account Manager","Customer Success Manager",
        "HR Assistant","HR Officer","Recruiter","Procurement Officer","Supply Chain Analyst","Office Manager",
        "Executive Assistant","Administrative Assistant","Real Estate Agent","Property Manager","Insurance Consultant"
      ], "business", "Planning ‚Ä¢ people ‚Ä¢ outcomes");

      addLevels(["Junior","Senior"], ["Business Analyst","Project Manager","Product Manager","Marketing Manager","Accountant"], "business",
        () => "Ownership ‚Ä¢ delivery ‚Ä¢ growth"
      );

      // Government / Policy
      addMany([
        "Policy Officer","Policy Analyst","Program Officer","Program Manager","Project Officer",
        "Regulatory Officer","Compliance Officer (Government)","Grants Officer","Procurement Officer (Government)",
        "Community Engagement Officer","Case Manager (Government)","Inspector (Regulatory)","Licensing Officer",
        "Urban Planner","Town Planner","Environmental Health Officer"
      ], "government", "Systems ‚Ä¢ briefs ‚Ä¢ stakeholders");

      // Policing / Justice
      addMany([
        "Police Officer","Detective","Corrections Officer","Protective Services Officer","Security Officer",
        "Border Force Officer","Customs Officer","Intelligence Analyst","Fraud Investigator",
        "Crime Scene Investigator","Forensic Analyst","Emergency Dispatcher","Firefighter","Paramedic"
      ], "policing", "Public service ‚Ä¢ reports ‚Ä¢ teamwork");

      // Education
      addMany([
        "Teacher (Primary)","Teacher (Secondary)","Early Childhood Educator","Teacher Aide","Tutor",
        "Special Education Teacher","School Counsellor","Education Support Officer","Sports Coach",
        "Math Tutor","English Tutor","Science Tutor"
      ], "education", "Learning ‚Ä¢ people ‚Ä¢ structure");

      // Health
      addMany([
        "Nurse","Registered Nurse","Enrolled Nurse","Doctor","General Practitioner","Surgeon",
        "Psychologist","Counsellor","Physiotherapist","Occupational Therapist","Speech Pathologist",
        "Pharmacist","Dentist","Dental Hygienist","Radiographer","Sonographer","Dietitian","Optometrist","Midwife"
      ], "health", "Care ‚Ä¢ science ‚Ä¢ teamwork");

      // Engineering
      addMany([
        "Civil Engineer","Structural Engineer","Mechanical Engineer","Electrical Engineer","Mechatronics Engineer",
        "Biomedical Engineer","Chemical Engineer","Environmental Engineer","Mining Engineer","Robotics Engineer",
        "Surveyor","Draftsperson","CAD Technician"
      ], "engineering", "Design ‚Ä¢ test ‚Ä¢ safety");

      // Law
      addMany([
        "Lawyer","Solicitor","Barrister","Paralegal","Legal Assistant","Legal Secretary","Legal Counsel",
        "Compliance Analyst","Contracts Manager","Mediator","Conveyancer","Court Registrar"
      ], "law", "Rules ‚Ä¢ writing ‚Ä¢ evidence");

      // EXTRA MASS: add many ‚Äúrealistic‚Äù variants to reach 450+
      // Hospitality variants
      addLevels(["Junior","Senior"], ["Barista","Waiter","Kitchen Hand","Customer Service Assistant","Receptionist"], "hospitality",
        () => "Entry-friendly ‚Ä¢ shift work ‚Ä¢ teamwork"
      );
      // Logistics variants
      addLevels(["Junior","Senior"], ["Warehouse Assistant","Logistics Coordinator","Inventory Controller","Delivery Driver"], "logistics",
        () => "Demand ‚Ä¢ safety ‚Ä¢ schedules"
      );
      // Trades variants
      addLevels(["Apprentice","Qualified"], ["Electrician","Plumber","Carpenter","Mechanic","Welder","HVAC Technician","Solar Installer"], "trades",
        (l,r) => (l==="Apprentice" ? "Learn on the job ‚Ä¢ TAFE" : "Skilled trade ‚Ä¢ projects")
      );

      // Add broad ‚Äúassistant/officer/coordinator‚Äù roles that are real + common
      const adminRoles = ["Administrator","Coordinator","Officer","Assistant","Associate","Team Member"];
      const domains = [
        {cat:"business", d:"Operations"},
        {cat:"business", d:"Sales"},
        {cat:"business", d:"Marketing"},
        {cat:"government", d:"Compliance"},
        {cat:"government", d:"Community"},
        {cat:"logistics", d:"Transport"},
        {cat:"logistics", d:"Dispatch"},
        {cat:"hospitality", d:"Customer Service"},
        {cat:"tech", d:"IT Support"}
      ];
      domains.forEach(x=>{
        adminRoles.forEach(r=>{
          add(`${x.d} ${r}`, x.cat, "Common role ‚Ä¢ growth path ‚Ä¢ transferable");
        });
      });

      return uniqueJobs(out).sort((a,b)=>a.title.localeCompare(b.title));
    }

    const JOBS_ALL = generateJobs();

    // ======================
    // Mode + state
    // ======================
    let mode = null; // "ATAR" or "GPA"
    let selectedJob = null;
    let filteredJobs = [];
    let activeIndex = -1;

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function categoryIcon(cat){
      const map = {
        law:"‚öñÔ∏è", policing:"üöì", government:"üèõÔ∏è", tech:"üíª",
        engineering:"üõ†Ô∏è", health:"ü©∫", business:"üìà", creative:"üé®", education:"üìö",
        trades:"üß∞", hospitality:"üõçÔ∏è", logistics:"üöö"
      };
      return map[cat] || "üíº";
    }
    function getCategory(catId){ return CATEGORIES.find(c => c.id === catId); }

    function minScoreForJob(jobTitle, catId){
      if (JOB_MIN_OVERRIDE[jobTitle] != null) return JOB_MIN_OVERRIDE[jobTitle];
      return CATEGORY_MIN[catId] ?? 40;
    }
    function isEligible(job, score){
      const s = Number(score) || 0;
      return s >= minScoreForJob(job.title, job.category);
    }

    // ======================
    // Dropdown UI
    // ======================
    function showPanel(){ $("comboPanel").style.display = "block"; }
    function hidePanel(){
      $("comboPanel").style.display = "none";
      activeIndex = -1;
      renderPanelList();
    }
    function setError(on){ $("errorLine").style.display = on ? "block" : "none"; }

    function validateExactJobEligible(){
      const val = $("jobInput").value.trim().toLowerCase();
      if (!val) return null;
      return filteredJobs.find(j => j.title.toLowerCase() === val) || null;
    }

    function setSelected(job){
      selectedJob = job;
      $("jobInput").value = job.title;
      $("searchBtn").disabled = false;
      setError(false);
      hidePanel();
    }

    function buildEligibleJobs(){
      const score = $("scoreInput").value;
      const eligible = JOBS_ALL.filter(j => isEligible(j, score));

      // SAFETY NET: if somehow nothing matches, force show hospitality/logistics/trades anyway
      if (!eligible.length){
        return JOBS_ALL.filter(j => ["hospitality","logistics","trades"].includes(j.category)).slice(0, 250);
      }
      return eligible;
    }

    function filterJobs(query){
      const q = (query || "").trim().toLowerCase();
      const eligible = buildEligibleJobs();
      if (!q) return eligible.slice(0, 320);
      return eligible
        .filter(j => j.title.toLowerCase().includes(q) || (j.sub||"").toLowerCase().includes(q))
        .slice(0, 320);
    }

    function renderPanelList(){
      const list = $("panelList");
      list.innerHTML = "";
      const items = filteredJobs;

      $("jobCountNote").textContent = `${items.length} eligible jobs showing (out of ${buildEligibleJobs().length} eligible).`;

      if (!items.length){
        const empty = document.createElement("div");
        empty.className = "panelItem";
        empty.style.cursor = "default";
        empty.innerHTML = `
          <div class="badge">‚ùå</div>
          <div>
            <div class="pTitle">No eligible match</div>
            <div class="pSub">Try increasing your score or type a different job.</div>
          </div>
        `;
        list.appendChild(empty);
        return;
      }

      items.forEach((job, idx) => {
        const div = document.createElement("div");
        div.className = "panelItem" + (idx === activeIndex ? " active" : "");
        const minReq = minScoreForJob(job.title, job.category);
        const catName = getCategory(job.category)?.name || "Career";
        div.innerHTML = `
          <div class="badge">${categoryIcon(job.category)}</div>
          <div style="min-width:0">
            <div class="pTitle">${escapeHtml(job.title)}</div>
            <div class="pSub">
              ${escapeHtml(catName)}
              ‚Ä¢ min ${mode || "Score"}: ${minReq}
            </div>
          </div>
        `;
        div.addEventListener("mousedown", (e) => {
          e.preventDefault();
          setSelected(job);
        });
        list.appendChild(div);
      });
    }

    function ensureActiveVisible(){
      const list = $("panelList");
      const item = list.children[activeIndex];
      if (!item) return;

      const itemTop = item.offsetTop;
      const itemBottom = itemTop + item.offsetHeight;
      const viewTop = list.scrollTop;
      const viewBottom = viewTop + list.clientHeight;

      if (itemTop < viewTop) list.scrollTop = itemTop;
      else if (itemBottom > viewBottom) list.scrollTop = itemBottom - list.clientHeight;
    }

    function refreshPanel(){
      filteredJobs = filterJobs($("jobInput").value);
      renderPanelList();
    }

    // ======================
    // STRICT MODE shortlist
    // ======================
    function scoreCategoryStrict(catId, score, salaryKey, primaryCat){
      let s = 0;

      if (catId === primaryCat) s += 100;
      else s += 55;

      const g = Number(score) || 0;

      const competitive = ["law","health","engineering"];
      if (competitive.includes(catId)){
        s += (g >= 90 ? 20 : g >= 80 ? 12 : g >= 70 ? 6 : 2);
      } else {
        s += (g >= 80 ? 10 : g >= 70 ? 7 : 4);
      }

      // Salary circumstance
      // solo: prefers accessible + stable paths
      // family: balanced
      // wealth: favors high-ceiling categories
      if (salaryKey === "wealth"){
        if (["tech","engineering","law","business","trades"].includes(catId)) s += 10;
        else s += 4;
      } else if (salaryKey === "solo"){
        if (["hospitality","logistics","trades","government","policing"].includes(catId)) s += 7;
      } else if (salaryKey === "family"){
        if (["business","government","tech","trades","health"].includes(catId)) s += 7;
      }

      return s;
    }

    function sampleJobsForCategory(catId, excludeTitle){
      const score = $("scoreInput").value;
      const eligible = JOBS_ALL.filter(j => j.category === catId && j.title !== excludeTitle && isEligible(j, score));
      return eligible.slice(0, 10).map(j => j.title);
    }

    function toPercent(rankIndex, topScore, score){
      const raw = Math.max(0, Math.min(100, Math.round((score / topScore) * 100)));
      if (rankIndex === 0) return Math.max(raw, 78);
      if (rankIndex === 1) return Math.min(Math.max(raw, 66), 92);
      if (rankIndex === 2) return Math.min(Math.max(raw, 58), 88);
      return Math.min(Math.max(raw, 50), 82);
    }

    function renderResults(sorted, primaryJob){
      const results = $("results");
      results.style.display = "block";
      results.innerHTML = "";

      const topScore = sorted[0]?.score || 1;

      sorted.forEach((item, idx) => {
        const cat = getCategory(item.catId);
        const pct = toPercent(idx, topScore, item.score);
        const suggested = sampleJobsForCategory(item.catId, primaryJob.title).slice(0, 10);

        const card = document.createElement("div");
        card.className = "resultCard";
        card.innerHTML = `
          <div class="resultTop">
            <div>
              <h3 class="resultName">${idx+1}. ${escapeHtml(cat.name)}</h3>
              <div class="tags">
                ${cat.tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("")}
              </div>
            </div>
            <div class="match">${pct}% match</div>
          </div>

          <div class="why">Why it fits:</div>
          <ul>
            <li><b>Your selected job:</b> ${escapeHtml(primaryJob.title)}</li>
            <li><b>Strict mode:</b> ${escapeHtml(item.catId === primaryJob.category ? "Same category as your job." : "Directly related category only.")}</li>
            ${cat.why.map(x => `<li>${escapeHtml(x)}</li>`).join("")}
          </ul>

          <div class="moreRow">
            <span class="hint">Click to expand</span>
            <button class="pillBtn" data-toggle-details>More details</button>
          </div>

          <div class="details">
            <div class="detailsGrid">
              <div class="detailItem">
                <div class="detailTitle">Day-to-day</div>
                <div class="detailText">${escapeHtml(cat.details.dayToDay)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Entry / pathway</div>
                <div class="detailText">${escapeHtml(cat.details.pathways)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Best subjects</div>
                <div class="detailText">${escapeHtml(cat.details.subjects)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Key skills</div>
                <div class="detailText">${escapeHtml(cat.details.skills)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Entry notes</div>
                <div class="detailText">${escapeHtml(cat.details.entry)}</div>
              </div>
              <div class="detailItem">
                <div class="detailTitle">Next steps (this week)</div>
                <div class="detailText">${escapeHtml(cat.details.next)}</div>
              </div>

              <div class="detailItem" style="grid-column:1/-1;">
                <div class="detailTitle">Eligible jobs you can also pick right now</div>
                <div class="detailText">
                  ${suggested.length ? suggested.map(x => `‚Ä¢ ${escapeHtml(x)}`).join("<br/>") : "No eligible suggestions at your current score."}
                </div>
              </div>
            </div>
          </div>
        `;
        results.appendChild(card);
      });

      results.scrollIntoView({ behavior:"smooth", block:"start" });
    }

    function runSearch(){
      const exact = validateExactJobEligible();
      if (!exact){
        $("searchBtn").disabled = true;
        setError(true);
        $("results").style.display = "none";
        return;
      }

      selectedJob = exact;
      $("searchBtn").disabled = false;
      setError(false);

      const score = $("scoreInput").value;
      const salaryKey = $("salary").value;
      const primaryCat = selectedJob.category;

      const catIds = [primaryCat, ...(RELATED[primaryCat] || [])].slice(0, 4);
      const uniqueCatIds = Array.from(new Set(catIds));

      const scored = uniqueCatIds.map(id => ({
        catId: id,
        score: scoreCategoryStrict(id, score, salaryKey, primaryCat)
      })).sort((a,b)=>b.score-a.score);

      renderResults(scored, selectedJob);
    }

    // ======================
    // Start modal logic
    // ======================
    function setMode(newMode){
      mode = newMode;
      $("startModal").style.display = "none";

      $("scoreLabel").textContent = (mode === "ATAR") ? "ATAR (0‚Äì100)" : "GPA (0‚Äì100)";
      $("modeText").textContent = mode;
      $("scoreText").textContent = $("scoreInput").value;

      refreshPanel();
    }

    $("chooseATAR").addEventListener("click", () => setMode("ATAR"));
    $("chooseGPA").addEventListener("click", () => setMode("GPA"));

    // ======================
    // Events
    // ======================
    $("jobInput").addEventListener("focus", () => {
      refreshPanel();
      showPanel();
    });

    $("jobInput").addEventListener("input", () => {
      const exact = validateExactJobEligible();
      if (exact){
        selectedJob = exact;
        $("searchBtn").disabled = false;
        setError(false);
      } else {
        selectedJob = null;
        $("searchBtn").disabled = true;
      }
      refreshPanel();
      showPanel();
    });

    $("jobInput").addEventListener("keydown", (e) => {
      if ($("comboPanel").style.display !== "block") return;

      if (e.key === "ArrowDown"){
        e.preventDefault();
        if (!filteredJobs.length) return;
        activeIndex = Math.min(filteredJobs.length - 1, activeIndex + 1);
        renderPanelList();
        ensureActiveVisible();
      } else if (e.key === "ArrowUp"){
        e.preventDefault();
        if (!filteredJobs.length) return;
        activeIndex = Math.max(0, activeIndex - 1);
        renderPanelList();
        ensureActiveVisible();
      } else if (e.key === "Enter"){
        const pick = filteredJobs[activeIndex];
        if (pick){
          e.preventDefault();
          setSelected(pick);
        } else {
          const exact = validateExactJobEligible();
          if (exact){
            e.preventDefault();
            setSelected(exact);
          }
        }
      } else if (e.key === "Escape"){
        hidePanel();
      }
    });

    document.addEventListener("mousedown", (e) => {
      const field = $("jobField");
      if (!field.contains(e.target)) hidePanel();
    });

    $("scoreInput").addEventListener("input", () => {
      $("scoreText").textContent = $("scoreInput").value;

      refreshPanel();
      const exact = validateExactJobEligible();
      if (!exact){
        selectedJob = null;
        $("searchBtn").disabled = true;
      } else {
        selectedJob = exact;
        $("searchBtn").disabled = false;
      }
    });

    $("searchBtn").addEventListener("click", runSearch);

    $("resetBtn").addEventListener("click", () => {
      $("jobInput").value = "";
      $("scoreInput").value = 70;
      $("salary").value = "solo";
      selectedJob = null;
      $("searchBtn").disabled = true;
      setError(false);
      $("results").style.display = "none";
      $("results").innerHTML = "";
      $("scoreText").textContent = "70";
      refreshPanel();
      window.scrollTo({ top: 0, behavior:"smooth" });
    });

    document.addEventListener("click", (e) => {
      const toggleBtn = e.target.closest("[data-toggle-details]");
      if (toggleBtn){
        e.preventDefault();
        const card = toggleBtn.closest(".resultCard");
        if (card) card.classList.toggle("expanded");
        return;
      }
      const card = e.target.closest(".resultCard");
      if (!card) return;
      if (e.target.closest("a, button, input, select, textarea")) return;
      card.classList.toggle("expanded");
    });

    // Initial
    filteredJobs = [];
    renderPanelList();
  </script>
</body>
</html>
